<!--
Gallery Performance Monitoring Component
Real-time performance dashboard for gallery optimization and analytics
-->

<div class="performance-monitoring">
    <!-- Performance Overview -->
    <div class="performance-overview">
        <div class="overview-header">
            <h2>Gallery Performance Monitoring</h2>
            <div class="header-actions">
                <button class="btn btn-outline" id="refreshMetricsBtn">
                    <i class="fas fa-sync-alt"></i>
                    Refresh Metrics
                </button>
                <button class="btn btn-secondary" id="exportMetricsBtn">
                    <i class="fas fa-download"></i>
                    Export Data
                </button>
                <button class="btn btn-primary" id="runAuditBtn">
                    <i class="fas fa-search"></i>
                    Run Performance Audit
                </button>
            </div>
        </div>

        <!-- Core Web Vitals Cards -->
        <div class="cwv-cards">
            <div class="cwv-card lcp-card">
                <div class="card-header">
                    <div class="metric-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="metric-info">
                        <h3>LCP</h3>
                        <p class="metric-description">Largest Contentful Paint</p>
                    </div>
                    <div class="metric-rating" id="lcpRating">
                        <span class="rating-badge">--</span>
                    </div>
                </div>
                <div class="metric-value" id="lcpValue">-- ms</div>
                <div class="metric-threshold">
                    <span class="good">Good: ≤ 2.5s</span>
                    <span class="poor">Poor: > 4.0s</span>
                </div>
            </div>

            <div class="cwv-card fid-card">
                <div class="card-header">
                    <div class="metric-icon">
                        <i class="fas fa-mouse-pointer"></i>
                    </div>
                    <div class="metric-info">
                        <h3>FID</h3>
                        <p class="metric-description">First Input Delay</p>
                    </div>
                    <div class="metric-rating" id="fidRating">
                        <span class="rating-badge">--</span>
                    </div>
                </div>
                <div class="metric-value" id="fidValue">-- ms</div>
                <div class="metric-threshold">
                    <span class="good">Good: ≤ 100ms</span>
                    <span class="poor">Poor: > 300ms</span>
                </div>
            </div>

            <div class="cwv-card cls-card">
                <div class="card-header">
                    <div class="metric-icon">
                        <i class="fas fa-arrows-alt"></i>
                    </div>
                    <div class="metric-info">
                        <h3>CLS</h3>
                        <p class="metric-description">Cumulative Layout Shift</p>
                    </div>
                    <div class="metric-rating" id="clsRating">
                        <span class="rating-badge">--</span>
                    </div>
                </div>
                <div class="metric-value" id="clsValue">--</div>
                <div class="metric-threshold">
                    <span class="good">Good: ≤ 0.1</span>
                    <span class="poor">Poor: > 0.25</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Details Section -->
    <div class="performance-details">
        
        <!-- Image Performance -->
        <div class="performance-section" id="imagePerformanceSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-images"></i>
                    Image Loading Performance
                </h3>
                <div class="section-stats">
                    <span class="stat-badge" id="imageSuccessRate">-- % success</span>
                    <span class="stat-badge" id="averageLoadTime">-- ms avg</span>
                </div>
            </div>
            
            <div class="performance-content">
                <div class="performance-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-image text-primary"></i>
                            <span>Total Images</span>
                        </div>
                        <div class="metric-number" id="totalImages">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-check-circle text-success"></i>
                            <span>Loaded Successfully</span>
                        </div>
                        <div class="metric-number" id="loadedImages">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-exclamation-triangle text-warning"></i>
                            <span>Failed to Load</span>
                        </div>
                        <div class="metric-number" id="failedImages">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-weight-hanging text-info"></i>
                            <span>Total Data Transfer</span>
                        </div>
                        <div class="metric-number" id="totalDataTransfer">-- MB</div>
                    </div>
                </div>

                <!-- Image Performance Chart -->
                <div class="chart-container">
                    <canvas id="imageLoadTimeChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- User Interaction Analytics -->
        <div class="performance-section" id="userInteractionSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-users"></i>
                    User Interaction Analytics
                </h3>
                <div class="section-stats">
                    <span class="stat-badge" id="sessionDuration">-- min session</span>
                    <span class="stat-badge" id="scrollDepth">-- % scrolled</span>
                </div>
            </div>
            
            <div class="performance-content">
                <div class="performance-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-eye text-primary"></i>
                            <span>Gallery Views</span>
                        </div>
                        <div class="metric-number" id="galleryViews">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-mouse-pointer text-success"></i>
                            <span>Image Clicks</span>
                        </div>
                        <div class="metric-number" id="imageClicks">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-expand text-info"></i>
                            <span>Lightbox Opens</span>
                        </div>
                        <div class="metric-number" id="lightboxOpens">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-scroll text-warning"></i>
                            <span>Max Scroll Depth</span>
                        </div>
                        <div class="metric-number" id="maxScrollDepth">-- %</div>
                    </div>
                </div>

                <!-- Interaction Heatmap -->
                <div class="heatmap-container">
                    <h4>User Interaction Patterns</h4>
                    <div class="heatmap-visualization" id="interactionHeatmap">
                        <!-- Heatmap will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cache Performance -->
        <div class="performance-section" id="cachePerformanceSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-database"></i>
                    Cache Performance
                </h3>
                <div class="section-stats">
                    <span class="stat-badge" id="cacheHitRate">-- % hit rate</span>
                    <span class="stat-badge" id="prefetchEfficiency">-- % prefetch</span>
                </div>
            </div>
            
            <div class="performance-content">
                <div class="performance-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-check text-success"></i>
                            <span>Cache Hits</span>
                        </div>
                        <div class="metric-number" id="cacheHits">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-times text-error"></i>
                            <span>Cache Misses</span>
                        </div>
                        <div class="metric-number" id="cacheMisses">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-rocket text-primary"></i>
                            <span>Prefetch Hits</span>
                        </div>
                        <div class="metric-number" id="prefetchHits">--</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-percentage text-info"></i>
                            <span>Efficiency Score</span>
                        </div>
                        <div class="metric-number" id="cacheEfficiency">-- %</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Usage -->
        <div class="performance-section" id="memoryUsageSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-microchip"></i>
                    Memory Usage
                </h3>
                <button class="btn btn-sm btn-outline" id="triggerGCBtn">
                    <i class="fas fa-trash"></i>
                    Force Garbage Collection
                </button>
            </div>
            
            <div class="performance-content">
                <div class="memory-chart-container">
                    <canvas id="memoryUsageChart" width="400" height="200"></canvas>
                </div>
                
                <div class="memory-stats">
                    <div class="memory-stat">
                        <label>Used JS Heap</label>
                        <div class="progress-bar">
                            <div class="progress-fill" id="usedHeapProgress"></div>
                        </div>
                        <span class="memory-value" id="usedHeapValue">-- MB</span>
                    </div>
                    
                    <div class="memory-stat">
                        <label>Total JS Heap</label>
                        <div class="progress-bar">
                            <div class="progress-fill" id="totalHeapProgress"></div>
                        </div>
                        <span class="memory-value" id="totalHeapValue">-- MB</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Recommendations -->
        <div class="performance-section" id="recommendationsSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-lightbulb"></i>
                    Performance Recommendations
                </h3>
                <button class="btn btn-sm btn-primary" id="generateRecommendationsBtn">
                    <i class="fas fa-magic"></i>
                    Generate New Recommendations
                </button>
            </div>
            
            <div class="performance-content">
                <div class="recommendations-list" id="recommendationsList">
                    <!-- Recommendations will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Real-time Performance Timeline -->
        <div class="performance-section" id="timelineSection">
            <div class="section-header">
                <h3>
                    <i class="fas fa-chart-line"></i>
                    Real-time Performance Timeline
                </h3>
                <div class="timeline-controls">
                    <button class="btn btn-sm btn-outline" id="pauseTimelineBtn">
                        <i class="fas fa-pause"></i>
                        Pause
                    </button>
                    <button class="btn btn-sm btn-outline" id="clearTimelineBtn">
                        <i class="fas fa-trash"></i>
                        Clear
                    </button>
                </div>
            </div>
            
            <div class="performance-content">
                <div class="timeline-chart-container">
                    <canvas id="performanceTimelineChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- Performance Alert Modal -->
    <div class="performance-modal" id="performanceAlertModal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Performance Alert</h3>
                <button class="modal-close" id="closeAlertModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert-content" id="alertContent">
                    <!-- Alert details populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="dismissAlert">Dismiss</button>
                <button class="btn btn-primary" id="viewDetailsAlert">View Details</button>
            </div>
        </div>
    </div>

</div>

<!-- Performance Templates -->
<script type="text/template" id="recommendationTemplate">
    <div class="recommendation-item {{severity}}">
        <div class="recommendation-icon">
            <i class="fas fa-{{icon}}"></i>
        </div>
        <div class="recommendation-content">
            <div class="recommendation-header">
                <h4>{{category}}</h4>
                <span class="severity-badge {{severity}}">{{severity}}</span>
            </div>
            <p class="recommendation-message">{{message}}</p>
            {{#if value}}
            <div class="recommendation-value">
                Current value: <strong>{{value}}</strong>
            </div>
            {{/if}}
            {{#if suggestion}}
            <div class="recommendation-suggestion">
                <strong>Suggestion:</strong> {{suggestion}}
            </div>
            {{/if}}
        </div>
        <div class="recommendation-actions">
            <button class="btn btn-sm btn-outline view-details-btn" data-category="{{category}}">
                <i class="fas fa-info-circle"></i>
                Details
            </button>
            {{#if fixable}}
            <button class="btn btn-sm btn-primary auto-fix-btn" data-category="{{category}}">
                <i class="fas fa-magic"></i>
                Auto Fix
            </button>
            {{/if}}
        </div>
    </div>
</script>

<style>
/* Performance Monitoring Specific Styles */
.performance-monitoring {
    padding: 0;
}

.performance-overview {
    margin-bottom: 2rem;
}

.overview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.overview-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.header-actions {
    display: flex;
    gap: 0.5rem;
}

/* Core Web Vitals Cards */
.cwv-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.cwv-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.2s ease-in-out;
}

.cwv-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.cwv-card .card-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1rem;
    padding: 0;
    border: none;
}

.metric-icon {
    width: 3rem;
    height: 3rem;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
}

.lcp-card .metric-icon {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.fid-card .metric-icon {
    background: linear-gradient(135deg, #10b981, #059669);
}

.cls-card .metric-icon {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.metric-info h3 {
    margin: 0 0 0.25rem 0;
    font-size: 1.125rem;
    font-weight: 600;
}

.metric-description {
    margin: 0;
    font-size: 0.75rem;
    color: #64748b;
}

.metric-rating {
    margin-left: auto;
}

.rating-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.rating-badge.good {
    background: #10b981;
    color: white;
}

.rating-badge.needs-improvement {
    background: #f59e0b;
    color: white;
}

.rating-badge.poor {
    background: #ef4444;
    color: white;
}

.metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.5rem;
}

.metric-threshold {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
}

.metric-threshold .good {
    color: #10b981;
}

.metric-threshold .poor {
    color: #ef4444;
}

/* Performance Sections */
.performance-section {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    margin-bottom: 2rem;
    overflow: hidden;
}

.performance-section .section-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    background: #f8fafc;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.performance-section .section-header h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-stats {
    display: flex;
    gap: 0.5rem;
}

.stat-badge {
    background: #e2e8f0;
    color: #475569;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
}

.performance-content {
    padding: 1.5rem;
}

/* Performance Grid */
.performance-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}

.metric-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    padding: 1rem;
    text-align: center;
}

.metric-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
    color: #64748b;
}

.metric-number {
    font-size: 1.75rem;
    font-weight: 700;
    color: #1e293b;
}

/* Chart Containers */
.chart-container,
.timeline-chart-container,
.memory-chart-container {
    background: #f8fafc;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 1rem;
}

.timeline-controls {
    display: flex;
    gap: 0.5rem;
}

/* Memory Usage */
.memory-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.memory-stat {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.memory-stat label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
}

.progress-bar {
    width: 100%;
    height: 0.5rem;
    background: #e5e7eb;
    border-radius: 0.25rem;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #059669);
    transition: width 0.3s ease;
}

.memory-value {
    font-size: 0.875rem;
    font-weight: 600;
    color: #1f2937;
}

/* Recommendations */
.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    background: #f9fafb;
}

.recommendation-item.high {
    border-left: 4px solid #ef4444;
}

.recommendation-item.medium {
    border-left: 4px solid #f59e0b;
}

.recommendation-item.low {
    border-left: 4px solid #10b981;
}

.recommendation-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.recommendation-item.high .recommendation-icon {
    background: #fef2f2;
    color: #dc2626;
}

.recommendation-item.medium .recommendation-icon {
    background: #fffbeb;
    color: #d97706;
}

.recommendation-item.low .recommendation-icon {
    background: #f0fdf4;
    color: #16a34a;
}

.recommendation-content {
    flex: 1;
}

.recommendation-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.recommendation-header h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.severity-badge {
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: capitalize;
}

.severity-badge.high {
    background: #dc2626;
    color: white;
}

.severity-badge.medium {
    background: #d97706;
    color: white;
}

.severity-badge.low {
    background: #16a34a;
    color: white;
}

.recommendation-message {
    margin: 0 0 0.5rem 0;
    color: #374151;
    line-height: 1.5;
}

.recommendation-value,
.recommendation-suggestion {
    margin: 0.5rem 0;
    font-size: 0.875rem;
}

.recommendation-value {
    color: #6b7280;
}

.recommendation-suggestion {
    color: #059669;
}

.recommendation-actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

/* Heatmap */
.heatmap-container {
    margin-top: 2rem;
}

.heatmap-container h4 {
    margin: 0 0 1rem 0;
    font-size: 1rem;
    font-weight: 600;
}

.heatmap-visualization {
    height: 200px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    font-style: italic;
}

/* Performance Modal */
.performance-modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.performance-modal .modal-content {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 32rem;
    overflow: hidden;
}

.performance-modal .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.performance-modal .modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #dc2626;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .cwv-cards {
        grid-template-columns: 1fr;
    }
    
    .performance-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 640px) {
    .overview-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .header-actions {
        width: 100%;
        justify-content: stretch;
    }
    
    .header-actions .btn {
        flex: 1;
    }
    
    .performance-grid {
        grid-template-columns: 1fr;
    }
    
    .memory-stats {
        grid-template-columns: 1fr;
    }
    
    .recommendation-item {
        flex-direction: column;
    }
    
    .recommendation-actions {
        flex-direction: row;
        width: 100%;
    }
}
</style>

<script type="module" src="/admin/js/performance-monitoring.js"></script>