<!-- Home Page Content Editor - RoseMastos Style -->
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-2 text-gray-800">
                        <i class="fas fa-home text-primary me-2"></i>
                        Home Page Content Editor
                    </h1>
                    <p class="text-muted mb-0">Edit your homepage sections with real-time saving</p>
                </div>
                <div class="d-flex gap-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input auto-save-field" type="checkbox" id="page_published" data-field="page_published">
                        <label class="form-check-label fw-bold text-warning" for="page_published" id="publish-label">
                            <i class="fas fa-eye-slash me-1"></i>Draft
                        </label>
                    </div>
                    <a href="#" onclick="window.history.back()" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Content Hub
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-save Status -->
    <div id="auto-save-status" class="alert alert-info d-none">
        <i class="fas fa-spinner fa-spin me-2"></i>
        <span id="save-status-text">Saving...</span>
    </div>

    <!-- Tabbed Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-0 pb-0">
                    <nav class="nav nav-tabs" id="content-tabs">
                        <button type="button" class="nav-link active" data-section="hero">
                            <i class="fas fa-star text-warning me-2"></i>Hero Section
                        </button>
                        <button type="button" class="nav-link" data-section="about">
                            <i class="fas fa-user text-info me-2"></i>About Section
                        </button>
                        <button type="button" class="nav-link" data-section="gallery">
                            <i class="fas fa-images text-success me-2"></i>Gallery Section
                        </button>
                        <button type="button" class="nav-link" data-section="testimonials">
                            <i class="fas fa-quote-left text-purple me-2"></i>Testimonials
                        </button>
                        <button type="button" class="nav-link" data-section="travel">
                            <i class="fas fa-map-marker-alt text-success me-2"></i>Travel Schedule
                        </button>
                        <button type="button" class="nav-link" data-section="cta">
                            <i class="fas fa-bullhorn text-danger me-2"></i>Call to Action
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Sections -->
    <div id="content-sections">
        
        <!-- Hero Section Tab -->
        <div class="section-content active" data-section="hero">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-star me-2"></i>Hero Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="hero_section_visible" data-field="hero_section_visible" checked>
                            <label class="form-check-label text-white" for="hero_section_visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Hero Text Configuration -->
                        <div class="col-lg-4">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-text-width me-2"></i>Hero Text
                                </h5>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Hero Title</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="hero_title" 
                                           data-field="hero_title"
                                           placeholder="About Sample Model">
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">The main title displayed prominently in the hero section</small>
                                </div>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Hero Subtitle</label>
                                    <textarea class="form-control auto-save-field" 
                                              id="hero_subtitle" 
                                              data-field="hero_subtitle"
                                              rows="2"
                                              placeholder="Lorem ipsum dolor sit amet, consectetur adipiscing elit..."></textarea>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">The subtitle text that appears below the main title</small>
                                </div>
                                
                                <div class="enhanced-field">
                                    <label class="form-label fw-bold">Hero Description</label>
                                    <textarea class="form-control auto-save-field" 
                                              id="hero_description" 
                                              data-field="hero_description"
                                              rows="3"
                                              placeholder="Duis aute irure dolor in reprehenderit in voluptate velit esse..."></textarea>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">Additional description text below the subtitle</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hero Background Image Configuration -->
                        <div class="col-lg-4">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-warning mb-3">
                                    <i class="fas fa-image me-2"></i>Hero Background Image
                                </h5>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Background Image</label>
                                    <select class="form-select auto-save-field" 
                                            id="hero_background_image_id" 
                                            data-field="hero_background_image_id">
                                        <option value="">No custom background (use default)</option>
                                        <!-- Gallery images will be populated here -->
                                    </select>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">Select an image from your gallery to use as the hero background. If none selected, defaults to a luxury stock image.</small>
                                </div>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Background Opacity</label>
                                    <div class="bg-white border rounded p-3">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="text-muted me-2 small">10%</span>
                                            <input type="range" class="form-range auto-save-field flex-grow-1 mx-2" 
                                                   id="hero_background_opacity" 
                                                   data-field="hero_background_opacity"
                                                   min="0.1" 
                                                   max="1.0" 
                                                   step="0.1" 
                                                   value="0.6"
                                                   style="background: linear-gradient(to right, #dc3545 0%, #ffc107 50%, #28a745 100%);">
                                            <span class="text-muted ms-2 small">100%</span>
                                        </div>
                                        <div class="text-center">
                                            <span class="badge bg-primary fs-6" id="opacity-value">60%</span>
                                        </div>
                                    </div>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">Adjust how transparent or opaque the background image appears. Lower values make text more readable over busy images.</small>
                                </div>
                                
                                <!-- Background Image Preview -->
                                <div class="enhanced-field">
                                    <div class="bg-secondary rounded p-3 text-center d-none" id="hero-background-preview">
                                        <img id="hero-background-preview-img" class="img-fluid rounded" style="max-height: 100px;" alt="Background preview">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hero Buttons Configuration -->
                        <div class="col-lg-4">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-success mb-3">
                                    <i class="fas fa-mouse-pointer me-2"></i>Action Buttons
                                </h5>
                                
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="card border-primary">
                                            <div class="card-header bg-primary text-white py-2">
                                                <small class="fw-bold">Primary Button</small>
                                            </div>
                                            <div class="card-body">
                                                <div class="enhanced-field mb-2">
                                                    <input type="text" class="form-control form-control-sm auto-save-field" 
                                                           id="hero_button_1_text" 
                                                           data-field="hero_button_1_text"
                                                           placeholder="View Calendar">
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                                <div class="enhanced-field">
                                                    <select class="form-select form-select-sm auto-save-field" 
                                                            id="hero_button_1_link" 
                                                            data-field="hero_button_1_link">
                                                        <option value="calendar">📅 Calendar Page</option>
                                                        <option value="contact">✉️ Contact Page</option>
                                                        <option value="gallery">🖼️ Gallery Page</option>
                                                        <option value="rates">💰 Rates Page</option>
                                                        <option value="about">👤 About Page</option>
                                                    </select>
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <div class="card border-secondary">
                                            <div class="card-header bg-secondary text-white py-2">
                                                <small class="fw-bold">Secondary Button</small>
                                            </div>
                                            <div class="card-body">
                                                <div class="enhanced-field mb-2">
                                                    <input type="text" class="form-control form-control-sm auto-save-field" 
                                                           id="hero_button_2_text" 
                                                           data-field="hero_button_2_text"
                                                           placeholder="Contact Me">
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                                <div class="enhanced-field">
                                                    <select class="form-select form-select-sm auto-save-field" 
                                                            id="hero_button_2_link" 
                                                            data-field="hero_button_2_link">
                                                        <option value="contact">✉️ Contact Page</option>
                                                        <option value="calendar">📅 Calendar Page</option>
                                                        <option value="gallery">🖼️ Gallery Page</option>
                                                        <option value="rates">💰 Rates Page</option>
                                                        <option value="about">👤 About Page</option>
                                                    </select>
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section Tab -->
        <div class="section-content" data-section="about">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-info text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-user me-2"></i>About Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="about_section_visible" data-field="about_section_visible" checked>
                            <label class="form-check-label text-white" for="about_section_visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- About Content -->
                        <div class="col-lg-8">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-info mb-3">
                                    <i class="fas fa-file-text me-2"></i>Content
                                </h5>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Section Title</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="about_title" 
                                           data-field="about_title"
                                           placeholder="About Me">
                                    <div class="save-status mt-1"></div>
                                </div>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">First Paragraph</label>
                                    <textarea class="form-control auto-save-field" 
                                              id="about_paragraph_1" 
                                              data-field="about_paragraph_1"
                                              rows="3"
                                              placeholder="Tell your visitors about yourself..."></textarea>
                                    <div class="save-status mt-1"></div>
                                </div>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Second Paragraph</label>
                                    <textarea class="form-control auto-save-field" 
                                              id="about_paragraph_2" 
                                              data-field="about_paragraph_2"
                                              rows="3"
                                              placeholder="Continue your story..."></textarea>
                                    <div class="save-status mt-1"></div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="enhanced-field">
                                            <label class="form-label fw-bold">Link Text</label>
                                            <input type="text" class="form-control auto-save-field" 
                                                   id="about_link_text" 
                                                   data-field="about_link_text"
                                                   placeholder="Learn More">
                                            <div class="save-status mt-1"></div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="enhanced-field">
                                            <label class="form-label fw-bold">Link Destination</label>
                                            <select class="form-select auto-save-field" 
                                                    id="about_link_destination" 
                                                    data-field="about_link_destination">
                                                <option value="about">👤 About Page</option>
                                                <option value="contact">✉️ Contact Page</option>
                                                <option value="gallery">🖼️ Gallery Page</option>
                                                <option value="rates">💰 Rates Page</option>
                                            </select>
                                            <div class="save-status mt-1"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Portrait Configuration -->
                        <div class="col-lg-4">
                            <div class="bg-light rounded p-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="text-warning mb-0">
                                        <i class="fas fa-portrait me-2"></i>Portrait
                                    </h5>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input auto-save-field" type="checkbox" id="portrait_section_visible" data-field="portrait_section_visible" checked>
                                        <label class="form-check-label" for="portrait_section_visible">Show</label>
                                    </div>
                                </div>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Portrait Image</label>
                                    <select class="form-select auto-save-field" 
                                            id="portrait_image_id" 
                                            data-field="portrait_image_id">
                                        <option value="">No image selected</option>
                                        <!-- Gallery images will be populated here -->
                                    </select>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">Choose from your gallery images</small>
                                </div>
                                
                                <div class="enhanced-field">
                                    <label class="form-label fw-bold">Alt Text</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="portrait_alt" 
                                           data-field="portrait_alt"
                                           placeholder="Professional portrait">
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">For accessibility</small>
                                </div>
                                
                                <!-- Portrait Preview -->
                                <div id="portrait-preview" class="mt-3 d-none">
                                    <div class="card">
                                        <div class="card-body text-center p-2">
                                            <img id="portrait-preview-img" class="img-fluid rounded" style="max-height: 120px;" alt="Portrait Preview">
                                            <small class="d-block text-muted mt-1">Preview</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Section Tab -->
        <div class="section-content" data-section="gallery">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-images me-2"></i>Gallery Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="gallery_section_visible" data-field="gallery_section_visible" checked>
                            <label class="form-check-label text-white" for="gallery_section_visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-success mb-3">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </h5>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Section Title</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="gallery_section_title" 
                                           data-field="gallery_section_title"
                                           placeholder="Gallery">
                                    <div class="save-status mt-1"></div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="enhanced-field">
                                            <label class="form-label fw-bold">Button Text</label>
                                            <input type="text" class="form-control auto-save-field" 
                                                   id="gallery_button_text" 
                                                   data-field="gallery_button_text"
                                                   placeholder="View Gallery">
                                            <div class="save-status mt-1"></div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="enhanced-field">
                                            <label class="form-label fw-bold">Button Link</label>
                                            <select class="form-select auto-save-field" 
                                                    id="gallery_button_link" 
                                                    data-field="gallery_button_link">
                                                <option value="gallery">🖼️ Gallery Page</option>
                                                <option value="contact">✉️ Contact Page</option>
                                                <option value="about">👤 About Page</option>
                                            </select>
                                            <div class="save-status mt-1"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-info mb-3">
                                    <i class="fas fa-layer-group me-2"></i>Featured Gallery
                                </h5>
                                
                                <div class="enhanced-field">
                                    <label class="form-label fw-bold">Gallery Section</label>
                                    <select class="form-select auto-save-field" 
                                            id="featured_gallery_section_id" 
                                            data-field="featured_gallery_section_id">
                                        <option value="">No Gallery Selected</option>
                                        <!-- Gallery sections will be populated here -->
                                    </select>
                                    <div class="save-status mt-1"></div>
                                    <small class="text-muted">Choose which gallery to showcase on home page</small>
                                </div>
                                
                                <!-- Gallery Preview -->
                                <div id="gallery-preview" class="mt-3 d-none">
                                    <div class="card">
                                        <div class="card-body p-2">
                                            <div id="gallery-preview-images" class="row g-1">
                                                <!-- Preview images will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testimonials Section Tab -->
        <div class="section-content" data-section="testimonials">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-warning text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-quote-left me-2"></i>Testimonials Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="testimonials_section_visible" data-field="testimonials_section_visible" checked>
                            <label class="form-check-label text-white" for="testimonials_section_visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="bg-light rounded p-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-sliders-h me-2"></i>Display Settings
                        </h5>
                        
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Section Title</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="testimonials_section_title" 
                                           data-field="testimonials_section_title"
                                           placeholder="What Clients Say">
                                    <div class="save-status mt-1"></div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Number to Display</label>
                                    <select class="form-select auto-save-field" 
                                            id="testimonials_display_count" 
                                            data-field="testimonials_display_count">
                                        <option value="1">1 Testimonial</option>
                                        <option value="2">2 Testimonials</option>
                                        <option value="3" selected>3 Testimonials</option>
                                        <option value="4">4 Testimonials</option>
                                        <option value="6">6 Testimonials</option>
                                    </select>
                                    <div class="save-status mt-1"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Manage Testimonials:</strong> To add, edit, or remove testimonials, visit the 
                            <a href="/admin/testimonials" target="_blank" class="alert-link">Testimonials Management</a> page.
                            This section only controls display settings.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Travel Schedule Section Tab -->
        <div class="section-content" data-section="travel">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-map-marker-alt me-2"></i>Travel Schedule Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="travel_section_visible" 
                                   data-field="travel_section_visible" checked>
                            <label class="form-check-label text-white fw-bold" for="travel_section_visible">
                                <i class="fas fa-eye me-1"></i>Visible
                            </label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Section Title -->
                        <div class="col-md-6">
                            <label for="travel_section_title" class="form-label fw-bold">
                                <i class="fas fa-heading me-1"></i>Section Title
                            </label>
                            <input type="text" class="form-control auto-save-field" 
                                   id="travel_section_title" 
                                   data-field="travel_section_title"
                                   placeholder="e.g., Travel Schedule, Location Times, Where I'll Be">
                            <div class="save-status mt-1"></div>
                        </div>
                        
                        <!-- Number of Events to Display -->
                        <div class="col-md-6">
                            <label for="travel_display_count" class="form-label fw-bold">
                                <i class="fas fa-list-ol me-1"></i>Number of Events to Display
                            </label>
                            <select class="form-select auto-save-field" 
                                    id="travel_display_count" 
                                    data-field="travel_display_count">
                                <option value="1">1 Event</option>
                                <option value="2">2 Events</option>
                                <option value="3" selected>3 Events</option>
                                <option value="4">4 Events</option>
                                <option value="5">5 Events</option>
                                <option value="6">6 Events</option>
                            </select>
                            <div class="save-status mt-1"></div>
                        </div>
                        
                        <!-- CTA Button Text -->
                        <div class="col-md-6">
                            <label for="travel_cta_text" class="form-label fw-bold">
                                <i class="fas fa-mouse-pointer me-1"></i>Button Text
                            </label>
                            <input type="text" class="form-control auto-save-field" 
                                   id="travel_cta_text" 
                                   data-field="travel_cta_text"
                                   placeholder="e.g., View Full Calendar, See All Dates">
                            <div class="save-status mt-1"></div>
                        </div>
                        
                        <!-- CTA Button Destination -->
                        <div class="col-md-6">
                            <label for="travel_cta_link" class="form-label fw-bold">
                                <i class="fas fa-link me-1"></i>Button Destination
                            </label>
                            <select class="form-select auto-save-field" 
                                    id="travel_cta_link" 
                                    data-field="travel_cta_link">
                                <option value="calendar" selected>Calendar Page</option>
                                <option value="contact">Contact Page</option>
                                <option value="about">About Page</option>
                                <option value="rates">Rates Page</option>
                                <option value="gallery">Gallery Page</option>
                            </select>
                            <div class="save-status mt-1"></div>
                        </div>
                    </div>
                    
                    <!-- Info Alert -->
                    <div class="alert alert-info mt-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Manage Calendar Events:</strong> To add, edit, or remove calendar events, visit the 
                        <a href="calendar" class="alert-link">Calendar Management</a> page.
                        This section only controls display settings. Events are automatically pulled from your calendar.
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA Section Tab -->
        <div class="section-content" data-section="cta">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-danger text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-bullhorn me-2"></i>Call to Action Section
                        </h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input auto-save-field" type="checkbox" id="cta_section_visible" data-field="cta_section_visible" checked>
                            <label class="form-check-label text-white" for="cta_section_visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- CTA Content -->
                        <div class="col-lg-6">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-danger mb-3">
                                    <i class="fas fa-file-text me-2"></i>Content
                                </h5>
                                
                                <div class="enhanced-field mb-3">
                                    <label class="form-label fw-bold">Section Title</label>
                                    <input type="text" class="form-control auto-save-field" 
                                           id="cta_section_title" 
                                           data-field="cta_section_title"
                                           placeholder="Ready to Meet?">
                                    <div class="save-status mt-1"></div>
                                </div>
                                
                                <div class="enhanced-field">
                                    <label class="form-label fw-bold">Section Subtitle</label>
                                    <textarea class="form-control auto-save-field" 
                                              id="cta_section_subtitle" 
                                              data-field="cta_section_subtitle"
                                              rows="3"
                                              placeholder="Let's create an unforgettable experience together..."></textarea>
                                    <div class="save-status mt-1"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- CTA Buttons -->
                        <div class="col-lg-6">
                            <div class="bg-light rounded p-4">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-click me-2"></i>Action Buttons
                                </h5>
                                
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="card border-primary">
                                            <div class="card-header bg-primary text-white py-2">
                                                <small class="fw-bold">Primary CTA Button</small>
                                            </div>
                                            <div class="card-body">
                                                <div class="enhanced-field mb-2">
                                                    <input type="text" class="form-control form-control-sm auto-save-field" 
                                                           id="cta_button_1_text" 
                                                           data-field="cta_button_1_text"
                                                           placeholder="Book Now">
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                                <div class="enhanced-field">
                                                    <select class="form-select form-select-sm auto-save-field" 
                                                            id="cta_button_1_link" 
                                                            data-field="cta_button_1_link">
                                                        <option value="calendar">📅 Calendar Page</option>
                                                        <option value="contact">✉️ Contact Page</option>
                                                        <option value="rates">💰 Rates Page</option>
                                                        <option value="about">👤 About Page</option>
                                                    </select>
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <div class="card border-secondary">
                                            <div class="card-header bg-secondary text-white py-2">
                                                <small class="fw-bold">Secondary CTA Button</small>
                                            </div>
                                            <div class="card-body">
                                                <div class="enhanced-field mb-2">
                                                    <input type="text" class="form-control form-control-sm auto-save-field" 
                                                           id="cta_button_2_text" 
                                                           data-field="cta_button_2_text"
                                                           placeholder="Learn More">
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                                <div class="enhanced-field">
                                                    <select class="form-select form-select-sm auto-save-field" 
                                                            id="cta_button_2_link" 
                                                            data-field="cta_button_2_link">
                                                        <option value="about">👤 About Page</option>
                                                        <option value="contact">✉️ Contact Page</option>
                                                        <option value="gallery">🖼️ Gallery Page</option>
                                                        <option value="rates">💰 Rates Page</option>
                                                    </select>
                                                    <div class="save-status mt-1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS -->
<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.bg-gradient-success {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.bg-gradient-warning {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.bg-gradient-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
}

.nav-tabs .nav-link {
    border: none;
    background: transparent;
    color: #6c757d;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link.active {
    background: #007bff;
    color: white;
    border-radius: 0.5rem;
}

.nav-tabs .nav-link:hover {
    background: #e9ecef;
    color: #495057;
}

.nav-tabs .nav-link.active:hover {
    background: #0056b3;
    color: white;
}

.section-content {
    display: none;
}

.section-content.active {
    display: block;
}

.enhanced-field {
    position: relative;
}

.save-status {
    min-height: 1.2rem;
    font-size: 0.75rem;
}

.save-status.saving {
    color: #007bff;
}

.save-status.saved {
    color: #28a745;
}

.save-status.error {
    color: #dc3545;
}

.text-purple {
    color: #6f42c1;
}

.auto-save-field:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

@media (max-width: 768px) {
    .nav-tabs {
        flex-wrap: wrap;
    }
    
    .nav-tabs .nav-link {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
    }
}

/* Enhanced opacity slider styling */
#hero_background_opacity {
    height: 8px !important;
    border-radius: 4px;
    background: linear-gradient(to right, 
        rgba(220,53,69,0.3) 0%, 
        rgba(255,193,7,0.5) 25%, 
        rgba(255,255,0,0.7) 50%, 
        rgba(40,167,69,0.8) 75%, 
        rgba(13,110,253,1) 100%) !important;
    outline: none;
    -webkit-appearance: none;
}

#hero_background_opacity::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    cursor: pointer;
    transition: all 0.2s ease;
}

#hero_background_opacity::-webkit-slider-thumb:hover {
    background: #0056b3;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

#hero_background_opacity::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #007bff;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    cursor: pointer;
    -moz-appearance: none;
}

#hero_background_opacity::-webkit-slider-track {
    height: 8px;
    border-radius: 4px;
    background: transparent;
}

#hero_background_opacity::-moz-range-track {
    height: 8px;
    border-radius: 4px;
    background: transparent;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const homePageEditor = {
        currentModelSlug: null,
        saveTimeout: null,
        isLoading: false,
        
        init() {
            this.extractModelSlug();
            this.initTabs();
            this.loadContent();
            this.bindAutoSave();
            this.loadGalleryOptions();
            this.initOpacitySlider();
        },
        
        extractModelSlug() {
            const pathParts = window.location.pathname.split('/');
            this.currentModelSlug = pathParts[1];
            console.log('Editing home page for model:', this.currentModelSlug);
        },
        
        initTabs() {
            const tabButtons = document.querySelectorAll('#content-tabs .nav-link');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = button.dataset.section;
                    this.switchToSection(section);
                });
            });
        },
        
        switchToSection(sectionName) {
            // Update tab buttons
            document.querySelectorAll('#content-tabs .nav-link').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Update content sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelector(`.section-content[data-section="${sectionName}"]`).classList.add('active');
            
            console.log('Switched to section:', sectionName);
        },
        
        async loadContent() {
            console.log('LoadContent started for model:', this.currentModelSlug);
            this.showLoading();
            
            try {
                const apiUrl = `/api/model-home/${this.currentModelSlug}/home`;
                console.log('Fetching from URL:', apiUrl);
                const response = await fetch(apiUrl);
                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.success && data.data) {
                    // Store content data for later use
                    this.contentData = data.data;
                    // Convert content object to the format expected by the form
                    this.populateFields(data.data);
                } else {
                    console.error('Failed to load content:', data);
                    alert('Failed to load page content');
                    return;
                }
            } catch (error) {
                console.error('Error loading home page content:', error);
                this.showError('Failed to load content');
            } finally {
                this.hideLoading();
            }
        },
        
        populateFields(content) {
            console.log('PopulateFields called with:', content);
            for (const [field, value] of Object.entries(content)) {
                const element = document.getElementById(field);
                console.log(`Field: ${field}, Value: "${value}", Element:`, element);
                if (element) {
                    if (element.type === 'checkbox') {
                        const isChecked = value === true || value === 1 || value === '1';
                        element.checked = isChecked;
                        
                        // Handle publish status special case
                        if (field === 'page_published') {
                            this.updatePublishStatus(isChecked);
                        }
                    } else {
                        element.value = value || '';
                        console.log(`Set ${field} to "${value}"`);
                        
                        // Special handling for opacity slider to update display
                        if (field === 'hero_background_opacity' && element.type === 'range') {
                            const opacityValue = document.getElementById('opacity-value');
                            if (opacityValue) {
                                const displayValue = Math.round(parseFloat(value || 0.6) * 100);
                                opacityValue.textContent = `${displayValue}%`;
                                console.log(`Updated opacity display to: ${displayValue}%`);
                            }
                        }
                    }
                } else {
                    console.warn(`Element not found for field: ${field}`);
                }
            }
            
            // Update any preview elements
            this.updatePreviews();
        },
        
        bindAutoSave() {
            const autoSaveFields = document.querySelectorAll('.auto-save-field');
            
            autoSaveFields.forEach(field => {
                // For text inputs and textareas
                if (field.type !== 'checkbox' && field.tagName !== 'SELECT') {
                    field.addEventListener('input', () => this.scheduleAutoSave(field));
                }
                
                // For checkboxes and selects
                field.addEventListener('change', () => this.scheduleAutoSave(field));
            });
            
            // Bind publish toggle
            const publishToggle = document.getElementById('page_published');
            if (publishToggle) {
                publishToggle.addEventListener('change', () => {
                    this.updatePublishStatus(publishToggle.checked);
                    this.scheduleAutoSave(publishToggle);
                });
            }
        },
        
        updatePublishStatus(isPublished) {
            const label = document.getElementById('publish-label');
            if (label) {
                if (isPublished) {
                    label.innerHTML = '<i class="fas fa-eye me-1"></i>Published';
                    label.className = 'form-check-label fw-bold text-success';
                } else {
                    label.innerHTML = '<i class="fas fa-eye-slash me-1"></i>Draft';
                    label.className = 'form-check-label fw-bold text-warning';
                }
            }
        },
        
        scheduleAutoSave(field) {
            const fieldName = field.dataset.field;
            const statusElement = field.closest('.enhanced-field')?.querySelector('.save-status');
            
            console.log('ScheduleAutoSave called for field:', fieldName, 'value:', field.value);
            
            // Show editing status
            if (statusElement) {
                statusElement.textContent = 'Editing...';
                statusElement.className = 'save-status saving';
            }
            
            // Clear existing timeout
            if (this.saveTimeout) {
                clearTimeout(this.saveTimeout);
            }
            
            // Schedule save
            this.saveTimeout = setTimeout(() => {
                this.saveField(field);
            }, 1500); // 1.5 second delay
        },
        
        async saveField(field) {
            const fieldName = field.dataset.field;
            const statusElement = field.closest('.enhanced-field')?.querySelector('.save-status');
            let value;
            
            if (field.type === 'checkbox') {
                value = field.checked ? 1 : 0;
            } else {
                value = field.value;
            }
            
            console.log('SaveField called for:', fieldName, 'with value:', value);
            
            // Show saving status
            if (statusElement) {
                statusElement.textContent = 'Saving...';
                statusElement.className = 'save-status saving';
            }
            
            try {
                const response = await fetch(`/api/model-home/${this.currentModelSlug}/home`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        [fieldName]: value
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success status
                    if (statusElement) {
                        statusElement.textContent = 'Saved';
                        statusElement.className = 'save-status saved';
                        
                        // Hide success message after 3 seconds
                        setTimeout(() => {
                            statusElement.textContent = '';
                            statusElement.className = 'save-status';
                        }, 3000);
                    }
                    
                    // Update previews if needed
                    this.updatePreviews();
                    
                } else {
                    throw new Error(result.message || 'Save failed');
                }
                
            } catch (error) {
                console.error('Save error:', error);
                
                // Show error status
                if (statusElement) {
                    statusElement.textContent = 'Save failed';
                    statusElement.className = 'save-status error';
                }
            }
        },
        
        async loadGalleryOptions() {
            try {
                // Load approved gallery images for portrait selection
                const imagesResponse = await fetch(`/api/model-gallery/${this.currentModelSlug}/available-images?status=approved&context=public_site`);
                const imagesData = await imagesResponse.json();
                
                if (imagesData.success && imagesData.data && imagesData.data.images) {
                    const portraitSelect = document.getElementById('portrait_image_id');
                    const heroBackgroundSelect = document.getElementById('hero_background_image_id');
                    
                    // Store image data for alt text population
                    this.imageData = {};
                    
                    imagesData.data.images.forEach(image => {
                        // Add option to portrait dropdown
                        const portraitOption = document.createElement('option');
                        portraitOption.value = image.id;
                        portraitOption.textContent = `${image.filename} (${image.moderation_status || 'approved'})`;
                        portraitSelect.appendChild(portraitOption);
                        
                        // Add option to hero background dropdown
                        const backgroundOption = document.createElement('option');
                        backgroundOption.value = image.id;
                        backgroundOption.textContent = `${image.filename}`;
                        heroBackgroundSelect.appendChild(backgroundOption);
                        
                        // Store image data for later use
                        this.imageData[image.id] = {
                            filename: image.filename,
                            caption: image.caption,
                            alt_text: image.alt_text
                        };
                    });
                    
                    // Add change event listener to update preview and alt text
                    portraitSelect.addEventListener('change', () => {
                        console.log(`🔍 Portrait selection changed:`);
                        console.log(`   - Selected value: ${portraitSelect.value}`);
                        console.log(`   - Selected text: ${portraitSelect.selectedOptions[0]?.textContent}`);
                        console.log(`   - Image data:`, this.imageData[portraitSelect.value]);
                        
                        this.updatePortraitPreview();
                        this.updatePortraitAltText();
                        // Also save the selection if it's an auto-save field
                        if (portraitSelect.classList.contains('auto-save-field')) {
                            this.scheduleAutoSave(portraitSelect);
                        }
                    });
                    
                    // Add change event listener for hero background image
                    heroBackgroundSelect.addEventListener('change', () => {
                        this.updateHeroBackgroundPreview();
                        // Also save the selection if it's an auto-save field
                        if (heroBackgroundSelect.classList.contains('auto-save-field')) {
                            this.scheduleAutoSave(heroBackgroundSelect);
                        }
                    });
                    
                    // Set the selected value from content data if available
                    if (this.contentData && this.contentData.portrait_image_id) {
                        portraitSelect.value = this.contentData.portrait_image_id;
                        console.log('Set portrait image selection to:', this.contentData.portrait_image_id);
                        this.updatePortraitPreview();
                    }
                    
                    // Set hero background selection from content data if available
                    if (this.contentData && this.contentData.hero_background_image_id) {
                        heroBackgroundSelect.value = this.contentData.hero_background_image_id;
                        console.log('Set hero background image selection to:', this.contentData.hero_background_image_id);
                        this.updateHeroBackgroundPreview();
                    }
                }
                
                // Load gallery sections for featured gallery selection
                const sectionsResponse = await fetch(`/api/model-gallery-sections/${this.currentModelSlug}`);
                const sectionsData = await sectionsResponse.json();
                
                if (sectionsData.success && sectionsData.sections) {
                    const gallerySelect = document.getElementById('featured_gallery_section_id');
                    sectionsData.sections.forEach(section => {
                        const option = document.createElement('option');
                        option.value = section.id;
                        option.textContent = `${section.title} (${section.images?.length || 0} images)`;
                        gallerySelect.appendChild(option);
                    });
                    
                    // Set the selected value from content data if available
                    if (this.contentData && this.contentData.featured_gallery_section_id) {
                        gallerySelect.value = this.contentData.featured_gallery_section_id;
                        console.log('Set featured gallery selection to:', this.contentData.featured_gallery_section_id);
                    }
                }
                
            } catch (error) {
                console.error('Error loading gallery options:', error);
            }
        },
        
        updatePreviews() {
            this.updatePortraitPreview();
            this.updateGalleryPreview();
            this.updateHeroBackgroundPreview();
        },
        
        updatePortraitPreview() {
            const portraitSelect = document.getElementById('portrait_image_id');
            const preview = document.getElementById('portrait-preview');
            const previewImg = document.getElementById('portrait-preview-img');
            
            console.log(`🔍 updatePortraitPreview called:`);
            console.log(`   - Portrait select value: ${portraitSelect.value}`);
            console.log(`   - Has selected option: ${!!portraitSelect.selectedOptions[0]}`);
            
            if (portraitSelect.value && portraitSelect.selectedOptions[0]) {
                // Get filename from the selected option text
                const selectedText = portraitSelect.selectedOptions[0].textContent;
                const filename = selectedText.split(' (')[0]; // Extract filename before " (approved)"
                
                console.log(`   - Selected text: "${selectedText}"`);
                console.log(`   - Extracted filename: "${filename}"`);
                console.log(`   - Model slug: ${this.currentModelSlug}`);
                
                // Show preview with actual image - use the correct gallery path
                const imageUrl = `/uploads/${this.currentModelSlug}/public/gallery/${filename}`;
                console.log(`   - Constructed image URL: "${imageUrl}"`);
                
                preview.classList.remove('d-none');
                previewImg.src = imageUrl;
                
                previewImg.onload = () => {
                    console.log(`✅ Image loaded successfully: ${imageUrl}`);
                };
                
                previewImg.onerror = () => {
                    console.log(`❌ Primary image failed to load: ${imageUrl}`);
                    // Fallback to thumbs if gallery doesn't exist
                    const thumbUrl = `/uploads/${this.currentModelSlug}/thumbs/${filename}`;
                    console.log(`   - Trying thumb fallback: ${thumbUrl}`);
                    previewImg.src = thumbUrl;
                    
                    previewImg.onerror = () => {
                        console.log(`❌ Thumb fallback failed: ${thumbUrl}`);
                        // Final fallback to originals
                        const originalUrl = `/uploads/${this.currentModelSlug}/originals/${filename}`;
                        console.log(`   - Trying original fallback: ${originalUrl}`);
                        previewImg.src = originalUrl;
                        
                        previewImg.onerror = () => {
                            console.log(`❌ All fallbacks failed for: ${filename}`);
                        };
                    };
                };
            } else {
                console.log(`   - No portrait selected, hiding preview`);
                preview.classList.add('d-none');
            }
        },
        
        updateGalleryPreview() {
            const gallerySelect = document.getElementById('featured_gallery_section_id');
            const preview = document.getElementById('gallery-preview');
            
            if (gallerySelect.value) {
                preview.classList.remove('d-none');
                // In real implementation, load gallery section images
            } else {
                preview.classList.add('d-none');
            }
        },
        
        updateHeroBackgroundPreview() {
            const backgroundSelect = document.getElementById('hero_background_image_id');
            const preview = document.getElementById('hero-background-preview');
            const previewImg = document.getElementById('hero-background-preview-img');
            
            if (backgroundSelect.value && backgroundSelect.selectedOptions[0]) {
                // Get filename from the selected option text
                const selectedText = backgroundSelect.selectedOptions[0].textContent;
                const filename = selectedText.split(' (')[0]; // Extract filename
                
                // Show preview with actual image - use the correct gallery path
                preview.classList.remove('d-none');
                previewImg.src = `/uploads/${this.currentModelSlug}/public/gallery/${filename}`;
                previewImg.onerror = () => {
                    // Fallback to thumbs if gallery doesn't exist
                    previewImg.src = `/uploads/${this.currentModelSlug}/thumbs/${filename}`;
                    previewImg.onerror = () => {
                        // Final fallback to originals
                        previewImg.src = `/uploads/${this.currentModelSlug}/originals/${filename}`;
                    };
                };
            } else {
                preview.classList.add('d-none');
            }
        },
        
        initOpacitySlider() {
            const opacitySlider = document.getElementById('hero_background_opacity');
            const opacityValue = document.getElementById('opacity-value');
            
            if (opacitySlider && opacityValue) {
                // Update display when slider changes
                opacitySlider.addEventListener('input', (e) => {
                    const value = Math.round(parseFloat(e.target.value) * 100);
                    opacityValue.textContent = `${value}%`;
                });
                
                // Initialize display
                const currentValue = Math.round(parseFloat(opacitySlider.value) * 100);
                opacityValue.textContent = `${currentValue}%`;
            }
        },
        
        updatePortraitAltText() {
            const portraitSelect = document.getElementById('portrait_image_id');
            const altTextField = document.getElementById('portrait_alt');
            
            if (portraitSelect.value && this.imageData && this.imageData[portraitSelect.value]) {
                const imageData = this.imageData[portraitSelect.value];
                // Use caption first, fallback to existing alt_text, or generate from filename
                let altText = imageData.caption || imageData.alt_text || '';
                
                // If no caption/alt_text, generate from filename
                if (!altText) {
                    altText = imageData.filename
                        .replace(/\.[^/.]+$/, '') // Remove extension
                        .replace(/_/g, ' ') // Replace underscores with spaces
                        .replace(/([A-Z])/g, ' $1') // Add space before capital letters
                        .replace(/\s+/g, ' ') // Collapse multiple spaces
                        .trim()
                        .toLowerCase()
                        .replace(/^./, char => char.toUpperCase()); // Capitalize first letter
                }
                
                // Set the alt text field value
                altTextField.value = altText;
                console.log('Auto-populated alt text:', altText);
                
                // Trigger auto-save for the alt text field
                if (altTextField.classList.contains('auto-save-field')) {
                    this.scheduleAutoSave(altTextField);
                }
            }
        },
        
        showLoading() {
            this.isLoading = true;
            const statusEl = document.getElementById('auto-save-status');
            const statusText = document.getElementById('save-status-text');
            
            statusText.textContent = 'Loading content...';
            statusEl.classList.remove('d-none', 'alert-success', 'alert-danger');
            statusEl.classList.add('alert-info');
        },
        
        hideLoading() {
            this.isLoading = false;
            const statusEl = document.getElementById('auto-save-status');
            statusEl.classList.add('d-none');
        },
        
        showError(message) {
            const statusEl = document.getElementById('auto-save-status');
            const statusText = document.getElementById('save-status-text');
            
            statusText.textContent = message;
            statusEl.classList.remove('d-none', 'alert-info', 'alert-success');
            statusEl.classList.add('alert-danger');
            
            setTimeout(() => {
                statusEl.classList.add('d-none');
            }, 5000);
        }
    };
    
    // Initialize the editor
    homePageEditor.init();
});
</script>