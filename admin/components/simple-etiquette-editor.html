<!-- Simple Etiquette Page Editor -->
<div class="container-fluid py-4">
    <div class="row mb-3">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-1"><i class="fas fa-scale-balanced text-primary me-2"></i>Etiquette Page Editor</h1>
                <div class="text-muted small">Edit etiquette page content and settings</div>
            </div>
            <div class="d-flex gap-2">
                <button id="saveBtn" class="btn btn-primary" disabled>
                    <i class="fas fa-save me-2"></i>Save Changes
                </button>
                <a href="#" onclick="window.history.back()" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Content Hub
                </a>
            </div>
        </div>
    </div>

    <!-- Page Header Settings -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-heading me-2"></i>Page Header</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="etiquetteHeaderVisible">
                            <label class="form-check-label" for="etiquetteHeaderVisible">Show Header</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Page Title</label>
                                <input type="text" class="form-control" id="pageTitle" placeholder="Etiquette & Guidelines">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Page Subtitle</label>
                                <input type="text" class="form-control" id="pageSubtitle" placeholder="Important guidelines for our time together">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label">Page Subtext</label>
                                <textarea class="form-control" id="pageSubtext" rows="2" placeholder="Additional introductory text"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sections -->
    <div class="row">
        <!-- Section 1 -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-calendar-alt me-2"></i>Section 1 (Booking Process)</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="section1Visible">
                            <label class="form-check-label" for="section1Visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" id="section1Title" placeholder="Booking Process">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Content</label>
                        <textarea class="form-control" id="section1Body" rows="6" placeholder="Enter content for this section..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2 -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-handshake me-2"></i>Section 2 (Mutual Respect)</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="section2Visible">
                            <label class="form-check-label" for="section2Visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" id="section2Title" placeholder="Mutual Respect">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Content</label>
                        <textarea class="form-control" id="section2Body" rows="6" placeholder="Enter content for this section..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3 -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-shower me-2"></i>Section 3 (Preparation & Hygiene)</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="section3Visible">
                            <label class="form-check-label" for="section3Visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" id="section3Title" placeholder="Preparation & Hygiene">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Content</label>
                        <textarea class="form-control" id="section3Body" rows="6" placeholder="Enter content for this section..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4 -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-exclamation-triangle me-2"></i>Section 4 (Additional Guidelines)</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="section4Visible">
                            <label class="form-check-label" for="section4Visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" id="section4Title" placeholder="Additional Guidelines">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Content</label>
                        <textarea class="form-control" id="section4Body" rows="6" placeholder="Enter content for this section..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5 -->
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-shield-alt me-2"></i>Section 5 (Safety & Discretion)</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="section5Visible">
                            <label class="form-check-label" for="section5Visible">Visible</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" id="section5Title" placeholder="Safety & Discretion">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label">Content</label>
                                <textarea class="form-control" id="section5Body" rows="4" placeholder="Enter content for this section..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-bullhorn me-2"></i>Call to Action</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="ctaVisible">
                            <label class="form-check-label" for="ctaVisible">Show CTA</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">CTA Title</label>
                                <input type="text" class="form-control" id="ctaTitle" placeholder="Questions?">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-control" id="ctaButtonText" placeholder="Contact Me">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Button Link</label>
                                <select class="form-control" id="ctaButtonLink">
                                    <option value="contact">Contact</option>
                                    <option value="calendar">Calendar</option>
                                    <option value="rates">Rates</option>
                                    <option value="about">About</option>
                                    <option value="gallery">Gallery</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label">CTA Body Text</label>
                                <textarea class="form-control" id="ctaBody" rows="3" placeholder="If you have any questions about these guidelines..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Section -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong><i class="fas fa-images me-2"></i>Gallery Section</strong>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="galleryVisible">
                            <label class="form-check-label" for="galleryVisible">Show Gallery</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Gallery Title</label>
                                <input type="text" class="form-control" id="galleryTitle" placeholder="Professional Standards">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Gallery Section</label>
                                <select class="form-control" id="gallerySectionId">
                                    <option value="">Select a gallery section...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
(function(){
    const slug = window.location.pathname.split('/')[1] || 'modelexample';
    let hasChanges = false;
    let originalData = {};

    // Form elements
    const formElements = [
        'pageTitle', 'pageSubtitle', 'pageSubtext', 'etiquetteHeaderVisible',
        'section1Title', 'section1Body', 'section1Visible',
        'section2Title', 'section2Body', 'section2Visible', 
        'section3Title', 'section3Body', 'section3Visible',
        'section4Title', 'section4Body', 'section4Visible',
        'section5Title', 'section5Body', 'section5Visible',
        'ctaTitle', 'ctaBody', 'ctaButtonText', 'ctaButtonLink', 'ctaVisible',
        'galleryTitle', 'gallerySectionId', 'galleryVisible'
    ];

    // Load current data
    async function loadData() {
        try {
            const response = await fetch(`/api/etiquette-simple/${slug}/etiquette`);
            const result = await response.json();
            
            if (result.success && result.data) {
                const data = result.data;
                originalData = { ...data };

                // Populate form fields
                document.getElementById('pageTitle').value = data.page_title || '';
                document.getElementById('pageSubtitle').value = data.page_subtitle || '';
                document.getElementById('pageSubtext').value = data.page_subtext || '';
                document.getElementById('etiquetteHeaderVisible').checked = !!data.etiquette_header_visible;

                document.getElementById('section1Title').value = data.section_1_title || '';
                document.getElementById('section1Body').value = data.section_1_body || '';
                document.getElementById('section1Visible').checked = !!data.section_1_visible;

                document.getElementById('section2Title').value = data.section_2_title || '';
                document.getElementById('section2Body').value = data.section_2_body || '';
                document.getElementById('section2Visible').checked = !!data.section_2_visible;

                document.getElementById('section3Title').value = data.section_3_title || '';
                document.getElementById('section3Body').value = data.section_3_body || '';
                document.getElementById('section3Visible').checked = !!data.section_3_visible;

                document.getElementById('section4Title').value = data.section_4_title || '';
                document.getElementById('section4Body').value = data.section_4_body || '';
                document.getElementById('section4Visible').checked = !!data.section_4_visible;

                document.getElementById('section5Title').value = data.section_5_title || '';
                document.getElementById('section5Body').value = data.section_5_body || '';
                document.getElementById('section5Visible').checked = !!data.section_5_visible;

                document.getElementById('ctaTitle').value = data.cta_title || '';
                document.getElementById('ctaBody').value = data.cta_body || '';
                document.getElementById('ctaButtonText').value = data.cta_button_text || '';
                document.getElementById('ctaButtonLink').value = data.cta_button_link || 'contact';
                document.getElementById('ctaVisible').checked = !!data.cta_visible;

                document.getElementById('galleryTitle').value = data.gallery_title || '';
                document.getElementById('gallerySectionId').value = data.gallery_section_id || '';
                document.getElementById('galleryVisible').checked = !!data.gallery_visible;
            }
        } catch (error) {
            console.error('Error loading etiquette data:', error);
        }
    }

    // Load gallery sections for dropdown
    async function loadGallerySections() {
        try {
            const response = await fetch(`/api/model-gallery/${slug}/sections`);
            const result = await response.json();
            
            if (result.success && result.data) {
                const select = document.getElementById('gallerySectionId');
                select.innerHTML = '<option value="">Select a gallery section...</option>';
                
                result.data.forEach(section => {
                    const option = document.createElement('option');
                    option.value = section.id;
                    option.textContent = section.title;
                    select.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Error loading gallery sections:', error);
        }
    }

    // Save data
    async function saveData() {
        try {
            const data = {};
            
            // Collect form data
            data.page_title = document.getElementById('pageTitle').value;
            data.page_subtitle = document.getElementById('pageSubtitle').value;
            data.page_subtext = document.getElementById('pageSubtext').value;
            data.etiquette_header_visible = document.getElementById('etiquetteHeaderVisible').checked ? 1 : 0;

            data.section_1_title = document.getElementById('section1Title').value;
            data.section_1_body = document.getElementById('section1Body').value;
            data.section_1_visible = document.getElementById('section1Visible').checked ? 1 : 0;

            data.section_2_title = document.getElementById('section2Title').value;
            data.section_2_body = document.getElementById('section2Body').value;
            data.section_2_visible = document.getElementById('section2Visible').checked ? 1 : 0;

            data.section_3_title = document.getElementById('section3Title').value;
            data.section_3_body = document.getElementById('section3Body').value;
            data.section_3_visible = document.getElementById('section3Visible').checked ? 1 : 0;

            data.section_4_title = document.getElementById('section4Title').value;
            data.section_4_body = document.getElementById('section4Body').value;
            data.section_4_visible = document.getElementById('section4Visible').checked ? 1 : 0;

            data.section_5_title = document.getElementById('section5Title').value;
            data.section_5_body = document.getElementById('section5Body').value;
            data.section_5_visible = document.getElementById('section5Visible').checked ? 1 : 0;

            data.cta_title = document.getElementById('ctaTitle').value;
            data.cta_body = document.getElementById('ctaBody').value;
            data.cta_button_text = document.getElementById('ctaButtonText').value;
            data.cta_button_link = document.getElementById('ctaButtonLink').value;
            data.cta_visible = document.getElementById('ctaVisible').checked ? 1 : 0;

            data.gallery_title = document.getElementById('galleryTitle').value;
            data.gallery_section_id = document.getElementById('gallerySectionId').value || null;
            data.gallery_visible = document.getElementById('galleryVisible').checked ? 1 : 0;

            const response = await fetch(`/api/etiquette-simple/${slug}/etiquette`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            
            if (result.success) {
                hasChanges = false;
                document.getElementById('saveBtn').disabled = true;
                
                // Show success message
                const btn = document.getElementById('saveBtn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check me-2"></i>Saved!';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-primary');
                }, 2000);
            } else {
                console.error('Save failed:', result.message);
                alert('Failed to save changes: ' + result.message);
            }
        } catch (error) {
            console.error('Error saving etiquette data:', error);
            alert('Failed to save changes. Please try again.');
        }
    }

    // Track changes
    function trackChanges() {
        formElements.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', () => {
                    hasChanges = true;
                    document.getElementById('saveBtn').disabled = false;
                });
                element.addEventListener('change', () => {
                    hasChanges = true;
                    document.getElementById('saveBtn').disabled = false;
                });
            }
        });
    }

    // Save button event
    document.getElementById('saveBtn').addEventListener('click', saveData);

    // Initialize
    async function init() {
        await loadData();
        await loadGallerySections();
        trackChanges();
    }

    init();
})();
</script>
