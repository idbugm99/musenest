<!-- Content Management Hub - RoseMastos Style -->
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin">Admin</a></li>
                    <li class="breadcrumb-item"><a href="#" id="model-link">Model Admin</a></li>
                    <li class="breadcrumb-item active">Content Management</li>
                </ol>
            </nav>
            
            <h1 class="h3 mb-2 text-gray-800">
                <i class="fas fa-file-alt text-primary me-2"></i>
                Content Management Hub
            </h1>
            <p class="text-muted mb-4">Choose which page content to edit for <strong id="hub-model-name">your model</strong></p>
            
            <!-- Quick Stats -->
            <div class="row mb-4" id="content-stats">
                <div class="col-md-3">
                    <div class="card border-0 bg-primary bg-opacity-10 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-file-text text-primary fs-4 mb-2"></i>
                            <div class="h6 mb-1 text-primary fw-bold" id="total-pages">6</div>
                            <div class="text-muted small">Total Pages</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-success bg-opacity-10 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-check-circle text-success fs-4 mb-2"></i>
                            <div class="h6 mb-1 text-success fw-bold" id="completed-pages">0</div>
                            <div class="text-muted small">Content Added</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-warning bg-opacity-10 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-clock text-warning fs-4 mb-2"></i>
                            <div class="h6 mb-1 text-warning fw-bold" id="draft-pages">0</div>
                            <div class="text-muted small">Drafts</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-info bg-opacity-10 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-eye text-info fs-4 mb-2"></i>
                            <div class="h6 mb-1 text-info fw-bold" id="published-pages">0</div>
                            <div class="text-muted small">Published</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Hub Note -->
            <div class="alert alert-info d-flex align-items-center mb-4">
                <i class="fas fa-info-circle me-2"></i>
                <div>
                    <strong>Professional Content Management:</strong> Each page has its own dedicated editor with sections, real-time saving, and visual feedback. Click on any page below to start editing.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Content Management Grid -->
    <div class="row g-4" id="content-pages-grid">
        <!-- Home Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="home">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-primary bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-home text-primary" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="home">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-primary">Home Page</h4>
                            </div>
                            <p class="text-muted mb-4">Edit hero section, about preview, gallery showcase, testimonials, and call-to-action content</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-primary">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="home">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="about">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-info bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-user text-info" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="about">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-info">About Page</h4>
                            </div>
                            <p class="text-muted mb-4">Edit personal information, services, interests, professional portrait, and call-to-action sections</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-info">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="about">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gallery Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="gallery">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-success bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-images text-success" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="gallery">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-success">Gallery Page</h4>
                            </div>
                            <p class="text-muted mb-4">Manage gallery sections, layouts, image organization, and display settings</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-success">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="gallery">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Rates Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="rates">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-warning bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-dollar-sign text-warning" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="rates">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-warning">Rates Page</h4>
                            </div>
                            <p class="text-muted mb-4">Edit pricing tables, packages, terms, donation information, and service descriptions</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-warning">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="rates">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Etiquette Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="etiquette">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-secondary bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-list-check text-secondary" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="etiquette">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-secondary">Etiquette Page</h4>
                            </div>
                            <p class="text-muted mb-4">Manage guidelines, expectations, professional standards, and booking requirements</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-secondary">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="etiquette">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Page -->
        <div class="col-12 col-lg-6 col-xl-4">
            <div class="content-page-card h-100" data-page="contact">
                <div class="card h-100 border-0 shadow-sm hover-lift">
                    <div class="card-body bg-danger bg-opacity-10 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10">
                            <i class="fas fa-envelope text-danger" style="font-size: 4rem;"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-3">
                            <span class="badge bg-secondary content-status" data-page="contact">Draft</span>
                        </div>
                        <div class="position-relative">
                            <div class="text-center mb-3 mt-2">
                                <h4 class="mb-0 text-danger">Contact Page</h4>
                            </div>
                            <p class="text-muted mb-4">Edit contact forms, direct contact info, guidelines, location details, and privacy settings</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center text-danger">
                                    <span class="small fw-medium">Manage Content</span>
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </div>
                                <div class="content-progress" data-page="contact">
                                    <small class="text-muted">0% complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="h5 text-center mb-4 text-muted">Quick Actions</h3>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <button type="button" class="btn btn-primary" onclick="contentHub.showSitePreview()">
                    <i class="fas fa-eye me-2"></i>
                    Preview Site
                </button>
                <a href="/admin/gallery" class="btn btn-outline-primary">
                    <i class="fas fa-images me-2"></i>
                    Gallery Management
                </a>
                <a href="/admin/testimonials" class="btn btn-outline-success">
                    <i class="fas fa-quote-left me-2"></i>
                    Testimonials
                </a>
                <a href="/admin/settings" class="btn btn-outline-info">
                    <i class="fas fa-cog me-2"></i>
                    Site Settings
                </a>
                <a href="/admin/themes" class="btn btn-outline-warning">
                    <i class="fas fa-palette me-2"></i>
                    Themes & Colors
                </a>
            </div>
        </div>
    </div>
    
    <!-- Preview Modal -->
    <div class="modal fade" id="sitePreviewModal" tabindex="-1" aria-labelledby="sitePreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sitePreviewModalLabel">
                        <i class="fas fa-eye me-2"></i>Site Preview
                    </h5>
                    <div class="d-flex gap-2 me-3">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="contentHub.openSiteInNewTab()">
                            <i class="fas fa-external-link-alt me-1"></i>Open Site
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="previewPagesDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-list me-1"></i>Pages
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('home')">🏠 Home</a></li>
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('about')">👤 About</a></li>
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('gallery')">🖼️ Gallery</a></li>
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('rates')">💰 Rates</a></li>
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('etiquette')">📋 Etiquette</a></li>
                                <li><a class="dropdown-item" href="#" onclick="contentHub.previewPage('contact')">✉️ Contact</a></li>
                            </ul>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="d-flex justify-content-center align-items-center" style="height: 400px;" id="previewLoader">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="text-muted">Loading preview...</div>
                        </div>
                    </div>
                    <iframe id="sitePreviewFrame" src="" style="width: 100%; height: 600px; border: none; display: none;"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for Content Hub -->
<style>
.content-page-card {
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
}

.content-page-card:hover {
    transform: translateY(-5px);
}

.hover-lift {
    transition: all 0.3s ease;
}

.hover-lift:hover {
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}


.opacity-10 {
    opacity: 0.1;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentHub = {
        currentModelSlug: null,
        
        init() {
            this.loadModelInfo();
            this.bindPageCardClicks();
            this.loadContentStatus();
        },
        
        async loadModelInfo() {
            try {
                // Extract model slug from current URL
                const pathParts = window.location.pathname.split('/');
                this.currentModelSlug = pathParts[1]; // Assuming /{slug}/admin format
                
                // Update model name and navigation links
                const modelNameElement = document.getElementById('hub-model-name');
                const modelLinkElement = document.getElementById('model-link');
                
                if (modelNameElement) {
                    modelNameElement.textContent = this.currentModelSlug || 'your model';
                }
                
                if (modelLinkElement) {
                    modelLinkElement.href = `/${this.currentModelSlug}/admin`;
                    modelLinkElement.textContent = `${this.currentModelSlug} Admin`;
                }
                
                console.log('Content Hub initialized for model:', this.currentModelSlug);
            } catch (error) {
                console.error('Error loading model info:', error);
            }
        },
        
        async loadContentStatus() {
            try {
                const pages = ['home', 'about', 'gallery', 'rates', 'etiquette', 'contact'];
                let completedPages = 0;
                let draftPages = 0;
                let publishedPages = 0;
                
                for (const pageType of pages) {
                    try {
                        let isPublished = false;
                        let completionPercent = 0;
                        
                        // Use the correct page-specific API for each page type
                        let response, data;
                        
                        if (pageType === 'rates') {
                            // Rates page has its own dedicated API
                            response = await fetch(`/api/model-rates/${this.currentModelSlug}/page-content`);
                        } else {
                            // Other pages use the generic content API
                            response = await fetch(`/api/model-content-new/${this.currentModelSlug}/${pageType}`);
                        }
                        
                        data = await response.json();
                        
                        if (data.success && data.data) {
                            const contentCount = Object.keys(data.data).length;
                            const filledFields = Object.values(data.data).filter(value => 
                                value && value.toString().trim().length > 0
                            ).length;
                            
                            completionPercent = contentCount > 0 ? Math.round((filledFields / contentCount) * 100) : 0;
                            const publishedVal = data.data.page_published;
                            isPublished = publishedVal === true || publishedVal === 1 || publishedVal === '1' || publishedVal === 'true' || publishedVal === 'on';
                            console.log(`${pageType} status: published=${publishedVal} → ${isPublished}, completion=${completionPercent}%`);
                        }
                        
                        // Update page status
                        this.updatePageStatus(pageType, completionPercent, isPublished);
                        
                        // Count for summary stats
                        if (completionPercent >= 50) {
                            completedPages++;
                        }
                        if (!isPublished) {
                            draftPages++;
                        }
                        if (isPublished) {
                            publishedPages++;
                        }
                        
                    } catch (pageError) {
                        console.warn(`Error loading ${pageType} status:`, pageError);
                        this.updatePageStatus(pageType, 0, false);
                        draftPages++;
                    }
                }
                
                // Update summary stats
                document.getElementById('completed-pages').textContent = completedPages;
                document.getElementById('draft-pages').textContent = draftPages;
                document.getElementById('published-pages').textContent = publishedPages;
                
            } catch (error) {
                console.error('Error loading content status:', error);
            }
        },
        
        updatePageStatus(pageType, completionPercent, isPublished = false) {
            const statusBadge = document.querySelector(`[data-page="${pageType}"].content-status`);
            const progressText = document.querySelector(`[data-page="${pageType}"].content-progress small`);
            
            if (statusBadge) {
                statusBadge.classList.remove('bg-secondary', 'bg-warning', 'bg-success', 'bg-primary');
                
                if (isPublished) {
                    statusBadge.classList.add('bg-success');
                    statusBadge.textContent = 'Published';
                } else {
                    statusBadge.classList.add('bg-warning');
                    statusBadge.textContent = 'Draft';
                }
            }
            
            if (progressText) {
                const statusText = isPublished ? 'Published' : `${completionPercent}% complete`;
                progressText.textContent = statusText;
                progressText.classList.remove('text-muted', 'text-warning', 'text-success', 'text-primary');
                
                if (isPublished) {
                    progressText.classList.add('text-success');
                } else {
                    progressText.classList.add('text-warning');
                }
            }
        },
        
        bindPageCardClicks() {
            const pageCards = document.querySelectorAll('.content-page-card');
            
            pageCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageType = card.dataset.page;
                    this.navigateToPageEditor(pageType);
                });
                
                // Add visual feedback on hover
                card.addEventListener('mouseenter', () => {
                    card.style.cursor = 'pointer';
                });
            });
        },
        
        navigateToPageEditor(pageType) {
            if (!this.currentModelSlug) {
                console.error('No model slug available');
                return;
            }
            
            // Navigate to the specific page editor
            const editorUrl = `/${this.currentModelSlug}/admin/content/${pageType}`;
            
            // Add visual feedback before navigation
            const card = document.querySelector(`[data-page="${pageType}"]`);
            if (card) {
                card.style.opacity = '0.8';
                card.style.transform = 'scale(0.98)';
            }
            
            // Navigate after brief delay for visual feedback
            setTimeout(() => {
                window.location.href = editorUrl;
            }, 150);
        },
        
        showPagePreview(pageType) {
            // Future enhancement: show preview modal
            console.log('Preview for page:', pageType);
        },
        
        showSitePreview() {
            const modal = new bootstrap.Modal(document.getElementById('sitePreviewModal'));
            this.previewPage('home'); // Default to home page
            modal.show();
        },
        
        previewPage(pageType) {
            const loader = document.getElementById('previewLoader');
            const iframe = document.getElementById('sitePreviewFrame');
            
            // Show loader
            loader.style.display = 'flex';
            iframe.style.display = 'none';
            
            // Update modal title
            const modalTitle = document.getElementById('sitePreviewModalLabel');
            modalTitle.innerHTML = `<i class="fas fa-eye me-2"></i>Site Preview - ${pageType.charAt(0).toUpperCase() + pageType.slice(1)} Page`;
            
            // Load the page in iframe
            const previewUrl = `/${this.currentModelSlug}/${pageType === 'home' ? '' : pageType}`;
            iframe.src = previewUrl;
            
            // Handle iframe load
            iframe.onload = () => {
                loader.style.display = 'none';
                iframe.style.display = 'block';
            };
            
            // Handle iframe error
            iframe.onerror = () => {
                loader.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-warning fs-1 mb-3"></i>
                        <div class="text-muted">Failed to load preview</div>
                        <small class="text-muted">The ${pageType} page may not be available yet</small>
                    </div>
                `;
            };
        },
        
        openSiteInNewTab() {
            const siteUrl = `/${this.currentModelSlug}`;
            window.open(siteUrl, '_blank');
        }
    };
    
    // Initialize the content hub
    contentHub.init();
});
</script>