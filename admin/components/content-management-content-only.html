<div id="content-management-section" class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Header Section -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="mb-1 fw-bold text-primary">
                                <i class="fas fa-edit me-3"></i>Content Management
                            </h2>
                            <p class="mb-0 text-muted">Edit and manage page content for all models</p>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-primary" onclick="contentManager.bulkActions()">
                                <i class="fas fa-tasks me-2"></i>Bulk Actions
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Statistics -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-primary">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-title">Total Content</div>
                            <div class="kpi-value" id="totalContent">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-success">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-title">Active Models</div>
                            <div class="kpi-value" id="activeModels">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-title">Last Updated</div>
                            <div class="kpi-value" id="lastUpdated">Today</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-info">
                            <i class="fas fa-file-text"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-title">Page Types</div>
                            <div class="kpi-value" id="pageTypes">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Selection -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-user-edit me-2"></i>Select Model & Page
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="modelSearch" class="form-label fw-bold">Search Models</label>
                            <div class="position-relative">
                                <input type="text" class="form-control" id="modelSearch" placeholder="Type to search models..." oninput="contentManager.filterModels()">
                                <div class="dropdown-menu w-100" id="modelDropdown" style="display: none; max-height: 300px; overflow-y: auto;">
                                    <!-- Filtered models will appear here -->
                                </div>
                            </div>
                            <small class="form-text text-muted mt-1">Type part of model name or slug to filter</small>
                        </div>
                        <div class="col-md-4">
                            <label for="pageSelect" class="form-label fw-bold">Page Type</label>
                            <select class="form-select" id="pageSelect" onchange="contentManager.loadPageContent()">
                                <option value="">Select a page type...</option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-outline-info me-2" onclick="contentManager.previewContent()" id="previewBtn" disabled>
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                            <button class="btn btn-outline-success" onclick="contentManager.exportContent()" id="exportBtn" disabled>
                                <i class="fas fa-download me-1"></i>Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Editor -->
            <div class="card shadow-sm border-0" id="contentEditorCard" style="display: none;">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold">
                            <i class="fas fa-edit me-2"></i>Content Editor
                        </h5>
                        <div>
                            <button class="btn btn-outline-secondary btn-sm me-2" onclick="contentManager.resetForm()">
                                <i class="fas fa-undo me-1"></i>Reset
                            </button>
                            <button class="btn btn-success btn-sm" onclick="contentManager.saveContent()">
                                <i class="fas fa-save me-1"></i>Save Changes
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="contentEditorForm">
                        <!-- Content fields will be dynamically loaded here -->
                    </div>
                    
                    <!-- Save Status -->
                    <div class="mt-3 pt-3 border-top">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted" id="saveStatus">
                                <i class="fas fa-info-circle me-1"></i>Make changes and click Save to update content
                            </small>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary btn-sm" onclick="contentManager.saveDraft()">
                                    <i class="fas fa-file-alt me-1"></i>Save Draft
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="contentManager.publishContent()">
                                    <i class="fas fa-globe me-1"></i>Publish
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Content Preview Modal -->
<div class="modal fade" id="contentPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>Content Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="ratio ratio-16x9">
                    <iframe id="contentPreviewFrame" src="" class="border-0"></iframe>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="contentManager.openInNewTab()">
                    <i class="fas fa-external-link-alt me-2"></i>Open in New Tab
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-tasks me-2"></i>Bulk Actions
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Select Action</label>
                    <select class="form-select" id="bulkActionSelect">
                        <option value="">Choose an action...</option>
                        <option value="export_all">Export All Content</option>
                        <option value="backup_content">Create Content Backup</option>
                        <option value="update_template">Update Content Template</option>
                        <option value="migrate_content">Migrate Content Structure</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Select Models</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllModels">
                        <label class="form-check-label fw-bold" for="selectAllModels">
                            Select All Models
                        </label>
                    </div>
                    <div id="modelCheckboxes" class="mt-2">
                        <!-- Model checkboxes will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="contentManager.executeBulkAction()">
                    <i class="fas fa-play me-2"></i>Execute Action
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Content Management Specific Styles */
.content-field {
    margin-bottom: 1.5rem;
    padding: 1rem;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background-color: #f8f9fa;
}

/* Ensure dropdowns display properly */
#modelSelect, #pageSelect {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

#pageSelect option {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Model search dropdown styling */
#modelDropdown {
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    z-index: 1000;
}

#modelDropdown .dropdown-item {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f8f9fa;
}

#modelDropdown .dropdown-item:last-child {
    border-bottom: none;
}

#modelDropdown .dropdown-item:hover {
    background-color: #f8f9fa;
}

#modelDropdown .dropdown-item:active,
#modelDropdown .dropdown-item.active {
    background-color: #0d6efd;
    color: white;
}

.content-field-header {
    display: flex;
    justify-content-between;
    align-items-center;
    margin-bottom: 0.5rem;
}

.content-field-title {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0;
}

.content-field-meta {
    font-size: 0.75rem;
    color: #6c757d;
}

.content-textarea {
    min-height: 120px;
    resize: vertical;
}

.content-textarea.large {
    min-height: 200px;
}

.json-editor {
    font-family: 'Courier New', monospace;
    background-color: #f8f9fa;
    border: 1px solid #ced4da;
}

.save-status {
    padding: 0.375rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
}

.save-status.saved {
    background-color: #d1edff;
    color: #0c63e4;
}

.save-status.saving {
    background-color: #fff3cd;
    color: #856404;
}

.save-status.error {
    background-color: #f8d7da;
    color: #721c24;
}

.content-preview {
    max-height: 300px;
    overflow-y: auto;
    padding: 1rem;
    background-color: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
}
</style>

<script>
class ContentManager {
    constructor() {
        this.models = [];
        this.pageTypes = [];
        this.selectedModel = null;
        this.selectedPageType = null;
        this.currentContent = {};
        this.originalContent = {};
        this.isDirty = false;
        
        this.init();
    }
    
    async init() {
        console.log('üöÄ Initializing Content Management...');
        await this.loadModels();
        await this.loadPageTypes();
        await this.updateStatistics();
        this.setupEventListeners();
        console.log('‚úÖ Content Management initialized successfully');
    }
    
    async loadModels() {
        try {
            const response = await sysFetch('/api/content-management/models');
            if (response.ok) {
                this.models = await response.json();
                this.renderModelSearch();
                this.renderBulkModelCheckboxes();
                console.log('‚úÖ Models loaded:', this.models.length);
            } else {
                console.error('Failed to load models');
            }
        } catch (error) {
            console.error('Error loading models:', error);
        }
    }
    
    async loadPageTypes() {
        try {
            const response = await fetch('/api/page-types');
            if (response.ok) {
                this.pageTypes = await response.json();
                this.renderPageTypeSelect();
                console.log('‚úÖ Page types loaded:', this.pageTypes.length);
            } else {
                console.error('Failed to load page types');
            }
        } catch (error) {
            console.error('Error loading page types:', error);
        }
    }
    
    renderModelSearch() {
        console.log('üîç Setting up model search interface with', this.models.length, 'models');
        this.filteredModels = [...this.models]; // Initialize with all models
        this.selectedModel = null;
        
        // Setup search input event listeners
        const searchInput = document.getElementById('modelSearch');
        if (searchInput) {
            console.log('‚úÖ Model search input found and configured');
            
            // Clear any existing value
            searchInput.value = '';
            
            // Add focus event to show all models initially
            searchInput.addEventListener('focus', () => {
                this.showModelDropdown();
            });
            
            // Add click outside to hide dropdown
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.position-relative')) {
                    this.hideModelDropdown();
                }
            });
        } else {
            console.log('‚ùå modelSearch input not found');
        }
    }
    
    filterModels() {
        const searchInput = document.getElementById('modelSearch');
        const query = searchInput.value.toLowerCase().trim();
        
        console.log('üîç Filtering models with query:', query);
        
        if (query === '') {
            // Show all models when search is empty
            this.filteredModels = [...this.models];
        } else {
            // Filter models by name or slug
            this.filteredModels = this.models.filter(model => 
                model.name.toLowerCase().includes(query) || 
                model.slug.toLowerCase().includes(query)
            );
        }
        
        console.log('üîç Filtered to', this.filteredModels.length, 'models');
        this.showModelDropdown();
    }
    
    showModelDropdown() {
        const dropdown = document.getElementById('modelDropdown');
        if (!dropdown) return;
        
        // Clear existing items
        dropdown.innerHTML = '';
        
        if (this.filteredModels.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'dropdown-item-text text-muted';
            noResults.textContent = 'No models found';
            dropdown.appendChild(noResults);
        } else {
            this.filteredModels.forEach(model => {
                const item = document.createElement('a');
                item.className = 'dropdown-item';
                item.href = '#';
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${model.name}</strong>
                            <small class="text-muted d-block">@${model.slug}</small>
                        </div>
                        <small class="text-muted">${model.status || 'active'}</small>
                    </div>
                `;
                
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.selectModel(model);
                });
                
                dropdown.appendChild(item);
            });
        }
        
        dropdown.style.display = 'block';
    }
    
    hideModelDropdown() {
        const dropdown = document.getElementById('modelDropdown');
        if (dropdown) {
            dropdown.style.display = 'none';
        }
    }
    
    selectModel(model) {
        console.log('‚úÖ Model selected:', model);
        this.selectedModel = model;
        
        // Update search input to show selected model
        const searchInput = document.getElementById('modelSearch');
        if (searchInput) {
            searchInput.value = `${model.name} (@${model.slug})`;
        }
        
        // Hide dropdown
        this.hideModelDropdown();
        
        // Enable page selection
        const pageSelect = document.getElementById('pageSelect');
        if (pageSelect) {
            pageSelect.disabled = false;
        }
        
        // Reset page selection
        if (pageSelect) {
            pageSelect.value = '';
        }
        
        this.hideContentEditor();
        
        console.log('üîÑ Model selection complete, page dropdown enabled');
    }
    
    renderPageTypeSelect() {
        const select = document.getElementById('pageSelect');
        console.log('üìã ContentManager renderPageTypeSelect - select element:', select);
        console.log('üìã ContentManager renderPageTypeSelect - pageTypes:', this.pageTypes);
        
        if (!select) {
            console.log('‚ùå pageSelect element not found in renderPageTypeSelect');
            return;
        }
        
        // Clear existing options using DOM methods
        while (select.firstChild) {
            select.removeChild(select.firstChild);
        }
        
        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select a page type...';
        select.appendChild(defaultOption);
        
        this.pageTypes.forEach(pageType => {
            const option = document.createElement('option');
            option.value = pageType.id;
            option.textContent = pageType.display_name;
            select.appendChild(option);
        });
        
        console.log('‚úÖ ContentManager page type dropdown populated with', this.pageTypes.length, 'page types');
        console.log('üîç Select options:', Array.from(select.options).map(o => o.textContent));
        console.log('üîç Select HTML:', select.outerHTML);
        
        // Force multiple re-render attempts
        select.style.display = 'none';
        select.offsetHeight;
        select.style.display = 'block';
        select.offsetHeight;
        select.style.display = '';
        
        // Try triggering events
        select.dispatchEvent(new Event('change'));
        select.dispatchEvent(new Event('focus'));
        
        // Set a specific value to test if that shows
        if (this.pageTypes.length > 0) {
            select.value = this.pageTypes[0].id;
            console.log('üîß Set select value to:', select.value);
        }
    }
    
    renderBulkModelCheckboxes() {
        const container = document.getElementById('modelCheckboxes');
        container.innerHTML = '';
        
        this.models.forEach(model => {
            const div = document.createElement('div');
            div.className = 'form-check';
            div.innerHTML = `
                <input class="form-check-input model-checkbox" type="checkbox" value="${model.id}" id="model_${model.id}">
                <label class="form-check-label" for="model_${model.id}">
                    ${model.name} (@${model.slug})
                </label>
            `;
            container.appendChild(div);
        });
    }
    
    async loadModelContent() {
        // This method is now called from selectModel() automatically
        // No additional logic needed here since selection is handled by selectModel()
        console.log('üîÑ loadModelContent called for model:', this.selectedModel?.name);
    }
    
    async loadPageContent() {
        const pageTypeId = document.getElementById('pageSelect').value;
        
        if (!this.selectedModel || !pageTypeId) {
            console.log('‚ùå Missing model or page type selection');
            return;
        }
        
        const modelId = this.selectedModel.id;
        
        this.selectedPageType = this.pageTypes.find(p => p.id == pageTypeId);
        console.log('Selected page type:', this.selectedPageType);
        
        try {
            const response = await fetch(`/api/content/${modelId}/${pageTypeId}`);
            if (response.ok) {
                this.currentContent = await response.json();
                this.originalContent = { ...this.currentContent };
                this.renderContentEditor();
                this.showContentEditor();
                
                // Enable action buttons
                document.getElementById('previewBtn').disabled = false;
                document.getElementById('exportBtn').disabled = false;
            } else {
                console.error('Failed to load content');
                this.showNotification('Failed to load content', 'error');
            }
        } catch (error) {
            console.error('Error loading content:', error);
            this.showNotification('Error loading content', 'error');
        }
    }
    
    renderContentEditor() {
        const container = document.getElementById('contentEditorForm');
        container.innerHTML = '';
        
        const contentKeys = Object.keys(this.currentContent).filter(key => key !== 'model_id' && key !== 'page_type_id');
        
        if (contentKeys.length === 0) {
            container.innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    No content found for this model/page combination. 
                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="contentManager.createDefaultContent()">
                        Create Default Content
                    </button>
                </div>
            `;
            return;
        }
        
        contentKeys.forEach(key => {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'content-field';
            
            const value = this.currentContent[key] || '';
            const fieldTitle = this.formatFieldTitle(key);
            const fieldType = this.getFieldType(key);
            
            fieldDiv.innerHTML = `
                <div class="content-field-header">
                    <div class="content-field-title">${fieldTitle}</div>
                    <div class="content-field-meta">
                        <span class="badge bg-secondary">${fieldType}</span>
                        <span class="text-muted">${key}</span>
                    </div>
                </div>
                ${this.renderField(key, value, fieldType)}
            `;
            
            container.appendChild(fieldDiv);
        });
    }
    
    renderField(key, value, fieldType) {
        switch (fieldType) {
            case 'json':
                return `
                    <textarea class="form-control json-editor" id="field_${key}" rows="6" placeholder="Enter JSON data...">${value}</textarea>
                    <small class="form-text text-muted">Valid JSON format required</small>
                `;
            case 'html':
                return `
                    <textarea class="form-control content-textarea large" id="field_${key}" placeholder="Enter HTML content...">${value}</textarea>
                    <small class="form-text text-muted">HTML tags allowed</small>
                `;
            case 'text':
            default:
                const isLarge = value.length > 100 || key.includes('paragraph') || key.includes('description');
                return `
                    <textarea class="form-control content-textarea ${isLarge ? 'large' : ''}" id="field_${key}" placeholder="Enter content...">${value}</textarea>
                `;
        }
    }
    
    formatFieldTitle(key) {
        return key.replace(/_/g, ' ')
                 .replace(/\b\w/g, l => l.toUpperCase())
                 .replace(/Id$/, 'ID');
    }
    
    getFieldType(key) {
        if (key.includes('json') || key.includes('facts')) return 'json';
        if (key.includes('html') || key.includes('content')) return 'html';
        return 'text';
    }
    
    showContentEditor() {
        document.getElementById('contentEditorCard').style.display = 'block';
    }
    
    hideContentEditor() {
        document.getElementById('contentEditorCard').style.display = 'none';
        document.getElementById('previewBtn').disabled = true;
        document.getElementById('exportBtn').disabled = true;
    }
    
    async saveContent() {
        if (!this.selectedModel || !this.selectedPageType) return;
        
        const formData = new FormData();
        const contentKeys = Object.keys(this.currentContent).filter(key => key !== 'model_id' && key !== 'page_type_id');
        
        // Collect form data
        const updatedContent = {};
        let hasChanges = false;
        
        contentKeys.forEach(key => {
            const field = document.getElementById(`field_${key}`);
            if (field) {
                const newValue = field.value.trim();
                updatedContent[key] = newValue;
                
                if (newValue !== this.originalContent[key]) {
                    hasChanges = true;
                }
            }
        });
        
        if (!hasChanges) {
            this.showNotification('No changes to save', 'info');
            return;
        }
        
        this.updateSaveStatus('Saving...', 'saving');
        
        try {
            const response = await fetch(`/api/content/${this.selectedModel.id}/${this.selectedPageType.id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedContent)
            });
            
            if (response.ok) {
                this.currentContent = { ...this.currentContent, ...updatedContent };
                this.originalContent = { ...this.currentContent };
                this.updateSaveStatus('All changes saved', 'saved');
                this.showNotification('Content saved successfully!', 'success');
                this.isDirty = false;
            } else {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error saving content:', error);
            this.updateSaveStatus('Save failed', 'error');
            this.showNotification(`Error saving content: ${error.message}`, 'error');
        }
    }
    
    updateSaveStatus(message, type) {
        const statusElement = document.getElementById('saveStatus');
        statusElement.className = `save-status ${type}`;
        statusElement.innerHTML = `<i class="fas fa-${type === 'saved' ? 'check' : type === 'saving' ? 'spinner fa-spin' : 'exclamation-triangle'} me-1"></i>${message}`;
    }
    
    async previewContent() {
        if (!this.selectedModel || !this.selectedPageType) return;
        
        const pageTypeName = this.selectedPageType.name;
        const modelSlug = this.selectedModel.slug;
        
        // Construct preview URL based on theme
        const previewUrl = `/test-basic/${pageTypeName}?model=${modelSlug}`;
        
        document.getElementById('contentPreviewFrame').src = previewUrl;
        new bootstrap.Modal(document.getElementById('contentPreviewModal')).show();
    }
    
    async exportContent() {
        if (!this.selectedModel || !this.selectedPageType) return;
        
        try {
            const response = await fetch(`/api/content/${this.selectedModel.id}/${this.selectedPageType.id}/export`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.selectedModel.slug}_${this.selectedPageType.name}_content.json`;
                a.click();
                window.URL.revokeObjectURL(url);
            }
        } catch (error) {
            console.error('Export failed:', error);
            this.showNotification('Export failed', 'error');
        }
    }
    
    resetForm() {
        if (this.isDirty && !confirm('Are you sure? You will lose unsaved changes.')) {
            return;
        }
        
        this.renderContentEditor();
        this.updateSaveStatus('Make changes and click Save to update content', '');
    }
    
    async updateStatistics() {
        // Update KPI cards with real data
        try {
            const response = await fetch('/api/content/statistics');
            if (response.ok) {
                const stats = await response.json();
                document.getElementById('totalContent').textContent = stats.totalContent || 0;
                document.getElementById('activeModels').textContent = stats.activeModels || 0;
                document.getElementById('pageTypes').textContent = stats.pageTypes || 0;
                document.getElementById('lastUpdated').textContent = stats.lastUpdated || 'Today';
            }
        } catch (error) {
            console.error('Error loading statistics:', error);
        }
    }
    
    setupEventListeners() {
        // Add change detection for form fields
        document.addEventListener('input', (e) => {
            if (e.target.id.startsWith('field_')) {
                this.isDirty = true;
                this.updateSaveStatus('Unsaved changes', '');
            }
        });
        
        // Select all models checkbox
        document.getElementById('selectAllModels').addEventListener('change', (e) => {
            const checkboxes = document.querySelectorAll('.model-checkbox');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        });
    }
    
    showNotification(message, type = 'info') {
        // Simple notification system
        const alertClass = type === 'success' ? 'alert-success' : 
                          type === 'error' ? 'alert-danger' : 'alert-info';
        
        const notification = document.createElement('div');
        notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 5000);
    }
    
    // Placeholder methods for future features
    bulkActions() {
        new bootstrap.Modal(document.getElementById('bulkActionsModal')).show();
    }
    
    executeBulkAction() {
        // Implementation for bulk actions
        console.log('Execute bulk action');
    }
    
    saveDraft() {
        // Implementation for draft saving
        console.log('Save draft');
    }
    
    publishContent() {
        // Implementation for content publishing
        this.saveContent();
    }
    
    openInNewTab() {
        const frame = document.getElementById('contentPreviewFrame');
        if (frame.src) {
            window.open(frame.src, '_blank');
        }
    }
    
    createDefaultContent() {
        // Implementation for creating default content
        console.log('Create default content');
    }
}

// Initialize when component loads
let contentManager;

function initializeContentManagement() {
    if (document.getElementById('content-management-section')) {
        if (!contentManager) {
            console.log('üìù Initializing Content Management...');
            contentManager = new ContentManager();
        }
    }
}

// Try to initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeContentManagement);
} else {
    setTimeout(initializeContentManagement, 100);
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
