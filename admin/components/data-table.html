<!-- Enhanced Data Table Component -->
<!-- Usage: Include and populate with data via JavaScript -->
<!-- Dependencies: Bootstrap 5 -->

<div class="data-table-container">
    <!-- Search and Filter Controls -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" id="table-search" placeholder="Search...">
            </div>
        </div>
        <div class="col-md-6">
            <div class="d-flex gap-2">
                <select class="form-select" id="table-filter-status">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="suspended">Suspended</option>
                </select>
                <button class="btn btn-outline-secondary" id="table-refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="data-table">
            <thead class="table-dark">
                <tr id="table-headers">
                    <!-- Headers populated by JavaScript -->
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Rows populated by JavaScript -->
            </tbody>
        </table>
    </div>
    
    <!-- Pagination -->
    <nav aria-label="Table pagination">
        <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted">
                Showing <span id="table-showing">0</span> of <span id="table-total">0</span> entries
            </div>
            <ul class="pagination mb-0" id="table-pagination">
                <!-- Pagination populated by JavaScript -->
            </ul>
        </div>
    </nav>
</div>

<script>
class DataTable {
    constructor(containerId, config) {
        this.container = document.getElementById(containerId);
        this.config = {
            endpoint: config.endpoint,
            columns: config.columns || [],
            searchable: config.searchable !== false,
            sortable: config.sortable !== false,
            filterable: config.filterable !== false,
            paginated: config.paginated !== false,
            pageSize: config.pageSize || 20,
            autoRefresh: config.autoRefresh || false,
            refreshInterval: config.refreshInterval || 30000
        };
        
        this.currentPage = 1;
        this.currentSearch = '';
        this.currentFilter = '';
        this.currentSort = '';
        this.data = [];
        
        this.init();
    }
    
    init() {
        this.setupHeaders();
        this.setupEventListeners();
        this.loadData();
        
        if (this.config.autoRefresh) {
            setInterval(() => this.loadData(), this.config.refreshInterval);
        }
    }
    
    setupHeaders() {
        const headerRow = this.container.querySelector('#table-headers');
        headerRow.innerHTML = '';
        
        this.config.columns.forEach(column => {
            const th = document.createElement('th');
            th.textContent = column.label;
            th.dataset.key = column.key;
            
            if (this.config.sortable && column.sortable !== false) {
                th.classList.add('sortable');
                th.style.cursor = 'pointer';
                th.innerHTML += ' <i class="fas fa-sort text-muted"></i>';
            }
            
            headerRow.appendChild(th);
        });
        
        // Actions column
        const actionsHeader = document.createElement('th');
        actionsHeader.textContent = 'Actions';
        actionsHeader.style.width = '120px';
        headerRow.appendChild(actionsHeader);
    }
    
    setupEventListeners() {
        // Search
        const searchInput = this.container.querySelector('#table-search');
        if (searchInput && this.config.searchable) {
            searchInput.addEventListener('input', (e) => {
                this.currentSearch = e.target.value;
                this.currentPage = 1;
                this.loadData();
            });
        }
        
        // Filter
        const filterSelect = this.container.querySelector('#table-filter-status');
        if (filterSelect && this.config.filterable) {
            filterSelect.addEventListener('change', (e) => {
                this.currentFilter = e.target.value;
                this.currentPage = 1;
                this.loadData();
            });
        }
        
        // Refresh
        const refreshBtn = this.container.querySelector('#table-refresh');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => this.loadData());
        }
        
        // Sorting
        if (this.config.sortable) {
            this.container.addEventListener('click', (e) => {
                if (e.target.classList.contains('sortable') || e.target.closest('.sortable')) {
                    const header = e.target.closest('th');
                    const key = header.dataset.key;
                    this.currentSort = this.currentSort === key ? `-${key}` : key;
                    this.loadData();
                }
            });
        }
    }
    
    async loadData() {
        try {
            const params = new URLSearchParams({
                page: this.currentPage,
                limit: this.config.pageSize,
                search: this.currentSearch,
                status: this.currentFilter,
                sort: this.currentSort
            });
            
            const response = await fetch(`${this.config.endpoint}?${params}`);
            const result = await response.json();
            
            if (result.success) {
                this.data = result.data || result.clients || result.items || [];
                this.renderTable();
                this.renderPagination(result.pagination || {});
            }
        } catch (error) {
            console.error('Failed to load table data:', error);
        }
    }
    
    renderTable() {
        const tbody = this.container.querySelector('#table-body');
        tbody.innerHTML = '';
        
        this.data.forEach(row => {
            const tr = document.createElement('tr');
            
            this.config.columns.forEach(column => {
                const td = document.createElement('td');
                
                if (column.render) {
                    td.innerHTML = column.render(row[column.key], row);
                } else {
                    td.textContent = row[column.key] || '';
                }
                
                tr.appendChild(td);
            });
            
            // Actions column
            const actionsTd = document.createElement('td');
            actionsTd.innerHTML = `
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="editItem(${row.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-info" onclick="viewItem(${row.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-danger" onclick="deleteItem(${row.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            tr.appendChild(actionsTd);
            
            tbody.appendChild(tr);
        });
    }
    
    renderPagination(pagination) {
        const showingSpan = this.container.querySelector('#table-showing');
        const totalSpan = this.container.querySelector('#table-total');
        
        if (showingSpan) showingSpan.textContent = this.data.length;
        if (totalSpan) totalSpan.textContent = pagination.total || 0;
    }
}

// Global functions for actions (to be overridden by implementing page)
function editItem(id) {
    console.log('Edit item:', id);
}

function viewItem(id) {
    console.log('View item:', id);
}

function deleteItem(id) {
    if (confirm('Are you sure you want to delete this item?')) {
        console.log('Delete item:', id);
    }
}
</script>

<style>
.sortable:hover {
    background-color: rgba(0,0,0,0.05);
}

.sortable i {
    font-size: 0.8em;
    margin-left: 5px;
}

.table-responsive {
    border-radius: 0.375rem;
    overflow: hidden;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
}
</style>