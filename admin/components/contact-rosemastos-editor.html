<!-- RoseMastos-Style Contact Page Editor -->
<div class="container-fluid py-4">
  <div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3 mb-1"><i class="fas fa-envelope text-primary me-2"></i>Contact Page Editor</h1>
        <div class="text-muted small">RoseMastos-style structured contact content management</div>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm" id="preview-btn">
          <i class="fas fa-eye me-1"></i>Preview Page
        </button>
        <button class="btn btn-primary btn-sm" id="save-all-btn">
          <i class="fas fa-save me-1"></i>Save All Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div id="alert-container"></div>

  <!-- Page Header Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-heading me-2"></i>Page Header</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_header_visible" data-field="contact_header_visible">
        <label class="form-check-label" for="contact_header_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Page Title</label>
            <input class="form-control auto-save-input" id="page_title" data-field="page_title" placeholder="Contact Me">
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Page Subtitle</label>
            <textarea class="form-control auto-save-input" id="page_subtitle" data-field="page_subtitle" rows="2" placeholder="Brief description of contact page"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Form Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-wpforms me-2"></i>Contact Form</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_form_visible" data-field="contact_form_visible">
        <label class="form-check-label" for="contact_form_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label class="form-label">Form Title</label>
        <input class="form-control auto-save-input" id="form_title" data-field="form_title" placeholder="Send a Message">
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <h6 class="text-muted mb-3">Form Field Labels</h6>
          <div class="mb-2">
            <label class="form-label small">Name Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_name_label" data-field="form_name_label" placeholder="Your Name">
          </div>
          <div class="mb-2">
            <label class="form-label small">Email Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_email_label" data-field="form_email_label" placeholder="Email Address">
          </div>
          <div class="mb-2">
            <label class="form-label small">Phone Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_phone_label" data-field="form_phone_label" placeholder="Phone Number (Optional)">
          </div>
          <div class="mb-2">
            <label class="form-label small">Date Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_date_label" data-field="form_date_label" placeholder="Preferred Date">
          </div>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted mb-3">Form Settings</h6>
          <div class="mb-2">
            <label class="form-label small">Duration Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_duration_label" data-field="form_duration_label" placeholder="Duration">
          </div>
          <div class="mb-2">
            <label class="form-label small">Duration Options (comma-separated)</label>
            <textarea class="form-control form-control-sm auto-save-input" id="form_duration_options" data-field="form_duration_options" rows="2" placeholder="1 Hour,90 Minutes,2 Hours,3 Hours,Overnight,Extended (please specify)"></textarea>
          </div>
          <div class="mb-2">
            <label class="form-label small">Message Field Label</label>
            <input class="form-control form-control-sm auto-save-input" id="form_message_label" data-field="form_message_label" placeholder="Message">
          </div>
          <div class="mb-2">
            <label class="form-label small">Message Placeholder</label>
            <textarea class="form-control form-control-sm auto-save-input" id="form_message_placeholder" data-field="form_message_placeholder" rows="2" placeholder="Please include any specific requests or questions..."></textarea>
          </div>
        </div>
      </div>
      
      <div class="mt-3">
        <label class="form-label">Form Submit Button Text</label>
        <input class="form-control auto-save-input" id="form_button_text" data-field="form_button_text" placeholder="Send Message">
      </div>
    </div>
  </div>

  <!-- Direct Contact Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-phone me-2"></i>Direct Contact</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_direct_visible" data-field="contact_direct_visible">
        <label class="form-check-label" for="contact_direct_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="direct_title" data-field="direct_title" placeholder="Direct Contact">
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-4">
          <h6 class="text-muted mb-2">Email Section</h6>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="direct_email_label" data-field="direct_email_label" placeholder="Email">
          </div>
        </div>
        <div class="col-md-4">
          <h6 class="text-muted mb-2">Phone Section</h6>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="direct_phone_label" data-field="direct_phone_label" placeholder="Phone">
          </div>
        </div>
        <div class="col-md-4">
          <h6 class="text-muted mb-2">Response Time</h6>
          <div class="mb-2">
            <input class="form-control form-control-sm auto-save-input" id="direct_response_label" data-field="direct_response_label" placeholder="Response Time">
          </div>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="direct_response_text" data-field="direct_response_text" placeholder="Within 2-4 hours">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Booking Guidelines Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-list-ul me-2"></i>Booking Guidelines</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_guidelines_visible" data-field="contact_guidelines_visible">
        <label class="form-check-label" for="contact_guidelines_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label class="form-label">Section Title</label>
        <input class="form-control auto-save-input" id="guidelines_title" data-field="guidelines_title" placeholder="Booking Guidelines">
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <h6 class="text-muted mb-2">Guidelines 1-3</h6>
          <div class="mb-2">
            <label class="form-label small">Guideline 1</label>
            <input class="form-control form-control-sm auto-save-input" id="guideline_1" data-field="guideline_1" placeholder="Include your preferred date and time">
          </div>
          <div class="mb-2">
            <label class="form-label small">Guideline 2</label>
            <input class="form-control form-control-sm auto-save-input" id="guideline_2" data-field="guideline_2" placeholder="Specify desired duration of our meeting">
          </div>
          <div class="mb-3">
            <label class="form-label small">Guideline 3</label>
            <input class="form-control form-control-sm auto-save-input" id="guideline_3" data-field="guideline_3" placeholder="Mention if you are a first-time or returning client">
          </div>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted mb-2">Guidelines 4-5</h6>
          <div class="mb-2">
            <label class="form-label small">Guideline 4</label>
            <input class="form-control form-control-sm auto-save-input" id="guideline_4" data-field="guideline_4" placeholder="Be prepared for a brief screening process">
          </div>
          <div class="mb-3">
            <label class="form-label small">Guideline 5</label>
            <input class="form-control form-control-sm auto-save-input" id="guideline_5" data-field="guideline_5" placeholder="Allow 24+ hours for booking confirmation">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Location Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-map-marker-alt me-2"></i>Location & Services</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_location_visible" data-field="contact_location_visible">
        <label class="form-check-label" for="contact_location_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="location_title" data-field="location_title" placeholder="Location">
          </div>
          <div class="mb-3">
            <label class="form-label">Service Area</label>
            <input class="form-control auto-save-input" id="location_area_text" data-field="location_area_text" placeholder="Currently serving the greater area">
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Available Services</label>
            <input class="form-control auto-save-input" id="location_services_text" data-field="location_services_text" placeholder="Incall and outcall services available">
          </div>
          <div class="mb-3">
            <label class="form-label">Travel Information</label>
            <input class="form-control auto-save-input" id="location_travel_text" data-field="location_travel_text" placeholder="Travel arrangements can be discussed">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Privacy Notice Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-shield-alt me-2"></i>Privacy & Discretion</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="contact_privacy_visible" data-field="contact_privacy_visible">
        <label class="form-check-label" for="contact_privacy_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="privacy_title" data-field="privacy_title" placeholder="Privacy & Discretion">
          </div>
        </div>
        <div class="col-md-8">
          <div class="mb-3">
            <label class="form-label">Privacy Notice Text</label>
            <textarea class="form-control auto-save-input" id="privacy_text" data-field="privacy_text" rows="3" placeholder="All communications are handled with the utmost discretion and confidentiality..."></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Auto-save system with debounced API calls
(function() {
  const modelSlug = window.location.pathname.split('/')[1];
  const apiBaseUrl = `/api/contact-rosemastos/${modelSlug}/content`;
  
  let saveTimeout;
  const DEBOUNCE_DELAY = 800;
  
  // Load existing content
  async function loadContent() {
    try {
      const response = await fetch(apiBaseUrl);
      const data = await response.json();
      
      if (response.ok) {
        // Populate all form fields
        Object.keys(data).forEach(key => {
          const element = document.getElementById(key);
          if (element) {
            if (element.type === 'checkbox') {
              element.checked = data[key];
            } else {
              element.value = data[key] || '';
            }
          }
        });
        
        showAlert('Contact content loaded successfully', 'success');
      }
    } catch (error) {
      console.error('Error loading content:', error);
      showAlert('Error loading contact content', 'error');
    }
  }
  
  // Auto-save individual field
  async function saveField(fieldName, value) {
    try {
      const response = await fetch(`${apiBaseUrl}/${fieldName}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ value })
      });
      
      const result = await response.json();
      
      if (response.ok) {
        console.log(`âœ… ${fieldName} saved:`, value);
        showAlert(`${fieldName.replace(/_/g, ' ')} saved successfully`, 'success', 2000);
      } else {
        console.error('Save error:', result.error);
        showAlert(`Error saving ${fieldName}: ${result.error}`, 'error');
      }
    } catch (error) {
      console.error('Network error:', error);
      showAlert('Network error while saving', 'error');
    }
  }
  
  // Setup auto-save event listeners
  function setupAutoSave() {
    const inputs = document.querySelectorAll('.auto-save-input');
    
    inputs.forEach(input => {
      const fieldName = input.dataset.field;
      
      const handleChange = () => {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
          const value = input.type === 'checkbox' ? input.checked : input.value;
          saveField(fieldName, value);
        }, DEBOUNCE_DELAY);
      };
      
      if (input.type === 'checkbox') {
        input.addEventListener('change', handleChange);
      } else {
        input.addEventListener('input', handleChange);
        input.addEventListener('blur', handleChange);
      }
    });
  }
  
  // Show alert message
  function showAlert(message, type, duration = 4000) {
    const alertContainer = document.getElementById('alert-container');
    const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
    
    const alertHtml = `
      <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    `;
    
    alertContainer.insertAdjacentHTML('beforeend', alertHtml);
    
    // Auto-remove after duration
    setTimeout(() => {
      const alert = alertContainer.querySelector('.alert:last-child');
      if (alert) {
        const bsAlert = new bootstrap.Alert(alert);
        bsAlert.close();
      }
    }, duration);
  }
  
  // Preview button functionality
  document.getElementById('preview-btn')?.addEventListener('click', () => {
    window.open(`/${modelSlug}/contact`, '_blank');
  });
  
  // Save all button functionality
  document.getElementById('save-all-btn')?.addEventListener('click', async () => {
    const formData = {};
    const inputs = document.querySelectorAll('.auto-save-input');
    
    inputs.forEach(input => {
      const fieldName = input.dataset.field;
      formData[fieldName] = input.type === 'checkbox' ? input.checked : input.value;
    });
    
    try {
      const response = await fetch(apiBaseUrl, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });
      
      const result = await response.json();
      
      if (response.ok) {
        showAlert('All contact content saved successfully!', 'success');
      } else {
        showAlert(`Error saving content: ${result.error}`, 'error');
      }
    } catch (error) {
      console.error('Save all error:', error);
      showAlert('Network error while saving all content', 'error');
    }
  });
  
  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    loadContent();
    setupAutoSave();
  });
  
})();
</script>

<style>
.form-control-sm {
  font-size: 0.875rem;
}

.auto-save-input:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

.card-header {
  position: relative;
}

.form-switch {
  margin-top: -2px;
}

.alert {
  margin-bottom: 1rem;
}

#alert-container .alert:last-child {
  margin-bottom: 0;
}
</style>