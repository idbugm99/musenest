<!-- RoseMastos-Style Etiquette Page Editor -->
<div class="container-fluid py-4">
  <div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3 mb-1"><i class="fas fa-scale-balanced text-primary me-2"></i>Etiquette Page Editor</h1>
        <div class="text-muted small">RoseMastos-style structured etiquette content management</div>
      </div>
      <div class="d-flex gap-2">
        <a href="#" onclick="window.history.back()" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Back to Content Hub</a>
      </div>
    </div>
  </div>

  <!-- Page Header Section -->
  <div class="card mb-4">
    <div class="card-header bg-white">
      <strong><i class="fas fa-heading me-2"></i>Page Header</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_header_visible" data-field="etiquette_header_visible">
        <label class="form-check-label" for="etiquette_header_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Page Title</label>
            <input class="form-control auto-save-input" id="page_title" data-field="page_title" placeholder="Etiquette & Guidelines">
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Page Subtitle</label>
            <textarea class="form-control auto-save-input" id="page_subtitle" data-field="page_subtitle" rows="2" placeholder="Brief description of guidelines"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Sections Grid -->
  <div class="row g-3">
    
    <!-- Booking & Screening Section -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-white">
          <strong><i class="fas fa-calendar-check me-2"></i>Booking & Screening</strong>
          <div class="form-check form-switch float-end">
            <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_booking_visible" data-field="etiquette_booking_visible">
            <label class="form-check-label" for="etiquette_booking_visible">Visible</label>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="booking_title" data-field="booking_title" placeholder="Booking & Screening">
          </div>
          
          <h6 class="text-muted mb-2">Initial Contact</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="booking_initial_contact_title" data-field="booking_initial_contact_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="booking_initial_contact_text" data-field="booking_initial_contact_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Screening Process</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="booking_screening_title" data-field="booking_screening_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="booking_screening_text" data-field="booking_screening_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Advance Booking</h6>
          <div class="row">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="booking_advance_title" data-field="booking_advance_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="booking_advance_text" data-field="booking_advance_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Respect & Boundaries Section -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-white">
          <strong><i class="fas fa-handshake me-2"></i>Respect & Boundaries</strong>
          <div class="form-check form-switch float-end">
            <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_respect_visible" data-field="etiquette_respect_visible">
            <label class="form-check-label" for="etiquette_respect_visible">Visible</label>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="respect_title" data-field="respect_title" placeholder="Respect & Boundaries">
          </div>
          
          <h6 class="text-muted mb-2">Mutual Respect</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="respect_mutual_title" data-field="respect_mutual_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="respect_mutual_text" data-field="respect_mutual_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Professional Boundaries</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="respect_boundaries_title" data-field="respect_boundaries_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="respect_boundaries_text" data-field="respect_boundaries_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Personal Information</h6>
          <div class="row">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="respect_personal_title" data-field="respect_personal_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="respect_personal_text" data-field="respect_personal_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hygiene & Presentation Section -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-white">
          <strong><i class="fas fa-sparkles me-2"></i>Hygiene & Presentation</strong>
          <div class="form-check form-switch float-end">
            <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_hygiene_visible" data-field="etiquette_hygiene_visible">
            <label class="form-check-label" for="etiquette_hygiene_visible">Visible</label>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="hygiene_title" data-field="hygiene_title" placeholder="Hygiene & Presentation">
          </div>
          
          <h6 class="text-muted mb-2">Personal Hygiene</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="hygiene_personal_title" data-field="hygiene_personal_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="hygiene_personal_text" data-field="hygiene_personal_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Attire</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="hygiene_attire_title" data-field="hygiene_attire_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="hygiene_attire_text" data-field="hygiene_attire_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">Substances</h6>
          <div class="row">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="hygiene_substances_title" data-field="hygiene_substances_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="hygiene_substances_text" data-field="hygiene_substances_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cancellation Policy Section -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header bg-white">
          <strong><i class="fas fa-calendar-times me-2"></i>Cancellation Policy</strong>
          <div class="form-check form-switch float-end">
            <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_cancellation_visible" data-field="etiquette_cancellation_visible">
            <label class="form-check-label" for="etiquette_cancellation_visible">Visible</label>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="cancellation_title" data-field="cancellation_title" placeholder="Cancellation Policy">
          </div>
          
          <h6 class="text-muted mb-2">Advance Notice</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="cancellation_advance_title" data-field="cancellation_advance_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="cancellation_advance_text" data-field="cancellation_advance_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">No-Shows</h6>
          <div class="row mb-3">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="cancellation_noshow_title" data-field="cancellation_noshow_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="cancellation_noshow_text" data-field="cancellation_noshow_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
          
          <h6 class="text-muted mb-2">My Cancellations</h6>
          <div class="row">
            <div class="col-6">
              <input class="form-control form-control-sm auto-save-input" id="cancellation_my_title" data-field="cancellation_my_title" placeholder="Sub-title">
            </div>
            <div class="col-12 mt-2">
              <textarea class="form-control form-control-sm auto-save-input" id="cancellation_my_text" data-field="cancellation_my_text" rows="2" placeholder="Description"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Safety & Discretion Section (Full Width) -->
  <div class="card mt-3">
    <div class="card-header bg-white">
      <strong><i class="fas fa-shield-alt me-2"></i>Safety & Discretion</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_safety_visible" data-field="etiquette_safety_visible">
        <label class="form-check-label" for="etiquette_safety_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-12">
          <label class="form-label">Section Title</label>
          <input class="form-control auto-save-input" id="safety_title" data-field="safety_title" placeholder="Safety & Discretion">
        </div>
      </div>
      
      <div class="row">
        <div class="col-lg-4">
          <h6 class="text-muted mb-2">Confidentiality</h6>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="safety_confidentiality_title" data-field="safety_confidentiality_title" placeholder="Sub-title">
          </div>
          <div class="mb-3">
            <textarea class="form-control form-control-sm auto-save-input" id="safety_confidentiality_text" data-field="safety_confidentiality_text" rows="3" placeholder="Description"></textarea>
          </div>
        </div>
        <div class="col-lg-4">
          <h6 class="text-muted mb-2">Safe Environment</h6>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="safety_environment_title" data-field="safety_environment_title" placeholder="Sub-title">
          </div>
          <div class="mb-3">
            <textarea class="form-control form-control-sm auto-save-input" id="safety_environment_text" data-field="safety_environment_text" rows="3" placeholder="Description"></textarea>
          </div>
        </div>
        <div class="col-lg-4">
          <h6 class="text-muted mb-2">Professional Communication</h6>
          <div class="mb-3">
            <input class="form-control form-control-sm auto-save-input" id="safety_communication_title" data-field="safety_communication_title" placeholder="Sub-title">
          </div>
          <div class="mb-3">
            <textarea class="form-control form-control-sm auto-save-input" id="safety_communication_text" data-field="safety_communication_text" rows="3" placeholder="Description"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Questions/Contact CTA Section -->
  <div class="card mt-3">
    <div class="card-header bg-white">
      <strong><i class="fas fa-question-circle me-2"></i>Questions & Contact</strong>
      <div class="form-check form-switch float-end">
        <input class="form-check-input auto-save-input" type="checkbox" id="etiquette_questions_visible" data-field="etiquette_questions_visible">
        <label class="form-check-label" for="etiquette_questions_visible">Visible</label>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Section Title</label>
            <input class="form-control auto-save-input" id="questions_title" data-field="questions_title" placeholder="Questions?">
          </div>
          <div class="mb-3">
            <label class="form-label">Description Text</label>
            <textarea class="form-control auto-save-input" id="questions_text" data-field="questions_text" rows="3" placeholder="Explanation text"></textarea>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Button Text</label>
            <input class="form-control auto-save-input" id="questions_button_text" data-field="questions_button_text" placeholder="Contact Me">
          </div>
          <div class="mb-3">
            <label class="form-label">Button Link</label>
            <select class="form-select auto-save-input" id="questions_button_link" data-field="questions_button_link">
              <option value="contact">Contact</option>
              <option value="calendar">Calendar</option>
              <option value="rates">Rates</option>
              <option value="about">About</option>
              <option value="gallery">Gallery</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  let slug;
  const parts = location.pathname.split('/').filter(Boolean); 
  slug = parts[0] || 'modelexample';

  const el = (sel) => document.querySelector(sel);
  
  // Auto-save system
  function setupAutoSave() {
    const inputs = document.querySelectorAll('.auto-save-input');
    const debounceTimers = new Map();
    
    inputs.forEach(input => {
      const field = input.getAttribute('data-field');
      if (!field) return;
      
      input.addEventListener('input', () => {
        // Clear existing timer
        if (debounceTimers.has(field)) {
          clearTimeout(debounceTimers.get(field));
        }
        
        // Set new timer
        const timer = setTimeout(() => {
          saveField(field, getValue(input));
        }, 700);
        
        debounceTimers.set(field, timer);
      });
    });
  }
  
  function getValue(input) {
    if (input.type === 'checkbox') {
      return input.checked;
    }
    return input.value;
  }
  
  function setValue(input, value) {
    if (input.type === 'checkbox') {
      input.checked = value === true || value === 1 || value === '1';
    } else {
      input.value = value || '';
    }
  }
  
  async function saveField(field, value) {
    try {
      const response = await fetch(`/api/etiquette-rosemastos/${slug}/content/${field}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ value })
      });
      
      const result = await response.json();
      if (!result.success) {
        console.error('Save failed:', result.message);
      }
    } catch (error) {
      console.error('Save error:', error);
    }
  }
  
  async function loadContent() {
    try {
      const response = await fetch(`/api/etiquette-rosemastos/${slug}/content`);
      const result = await response.json();
      
      if (result.success && result.data.etiquette_content) {
        const content = result.data.etiquette_content;
        
        // Load all fields
        Object.keys(content).forEach(key => {
          const input = document.getElementById(key);
          if (input && content[key] !== null) {
            setValue(input, content[key]);
          }
        });
      }
    } catch (error) {
      console.error('Load error:', error);
    }
  }
  
  // Initialize
  (async function init() {
    await loadContent();
    setupAutoSave();
    console.log('RoseMastos-style etiquette editor initialized for:', slug);
  })();
})();
</script>