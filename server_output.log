
> musenest@1.0.0 start
> node server.js

🔍 Testing database connection...
✅ Database connected successfully
🚀 MuseNest Server Started
📍 Server running on port 3000
🌍 Environment: development
🔗 Health check: http://localhost:3000/health

Next steps:
1. Copy .env.example to .env and configure your database
2. Run: npm run migrate (to set up database)
3. Run: npm run seed (to add sample data)
Loaded 0 active impersonation sessions
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: '1753687362085_BlowJob.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753823027439-633900310.jpg',
  originalName: '1753687362085_BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753823027462_1753687362085_BlowJob.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1876ms
📊 Status: 200, Content-Length: 1081
🏁 Complete response received in 1888ms, size: 1081 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=78.8359522819519, pose=no_pose_detected, suggestive=0
✅ Transformation complete, final nudity score: 78.8359522819519
🎭 Pose analysis: no_pose_detected (0)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: { reasoning: [ 'no_pose_landmarks_found' ] },
  pose_category: 'no_pose_detected',
  pose_detected: false,
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 70.95235705375671,
  nudity_contribution: 78.8359522819519,
  pose_contribution: 0,
  reasoning: [ 'content_appears_safe' ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 5ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 440
🔌 Queue database connection released
✅ Upload processing completed in 1901ms
📊 Result: success=true, status=flagged, nudity=78.8359522819519
📤 Sending successful response to client...
✅ Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: '1753822644341_Amanda4.jpeg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753823048631-268038294.jpeg',
  originalName: '1753822644341_Amanda4.jpeg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753823048633_1753822644341_Amanda4.jpeg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 306ms
📊 Status: 200, Content-Length: 1265
🏁 Complete response received in 351ms, size: 1265 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=87.36619353294373, pose=moderately_suggestive, suggestive=0.3
⚠️ Pose validation: Detected face-only with pose claims - likely AI hallucination
✅ Transformation complete, final nudity score: 87.36619353294373
🎭 Pose analysis: moderately_suggestive (0.3)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'facing_camera',
    hip_bend_angle: 0.867625068430209,
    leg_spread: 0.4910097122192383,
    reasoning: [ 'face_only_image_no_body_visible' ],
    torso_angle: 2.365309652634898,
    validation_override: 'pose_detection_disabled_for_face_only_image'
  },
  pose_category: 'face_only_no_pose',
  pose_detected: false,
  raw_metrics: {
    body_orientation: 'facing_camera',
    hip_bend_angle: 0.867625068430209,
    leg_spread: 0.4910097122192383,
    shoulder_width: 0.7541155070066452,
    torso_angle: 2.365309652634898,
    validation_note: 'Original metrics ignored due to face-only detection'
  },
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 81.62957417964935,
  nudity_contribution: 87.36619353294373,
  pose_contribution: 30,
  reasoning: [ 'content_appears_safe' ],
  risk_level: 'high'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 3ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 441
🔌 Queue database connection released
✅ Upload processing completed in 357ms
📊 Result: success=true, status=flagged, nudity=87.36619353294373
📤 Sending successful response to client...
✅ Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Amanda2.jpeg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753823095229-747569007.jpeg',
  originalName: 'Amanda2.jpeg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753823095231_Amanda2.jpeg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 301ms
📊 Status: 200, Content-Length: 1256
🏁 Complete response received in 314ms, size: 1256 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=84.07700657844543, pose=moderately_suggestive, suggestive=0.3
⚠️ Pose validation: Detected face-only with pose claims - likely AI hallucination
✅ Transformation complete, final nudity score: 84.07700657844543
🎭 Pose analysis: moderately_suggestive (0.3)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'facing_left',
    hip_bend_angle: 0.5551306602380071,
    leg_spread: 0.30897486209869385,
    reasoning: [ 'face_only_image_no_body_visible' ],
    torso_angle: 1.636235728288614,
    validation_override: 'pose_detection_disabled_for_face_only_image'
  },
  pose_category: 'face_only_no_pose',
  pose_detected: false,
  raw_metrics: {
    body_orientation: 'facing_left',
    hip_bend_angle: 0.5551306602380071,
    leg_spread: 0.30897486209869385,
    shoulder_width: 0.4830232858657837,
    torso_angle: 1.636235728288614,
    validation_note: 'Original metrics ignored due to face-only detection'
  },
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 78.66930592060089,
  nudity_contribution: 84.07700657844543,
  pose_contribution: 30,
  reasoning: [ 'content_appears_safe' ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 6ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 0ms
Content flagged and added to moderation queue: 442
🔌 Queue database connection released
✅ Upload processing completed in 324ms
📊 Result: success=true, status=flagged, nudity=84.07700657844543
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 442 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 442 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 442 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BreastStall.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753823120661-780027775.jpg',
  originalName: 'BreastStall.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753823120673_BreastStall.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1644ms
📊 Status: 200, Content-Length: 1780
🏁 Complete response received in 1658ms, size: 1780 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=83.8350772857666, pose=artistic_or_neutral, suggestive=0
⚠️ Pose validation: Detected extreme pose metrics - may be AI error
✅ Transformation complete, final nudity score: 81.79609775543213
🎭 Pose analysis: artistic_or_neutral (0)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'facing_left',
    hip_bend_angle: 5.325518917379975,
    leg_spread: 0.11395132541656494,
    reasoning: [ 'extreme_metrics_detected' ],
    torso_angle: 1.3421758314396786,
    validation_warning: 'Pose metrics appear unrealistic'
  },
  pose_category: 'uncertain_pose_detection',
  pose_detected: true,
  raw_metrics: {
    body_orientation: 'facing_left',
    hip_bend_angle: 5.325518917379975,
    leg_spread: 0.11395132541656494,
    shoulder_width: 0.24153465032577515,
    torso_angle: 1.3421758314396786
  },
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 58.684554100036614,
  nudity_contribution: 83.8350772857666,
  pose_contribution: 0,
  reasoning: [ 'nudity_detected_83.8%' ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 3ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 0ms
Content flagged and added to moderation queue: 443
🔌 Queue database connection released
✅ Upload processing completed in 1662ms
📊 Result: success=true, status=flagged, nudity=81.79609775543213
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 443 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 443 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 443 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BreastStall.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753823486527-743107650.jpg',
  originalName: 'BreastStall.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753823486540_BreastStall.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1754ms
📊 Status: 200, Content-Length: 1780
🏁 Complete response received in 1755ms, size: 1780 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=83.8350772857666, pose=artistic_or_neutral, suggestive=0
⚠️ Pose validation: Detected extreme pose metrics - may be AI error
✅ Transformation complete, final nudity score: 81.79609775543213
🎭 Pose analysis: artistic_or_neutral (0)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'facing_left',
    hip_bend_angle: 5.325518917379975,
    leg_spread: 0.11395132541656494,
    reasoning: [ 'extreme_metrics_detected' ],
    torso_angle: 1.3421758314396786,
    validation_warning: 'Pose metrics appear unrealistic'
  },
  pose_category: 'uncertain_pose_detection',
  pose_detected: true,
  raw_metrics: {
    body_orientation: 'facing_left',
    hip_bend_angle: 5.325518917379975,
    leg_spread: 0.11395132541656494,
    shoulder_width: 0.24153465032577515,
    torso_angle: 1.3421758314396786
  },
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 58.684554100036614,
  nudity_contribution: 83.8350772857666,
  pose_contribution: 0,
  reasoning: [ 'nudity_detected_83.8%' ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 5ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 444
🔌 Queue database connection released
✅ Upload processing completed in 1765ms
📊 Result: success=true, status=flagged, nudity=81.79609775543213
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 444 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 444 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 444 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BacksideClean.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753825246753-382427108.jpg',
  originalName: 'BacksideClean.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753825246765_BacksideClean.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
❌ Enhanced API request error after 54ms: connect ECONNREFUSED 52.15.235.216:5000
Error details: code=ECONNREFUSED, syscall=connect
🚨 FALLING BACK TO CONSERVATIVE ANALYSIS
🚨 Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
✅ Fallback analysis completed
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 39ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 445
🔌 Queue database connection released
✅ Upload processing completed in 102ms
📊 Result: success=true, status=flagged, nudity=95
📤 Sending successful response to client...
✅ Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BacksideClean.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753825256675-25307280.jpg',
  originalName: 'BacksideClean.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753825256688_BacksideClean.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
❌ Enhanced API request error after 61ms: connect ECONNREFUSED 52.15.235.216:5000
Error details: code=ECONNREFUSED, syscall=connect
🚨 FALLING BACK TO CONSERVATIVE ANALYSIS
🚨 Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
✅ Fallback analysis completed
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 2ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 446
🔌 Queue database connection released
✅ Upload processing completed in 66ms
📊 Result: success=true, status=flagged, nudity=95
📤 Sending successful response to client...
✅ Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Bikini.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753825319235-188056629.jpg',
  originalName: 'Bikini.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753825319242_Bikini.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
❌ Enhanced API request error after 49ms: connect ECONNREFUSED 52.15.235.216:5000
Error details: code=ECONNREFUSED, syscall=connect
🚨 FALLING BACK TO CONSERVATIVE ANALYSIS
🚨 Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
✅ Fallback analysis completed
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 19ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 447
🔌 Queue database connection released
✅ Upload processing completed in 73ms
📊 Result: success=true, status=flagged, nudity=95
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 447 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 447 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 447 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Bikini.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753825438790-901046969.jpg',
  originalName: 'Bikini.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753825438796_Bikini.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1283ms
📊 Status: 200, Content-Length: 6171
🏁 Complete response received in 1298ms, size: 6171 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=78.44780683517456, pose=uncertain_pose_detection, suggestive=0.65
⚠️ Pose validation: Detected extreme pose metrics - may be AI error
✅ Transformation complete, final nudity score: 78.44780683517456
🎭 Pose analysis: uncertain_pose_detection (0.65)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'facing_camera',
    body_symmetry: 0.5015337119499842,
    hip_bend_angle: 13.254354933219176,
    leg_spread: 0.2827686369419098,
    pose_stability: 0.541230109096928,
    reasoning: [ 'extreme_metrics_detected', 'extreme_metrics_detected' ],
    torso_angle: 19.81232693915187,
    validation_warning: 'Pose metrics appear unrealistic'
  },
  landmark_count: 33,
  landmarks: {
    LEFT_ANKLE: {
      visibility: 0.09651722759008408,
      x: 0.7302972078323364,
      y: 1.5556275844573975,
      z: 1.7611939907073975
    },
    LEFT_EAR: {
      visibility: 0.999982476234436,
      x: 0.582198977470398,
      y: 0.18508380651474,
      z: -1.146904468536377
    },
    LEFT_ELBOW: {
      visibility: 0.11167743802070618,
      x: 0.639329195022583,
      y: 0.6060171127319336,
      z: -0.0004831601690966636
    },
    LEFT_EYE: {
      visibility: 0.9999808073043823,
      x: 0.5536386370658875,
      y: 0.17228364944458008,
      z: -1.724603533744812
    },
    LEFT_EYE_INNER: {
      visibility: 0.9999586343765259,
      x: 0.5147667527198792,
      y: 0.16997861862182617,
      z: -1.7229419946670532
    },
    LEFT_EYE_OUTER: {
      visibility: 0.999954104423523,
      x: 0.5785852670669556,
      y: 0.17204278707504272,
      z: -1.7245484590530396
    },
    LEFT_FOOT_INDEX: {
      visibility: 0.12479232251644135,
      x: 0.6499516367912292,
      y: 1.679086446762085,
      z: 1.475125789642334
    },
    LEFT_HEEL: {
      visibility: 0.08130649477243423,
      x: 0.734521746635437,
      y: 1.5940190553665161,
      z: 1.8278888463974
    },
    LEFT_HIP: {
      visibility: 0.9410501718521118,
      x: 0.6133614182472229,
      y: 0.8884047865867615,
      z: 0.2065923660993576
    },
    LEFT_INDEX: {
      visibility: 0.27042731642723083,
      x: 0.6526387333869934,
      y: 0.8342909812927246,
      z: 0.31427571177482605
    },
    LEFT_KNEE: {
      visibility: 0.15802989900112152,
      x: 0.7236219644546509,
      y: 1.2429492473602295,
      z: 0.9110832214355469
    },
    LEFT_PINKY: {
      visibility: 0.25813281536102295,
      x: 0.6461749076843262,
      y: 0.8434247374534607,
      z: 0.4312651455402374
    },
    LEFT_SHOULDER: {
      visibility: 0.9995560050010681,
      x: 0.5605379343032837,
      y: 0.3910054862499237,
      z: -0.6293602585792542
    },
    LEFT_THUMB: {
      visibility: 0.21492837369441986,
      x: 0.6341232061386108,
      y: 0.8163715600967407,
      z: 0.34635764360427856
    },
    LEFT_WRIST: {
      visibility: 0.19712695479393005,
      x: 0.6529175639152527,
      y: 0.7900871634483337,
      z: 0.3818143308162689
    },
    MOUTH_LEFT: {
      visibility: 0.9997783303260803,
      x: 0.48131129145622253,
      y: 0.27790242433547974,
      z: -1.5635164976119995
    },
    MOUTH_RIGHT: {
      visibility: 0.9998706579208374,
      x: 0.35745716094970703,
      y: 0.25664639472961426,
      z: -1.6516730785369873
    },
    NOSE: {
      visibility: 0.9999936819076538,
      x: 0.44051021337509155,
      y: 0.21887719631195068,
      z: -1.8049423694610596
    },
    RIGHT_ANKLE: {
      visibility: 0.20504052937030792,
      x: 0.44752857089042664,
      y: 1.6035656929016113,
      z: 1.585818886756897
    },
    RIGHT_EAR: {
      visibility: 0.9999839067459106,
      x: 0.24944551289081573,
      y: 0.12757879495620728,
      z: -1.4179316759109497
    },
    RIGHT_ELBOW: {
      visibility: 0.7649635076522827,
      x: -0.07223013043403625,
      y: 0.8208568692207336,
      z: -1.346272587776184
    },
    RIGHT_EYE: {
      visibility: 0.9999920129776001,
      x: 0.3555178940296173,
      y: 0.12969988584518433,
      z: -1.7807084321975708
    },
    RIGHT_EYE_INNER: {
      visibility: 0.9999780654907227,
      x: 0.3881981074810028,
      y: 0.1394963264465332,
      z: -1.7791486978530884
    },
    RIGHT_EYE_OUTER: {
      visibility: 0.999977707862854,
      x: 0.31799328327178955,
      y: 0.12246543169021606,
      z: -1.781829833984375
    },
    RIGHT_FOOT_INDEX: {
      visibility: 0.13546627759933472,
      x: 0.5046367645263672,
      y: 1.7213917970657349,
      z: 1.3258333206176758
    },
    RIGHT_HEEL: {
      visibility: 0.15891562402248383,
      x: 0.44217005372047424,
      y: 1.6517741680145264,
      z: 1.6733801364898682
    },
    RIGHT_HIP: {
      visibility: 0.9462290406227112,
      x: 0.37645766139030457,
      y: 0.9439784288406372,
      z: -0.20852024853229523
    },
    RIGHT_INDEX: {
      visibility: 0.005413060542196035,
      x: -0.2928279936313629,
      y: 1.1629432439804077,
      z: -1.6369494199752808
    },
    RIGHT_KNEE: {
      visibility: 0.17688553035259247,
      x: 0.4165831208229065,
      y: 1.227882981300354,
      z: 0.6024433374404907
    },
    RIGHT_PINKY: {
      visibility: 0.003974383231252432,
      x: -0.28182104229927063,
      y: 1.1834843158721924,
      z: -1.5764522552490234
    },
    RIGHT_SHOULDER: {
      visibility: 0.9992873072624207,
      x: 0.07953903079032898,
      y: 0.47058701515197754,
      z: -1.159423589706421
    },
    RIGHT_THUMB: {
      visibility: 0.006207969505339861,
      x: -0.25242170691490173,
      y: 1.13326096534729,
      z: -1.5094183683395386
    },
    RIGHT_WRIST: {
      visibility: 0.005214965436607599,
      x: -0.21908828616142273,
      y: 1.1066287755966187,
      z: -1.4754602909088135
    }
  },
  pose_category: 'uncertain_pose_detection',
  pose_confidence: 0.7458616622856685,
  pose_detected: true,
  raw_metrics: {
    arms_raised: true,
    body_orientation: 'facing_camera',
    body_symmetry: 0.5015337119499842,
    hand_positions: {
      hands_together: false,
      left_hand_near_body: true,
      right_hand_near_body: false
    },
    hip_bend_angle: 13.254354933219176,
    left_arm_angle: 15.903403597358981,
    left_leg_bend: 16.052285347387883,
    leg_spread: 0.2827686369419098,
    pose_stability: 0.541230109096928,
    right_arm_angle: 3.771923437793898,
    right_leg_bend: 3.335684881348605,
    torso_angle: 19.81232693915187,
    torso_lean: 0.1748710572719574
  },
  suggestive_score: 0.65
}
🔍 Debug - Combined assessment: {
  final_risk_score: 75.4387457671206,
  landmark_count: 33,
  nudity_contribution: 78.44780683517456,
  pose_confidence: 0.7458616622856685,
  pose_contribution: 65,
  reasoning: [
    'nudity_detected_78.4%',
    'suggestive_pose_uncertain_pose_detection',
    'high_quality_pose_data_33_landmarks'
  ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 8ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 448
🔌 Queue database connection released
✅ Upload processing completed in 1311ms
📊 Result: success=true, status=flagged, nudity=78.44780683517456
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 448 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 448 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 448 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753825601927-488887509.webp',
  originalName: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753825601932_love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 423ms
📊 Status: 200, Content-Length: 5866
🏁 Complete response received in 432ms, size: 5866 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=73.67205619812012, pose=face_only_no_pose, suggestive=0
✅ Transformation complete, final nudity score: 73.67205619812012
🎭 Pose analysis: face_only_no_pose (0)
🔍 Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  details: {
    body_orientation: 'side_view',
    body_symmetry: 0.39560164014498395,
    hip_bend_angle: 19.433995698833897,
    leg_spread: 0.0010844171047210693,
    pose_stability: 0.4442332326575662,
    raw_metrics: {
      arms_raised: true,
      body_orientation: 'side_view',
      body_symmetry: 0.39560164014498395,
      hand_positions: [Object],
      hip_bend_angle: 19.433995698833897,
      left_arm_angle: 162.68584714759848,
      left_leg_bend: 49.27232194901317,
      leg_spread: 0.0010844171047210693,
      pose_stability: 0.4442332326575662,
      right_arm_angle: 93.2383543994598,
      right_leg_bend: 113.478885987919,
      torso_angle: 1.221250096936645,
      torso_lean: 0.015774041414260864
    },
    reasoning: [ 'face_only_image_no_body_visible' ],
    torso_angle: 1.221250096936645,
    validation_override: 'pose_detection_disabled_for_face_only_image'
  },
  landmark_count: 33,
  landmarks: {
    LEFT_ANKLE: {
      visibility: 0.018947552889585495,
      x: 0.39416733384132385,
      y: 0.9284754991531372,
      z: 0.3755822479724884
    },
    LEFT_EAR: {
      visibility: 0.9994243383407593,
      x: 0.6418205499649048,
      y: 0.3557446002960205,
      z: -0.6174473762512207
    },
    LEFT_ELBOW: {
      visibility: 0.12643419206142426,
      x: 0.3179423213005066,
      y: 0.9569871425628662,
      z: -0.6063361763954163
    },
    LEFT_EYE: {
      visibility: 0.9996768236160278,
      x: 0.5395095348358154,
      y: 0.33868253231048584,
      z: -0.6995331048965454
    },
    LEFT_EYE_INNER: {
      visibility: 0.9997677206993103,
      x: 0.5238707661628723,
      y: 0.341039776802063,
      z: -0.6990310549736023
    },
    LEFT_EYE_OUTER: {
      visibility: 0.9996187686920166,
      x: 0.5563820004463196,
      y: 0.338556170463562,
      z: -0.6992225646972656
    },
    LEFT_FOOT_INDEX: {
      visibility: 0.021111760288476944,
      x: 0.25385963916778564,
      y: 0.7550796866416931,
      z: 0.3840055763721466
    },
    LEFT_HEEL: {
      visibility: 0.03234467655420303,
      x: 0.4113692045211792,
      y: 0.9877533316612244,
      z: 0.4069003760814667
    },
    LEFT_HIP: {
      visibility: 0.08145489543676376,
      x: 0.6366915702819824,
      y: 1.4109561443328857,
      z: -0.28640350699424744
    },
    LEFT_INDEX: {
      visibility: 0.21708497405052185,
      x: 0.5217863917350769,
      y: 0.6834056973457336,
      z: -0.21478290855884552
    },
    LEFT_KNEE: {
      visibility: 0.01911940984427929,
      x: 0.49038296937942505,
      y: 0.9682133793830872,
      z: 0.06312832236289978
    },
    LEFT_PINKY: {
      visibility: 0.19792625308036804,
      x: 0.477461576461792,
      y: 0.694656252861023,
      z: -0.17255359888076782
    },
    LEFT_SHOULDER: {
      visibility: 0.9515981674194336,
      x: 0.6017327904701233,
      y: 0.6789429783821106,
      z: -0.6534557938575745
    },
    LEFT_THUMB: {
      visibility: 0.20323221385478973,
      x: 0.5067663788795471,
      y: 0.709186315536499,
      z: -0.16799436509609222
    },
    LEFT_WRIST: {
      visibility: 0.16135752201080322,
      x: 0.45009738206863403,
      y: 0.7112592458724976,
      z: -0.16357387602329254
    },
    MOUTH_LEFT: {
      visibility: 0.9915775060653687,
      x: 0.5268270969390869,
      y: 0.4673301577568054,
      z: -0.6266051530838013
    },
    MOUTH_RIGHT: {
      visibility: 0.9941905736923218,
      x: 0.5010401010513306,
      y: 0.4590678811073303,
      z: -0.518139123916626
    },
    NOSE: {
      visibility: 0.9997424483299255,
      x: 0.4963124096393585,
      y: 0.4070690870285034,
      z: -0.6764008402824402
    },
    RIGHT_ANKLE: {
      visibility: 0.008047563023865223,
      x: 0.3930829167366028,
      y: 0.7627100348472595,
      z: 0.34385964274406433
    },
    RIGHT_EAR: {
      visibility: 0.9996960163116455,
      x: 0.5513795614242554,
      y: 0.3510611057281494,
      z: -0.2212446630001068
    },
    RIGHT_ELBOW: {
      visibility: 0.016527974978089333,
      x: 0.42743000388145447,
      y: 0.7852570414543152,
      z: 0.38769134879112244
    },
    RIGHT_EYE: {
      visibility: 0.999825656414032,
      x: 0.4996359646320343,
      y: 0.33845794200897217,
      z: -0.6104799509048462
    },
    RIGHT_EYE_INNER: {
      visibility: 0.9998382329940796,
      x: 0.5021302103996277,
      y: 0.3416149616241455,
      z: -0.6093249917030334
    },
    RIGHT_EYE_OUTER: {
      visibility: 0.9998458623886108,
      x: 0.4971056878566742,
      y: 0.33387041091918945,
      z: -0.6111940741539001
    },
    RIGHT_FOOT_INDEX: {
      visibility: 0.0114043690264225,
      x: 0.3480161726474762,
      y: 0.6292181611061096,
      z: 0.3510637581348419
    },
    RIGHT_HEEL: {
      visibility: 0.02899019978940487,
      x: 0.39869430661201477,
      y: 0.8287083506584167,
      z: 0.3546491265296936
    },
    RIGHT_HIP: {
      visibility: 0.21928010880947113,
      x: 0.6320021152496338,
      y: 1.3383389711380005,
      z: 0.2860870063304901
    },
    RIGHT_INDEX: {
      visibility: 0.1042502373456955,
      x: 0.40434977412223816,
      y: 0.7365092635154724,
      z: 0.15441834926605225
    },
    RIGHT_KNEE: {
      visibility: 0.00967786367982626,
      x: 0.4124597907066345,
      y: 0.7441558837890625,
      z: 0.3012334108352661
    },
    RIGHT_PINKY: {
      visibility: 0.09281253069639206,
      x: 0.3736730217933655,
      y: 0.7456851005554199,
      z: 0.2075941413640976
    },
    RIGHT_SHOULDER: {
      visibility: 0.9900354743003845,
      x: 0.6354128122329712,
      y: 0.5904765129089355,
      z: 0.2120029628276825
    },
    RIGHT_THUMB: {
      visibility: 0.10425852239131927,
      x: 0.4121440649032593,
      y: 0.7405551075935364,
      z: 0.1876673549413681
    },
    RIGHT_WRIST: {
      visibility: 0.060596268624067307,
      x: 0.3879040777683258,
      y: 0.7379580736160278,
      z: 0.22056198120117188
    }
  },
  pose_category: 'face_only_no_pose',
  pose_confidence: 0.46727262397429775,
  pose_detected: false,
  suggestive_score: 0
}
🔍 Debug - Combined assessment: {
  final_risk_score: 63.344575694136864,
  landmark_count: 33,
  nudity_contribution: 73.67205619812012,
  pose_confidence: 0.46727262397429775,
  pose_contribution: 0,
  reasoning: [ 'nudity_detected_73.7%', 'high_quality_pose_data_33_landmarks' ],
  risk_level: 'medium'
}
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 6ms
🔌 Database connection released
📋 Adding flagged content to moderation queue...
🔌 Got dedicated database connection for queue
✅ Queue insert completed in 1ms
Content flagged and added to moderation queue: 449
🔌 Queue database connection released
✅ Upload processing completed in 446ms
📊 Result: success=true, status=flagged, nudity=73.67205619812012
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, policy_violations, moderation_status,
                human_review_required, flagged, final_location, final_risk_score,
                risk_level, combined_assessment, pose_category, pose_analysis, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 449 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 449 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, pose_classification,
                explicit_pose_score, final_risk_score, risk_level, combined_assessment,
                pose_category, review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 449 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
Error ending impersonation: Error: Impersonation session not found
    at ImpersonationManager.endImpersonation (/Users/programmer/Projects/musenest/middleware/impersonation.js:143:23)
    at ImpersonationManager.cleanupExpiredSessions (/Users/programmer/Projects/musenest/middleware/impersonation.js:308:28)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Error cleaning up expired sessions: Error: Impersonation session not found
    at ImpersonationManager.endImpersonation (/Users/programmer/Projects/musenest/middleware/impersonation.js:143:23)
    at ImpersonationManager.cleanupExpiredSessions (/Users/programmer/Projects/musenest/middleware/impersonation.js:308:28)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Amanda.jpeg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753827506377-80647178.jpeg',
  originalName: 'Amanda.jpeg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753827506380_Amanda.jpeg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
❌ Enhanced API request error after 67ms: connect ECONNREFUSED 52.15.235.216:5000
Error details: code=ECONNREFUSED, syscall=connect
🚨 FALLING BACK TO CONSERVATIVE ANALYSIS
🚨 Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
✅ Fallback analysis completed
💾 Storing moderation result in database...
🔌 Got dedicated database connection
🔌 Database connection released
❌ Database insert failed after 8ms: Data truncated for column 'priority' at row 2
Error processing uploaded image: Error: Data truncated for column 'priority' at row 2
    at PromisePoolConnection.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/connection.js:47:22)
    at ContentModerationService.storeModerationResult (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:645:51)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:159:41)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24 {
  code: 'WARN_DATA_TRUNCATED',
  errno: 1265,
  sql: '\n' +
    '            INSERT INTO content_moderation (\n' +
    '                image_path, original_path, model_id, context_type, usage_intent,\n' +
    '                nudity_score, detected_parts, part_locations, pose_classification,\n' +
    '                explicit_pose_score, generated_caption, policy_violations,\n' +
    '                moderation_status, human_review_required, flagged, auto_blocked,\n' +
    '                confidence_score, final_location, final_risk_score, risk_level, \n' +
    '                combined_assessment, pose_category, pose_analysis\n' +
    '            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n' +
    '        ',
  sqlState: '01000',
  sqlMessage: "Data truncated for column 'priority' at row 2"
}
✅ Upload processing completed in 81ms
📊 Result: success=false, status=error, nudity=undefined
❌ Sending error response to client...
✅ Error response sent
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'HoldingTits.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753827730319-738244633.jpg',
  originalName: 'HoldingTits.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753827730351_HoldingTits.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
❌ Enhanced API request error after 51ms: connect ECONNREFUSED 52.15.235.216:5000
Error details: code=ECONNREFUSED, syscall=connect
🚨 FALLING BACK TO CONSERVATIVE ANALYSIS
🚨 Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
✅ Fallback analysis completed
💾 Storing moderation result in database...
🔌 Got dedicated database connection
🔌 Database connection released
❌ Database insert failed after 4ms: Data truncated for column 'priority' at row 2
Error processing uploaded image: Error: Data truncated for column 'priority' at row 2
    at PromisePoolConnection.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/connection.js:47:22)
    at ContentModerationService.storeModerationResult (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:645:51)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:159:41)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24 {
  code: 'WARN_DATA_TRUNCATED',
  errno: 1265,
  sql: '\n' +
    '            INSERT INTO content_moderation (\n' +
    '                image_path, original_path, model_id, context_type, usage_intent,\n' +
    '                nudity_score, detected_parts, part_locations, pose_classification,\n' +
    '                explicit_pose_score, generated_caption, policy_violations,\n' +
    '                moderation_status, human_review_required, flagged, auto_blocked,\n' +
    '                confidence_score, final_location, final_risk_score, risk_level, \n' +
    '                combined_assessment, pose_category, pose_analysis\n' +
    '            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n' +
    '        ',
  sqlState: '01000',
  sqlMessage: "Data truncated for column 'priority' at row 2"
}
✅ Upload processing completed in 70ms
📊 Result: success=false, status=error, nudity=undefined
❌ Sending error response to client...
✅ Error response sent
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BendoverAss.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753827996981-94093047.jpg',
  originalName: 'BendoverAss.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753827996991_BendoverAss.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1458ms
📊 Status: 200, Content-Length: 1919
🏁 Complete response received in 1468ms, size: 1919 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=69.12716627120972, pose=undefined, suggestive=undefined
❌ JSON parse error: Cannot read properties of undefined (reading 'suggestive_score')
Raw response preview: {"image_analysis":{"combined_assessment":{"age_risk_multiplier":1.0,"description_risk":0.0,"face_count":2,"final_risk_score":69.12716627120972,"min_detected_age":31,"nudity_contribution":69.12716627120972,"reasoning":["nudity_detected_69.1%","face_analysis_complete_2_faces"],"risk_level":"medium"},"...
Error processing uploaded image: Error: Failed to parse enhanced analysis response
    at IncomingMessage.<anonymous> (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:292:32)
    at IncomingMessage.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
✅ Upload processing completed in 1477ms
📊 Result: success=false, status=error, nudity=undefined
❌ Sending error response to client...
✅ Error response sent
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BendoverAss.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753828014341-6114083.jpg',
  originalName: 'BendoverAss.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753828014353_BendoverAss.jpg
📡 Target: 52.15.235.216:5000/analyze
📝 Form data prepared: context_type=public_gallery, model_id=1
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1490ms
📊 Status: 200, Content-Length: 1918
🏁 Complete response received in 1501ms, size: 1918 bytes
✅ JSON parsed successfully, success: true
🎯 Transforming enhanced API response...
📊 Raw API results: nudity=69.12716627120972, pose=undefined, suggestive=undefined
❌ JSON parse error: Cannot read properties of undefined (reading 'suggestive_score')
Raw response preview: {"image_analysis":{"combined_assessment":{"age_risk_multiplier":1.0,"description_risk":0.0,"face_count":2,"final_risk_score":69.12716627120972,"min_detected_age":18,"nudity_contribution":69.12716627120972,"reasoning":["nudity_detected_69.1%","face_analysis_complete_2_faces"],"risk_level":"medium"},"...
Error processing uploaded image: Error: Failed to parse enhanced analysis response
    at IncomingMessage.<anonymous> (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:292:32)
    at IncomingMessage.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)
✅ Upload processing completed in 1502ms
📊 Result: success=false, status=error, nudity=undefined
❌ Sending error response to client...
✅ Error response sent
