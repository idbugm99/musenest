<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{#if site_settings.site_name}}{{site_settings.site_name}}{{else}}{{model.name}}{{/if}}</title>
    <meta name="description" content="{{site_settings.meta_description}}">
    <meta name="og:title" content="{{site_settings.site_name}} - {{model.name}}">
    <meta name="og:description" content="{{site_settings.meta_description}}">
    <meta name="og:type" content="website">
    <meta name="og:image" content="{{site_settings.og_image}}">
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Dynamic Theme Colors -->
    <link rel="stylesheet" href="/api/theme-custom/css/{{model.id}}" type="text/css">
    
    <style>
        /* Luxury Theme Styles */
        
        /* Luxury Theme Colors */
        :root {
            --luxury-primary: var(--color-primary, #7C3AED);
            --luxury-secondary: var(--color-secondary, #5B21B6);
            --luxury-accent: var(--color-accent, #F59E0B);
            --luxury-text: var(--color-text, #581C87);
            --luxury-background: var(--color-background, #FAF5FF);
        }
        
        .text-luxury-primary { color: var(--luxury-primary); }
        .bg-luxury-primary { background-color: var(--luxury-primary); }
        .border-luxury-primary { border-color: var(--luxury-primary); }
        
        .luxury-gradient {
            background: linear-gradient(135deg, var(--luxury-primary) 0%, var(--luxury-secondary) 100%);
        }
            
    </style>
</head>
<body class="bg-luxury-background font-serif">
    <!-- Navigation Component -->
    {{component "navigation" theme="luxury" model=model navigation=navigation}}
    
    <!-- Page Content -->
    

Gallery - {{#if current_model}}{{site_settings.model_name if site_settings and site_settings.model_name else (current_model.name}}{{else}}{{'Model Example')}}{{/if}}


<style>
/* Enhanced font rendering for luxury feel */
body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

.font-heading {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings: "liga" 1, "kern" 1;
}

/* Luxury grain texture */
.luxury-grain {
    position: relative;
}

.luxury-grain::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('{{url_for('static', filename='images/grain.png')}}');
    background-repeat: repeat;
    opacity: 0.15;
    mix-blend-mode: overlay;
    pointer-events: none;
    z-index: 1;
}

/* Masonry Layout CSS - WORKING VERSION FROM gallery.html */
.masonry-container {
    column-count: 3;
    column-gap: 1.5rem;
    column-fill: balance;
}

.masonry-item {
    break-inside: avoid;
    margin-bottom: 1.5rem;
}

@media (max-width: 768px) {
    .masonry-container {
        column-count: 2;
    }
}

@media (max-width: 480px) {
    .masonry-container {
        column-count: 1;
    }
}

/* Enhanced Carousel CSS for luxury */
.carousel-container {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    background: rgba(0, 0, 0, 0.2);
    width: 100%;
    max-width: 700px;
    height: 550px;
    margin: 0 auto;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
}

@media (max-width: 768px) {
    .carousel-container {
        max-width: 90%;
        height: 450px;
    }
}

@media (max-width: 480px) {
    .carousel-container {
        height: 350px;
    }
}

.carousel-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
    will-change: transform;
    height: 100%;
}

.carousel-slide {
    flex: 0 0 100%;
    width: 100%;
    aspect-ratio: 16/9;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-sizing: border-box;
}

.carousel-slide.fade-mode {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
}

.carousel-slide.fade-mode.active {
    opacity: 1;
}

.carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    border-radius: 1rem;
}

.carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(212, 175, 55, 0.8);
    color: white;
    border: none;
    padding: 0.875rem;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
}

.carousel-btn:hover {
    background: rgba(212, 175, 55, 1);
    transform: translateY(-50%) scale(1.1);
}

.carousel-btn.prev {
    left: 1rem;
}

.carousel-btn.next {
    right: 1rem;
}

.carousel-dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
}

.carousel-dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: #d1d5db;
    cursor: pointer;
    transition: background 0.3s;
}

.carousel-dot.active {
    background: var(--primary-color, #8B5CF6);
}

/* Filter Buttons - Fixed for dark background */
.filter-btn {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    border: 2px solid;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: capitalize;
}

.filter-btn.active {
    background: var(--accent-color);
    color: var(--text-color);
    border-color: var(--accent-color);
}

.filter-btn:not(.active) {
    background: transparent;
    color: var(--accent-color);
    border-color: var(--accent-color);
}

.filter-btn:not(.active):hover {
    background: var(--accent-color);
    color: var(--text-color);
}

/* Lightbox */
.lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.lightbox.active {
    display: flex;
}

.lightbox-content {
    max-width: 90vw;
    max-height: 90vh;
    position: relative;
}

.lightbox-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.lightbox-close {
    position: absolute;
    top: -3rem;
    right: 0;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    background: none;
    border: none;
}

.lightbox-caption {
    color: white;
    text-align: center;
    margin-top: 1rem;
}

/* Elegant Empty State Styles */
.gallery-empty-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 4rem 2rem;
    text-align: center;
    animation: fadeInUp 0.8s ease-out;
}

.gallery-empty-icon {
    margin: 0 auto 2rem;
    width: 120px;
    height: auto;
}

.gallery-placeholder-svg {
    width: 100%;
    height: auto;
    color: #D1D5DB;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
}

.empty-gallery-heading {
    font-family: var(--font-heading, 'Playfair Display', serif);
    font-size: 2.5rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 1rem;
    line-height: 1.2;
}

.empty-gallery-message {
    font-size: 1.125rem;
    color: #6B7280;
    line-height: 1.6;
    margin-bottom: 2.5rem;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
}

.empty-gallery-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-elegant-secondary {
    display: inline-flex;
    align-items: center;
    background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
    color: #7C3AED;
    padding: 0.875rem 1.75rem;
    border-radius: 999px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: 1px solid #E9D5FF;
    box-shadow: 0 2px 4px rgba(124, 58, 237, 0.1);
}

.btn-elegant-secondary:hover {
    background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(124, 58, 237, 0.15);
    color: #6D28D9;
}

.btn-elegant-outline {
    display: inline-flex;
    align-items: center;
    background: transparent;
    color: #6B7280;
    padding: 0.875rem 1.75rem;
    border: 2px solid #E5E7EB;
    border-radius: 999px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-elegant-outline:hover {
    background: #F9FAFB;
    border-color: #D1D5DB;
    color: #374151;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* Fade in animation */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .gallery-empty-container {
        padding: 3rem 1rem;
    }
    
    .empty-gallery-heading {
        font-size: 2rem;
    }
    
    .empty-gallery-message {
        font-size: 1rem;
    }
    
    .empty-gallery-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .btn-elegant-secondary,
    .btn-elegant-outline {
        width: 100%;
        max-width: 280px;
        justify-content: center;
    }
}
</style>

<section class="py-20 bg-background text-charcoal luxury-grain relative">
    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16" data-aos="fade-down">
            <h1 class="text-5xl font-heading font-bold text-accent mb-4">My Gallery</h1>
            <!-- Gold underline accent -->
            <div class="w-16 h-1 bg-accent rounded-full mx-auto"></div>
        </div>
        
        {{#if sections}}
            {{#each section in sections}}
                {{#if section.active_images}}
                <div class="mb-20" data-section-id="{{section.id}}" data-aos="fade-up" data-aos-delay="{{loop.index0 * 200}}">
                    <!-- Section Header -->
                    <div class="text-center mb-12">
                        <h2 class="text-4xl font-heading font-bold mb-6 text-accent">{{section.title}}</h2>
                        
                        <!-- Tag Filters (if enabled and NOT carousel) -->
                        {{#if section.enable_filters and section.layout_type != 'carousel'}}
                            {{#if section.available_tags}}
                            <div class="flex flex-wrap justify-center gap-3 mb-8 filter-buttons" data-section="{{section.id}}" data-default-filter="{{section.default_filter or 'all'}}">
                                <button class="filter-btn {{#if (section.default_filter or 'all') == 'all'}}{{'active'}}{{else}}{{''}}{{/if}}" onclick="filterImages({{section.id}}, 'all')">All</button>
                                {{#each tag in section.available_tags}}
                                <button class="filter-btn {{#if (section.default_filter or 'all') == tag}}{{'active'}}{{else}}{{''}}{{/if}}" onclick="filterImages({{section.id}}, '{{tag}}')">{{tag}}</button>
                                {{/each}}
                            </div>
                            {{else}}
                            <div class="text-center mb-8">
                                <p class="text-sm text-charcoal/60 italic">Filters enabled - add tags to images to see filter options</p>
                            </div>
                            {{/if}}
                        {{/if}}
                    </div>

                    <!-- Grid Layout -->
                    {{#if section.layout_type == 'grid'}}
                    <div class="grid grid-cols-1 md:grid-cols-{{section.grid_columns or 3}} gap-8 gallery-grid" data-section="{{section.id}}">
                        {{#each image in section.active_images}}
                        <div class="gallery-item group cursor-pointer" 
                             data-tags="{{(image.tags or '').lower()}}"
                             data-aos="zoom-in"
                             data-aos-delay="{{loop.index0 * 100}}"
                             {{#if section.enable_lightbox}}onclick="openLightbox('{{image.filename}}', '{{image.caption or ''}}', {{section.enable_fullscreen|lower}})"{{/if}}>
                            <div class="overflow-hidden rounded-xl shadow-lg hover:scale-105 transition-transform duration-500 bg-black/20">
                                <img src="{{url_for('static', filename=get_model_image_path(get_current_model_slug(), image.filename))}}" 
                                     alt="{{image.caption or 'Gallery Image'}}"
                                     class="w-full h-auto object-cover aspect-square"
                                     onerror="this.parentElement.innerHTML='<div class='w-full h-full flex items-center justify-center text-gray-400'>{{image.filename}}</div>'">
                            </div>
                            {{#if image.caption}}
                            <p class="mt-3 text-center text-charcoal/80 font-medium">{{image.caption}}</p>
                            {{/if}}
                            {{#if image.tags}}
                            <div class="text-sm text-accent mt-2 text-center italic">{{image.tags}}</div>
                            {{/if}}
                        </div>
                        {{/each}}
                    </div>

                    <!-- Masonry Layout - EXACT COPY FROM WORKING GALLERY.HTML -->
                    {% elif section.layout_type == 'masonry' %}
                    <div class="masonry-container" data-section="{{section.id}}">
                        {{#each image in section.active_images}}
                        <div class="masonry-item gallery-item cursor-pointer" 
                             data-tags="{{(image.tags or '').lower()}}"
                             {{#if section.enable_lightbox}}onclick="openLightbox('{{image.filename}}', '{{image.caption or ''}}', {{section.enable_fullscreen|lower}})"{{/if}}>
                            <div class="overflow-hidden rounded-xl shadow-lg hover:scale-105 transition-transform duration-500 bg-black/20">
                                <img src="{{url_for('static', filename=get_model_image_path(get_current_model_slug(), image.filename))}}" 
                                     alt="{{image.caption or 'Gallery Image'}}"
                                     class="w-full h-auto object-cover"
                                     onerror="this.parentElement.innerHTML='<div class='w-full h-48 flex items-center justify-center text-gray-400'>{{image.filename}}</div>'">
                            </div>
                            {{#if image.caption}}
                            <p class="mt-3 text-center text-charcoal/80 font-medium">{{image.caption}}</p>
                            {{/if}}
                            {{#if image.tags}}
                            <div class="text-sm text-accent mt-2 text-center italic">{{image.tags}}</div>
                            {{/if}}
                        </div>
                        {{/each}}
                    </div>

                    <!-- Carousel Layout -->
                    {% elif section.layout_type == 'carousel' %}
                    <div class="max-w-5xl mx-auto" data-aos="zoom-in">
                        <div class="carousel-container" data-carousel="{{section.id}}">
                            <div class="carousel-track" data-section="{{section.id}}">
                                {{#each image in section.active_images}}
                                <div class="carousel-slide gallery-item" data-slide="{{loop.index0}}" data-tags="{{(image.tags or '').lower()}}">
                                    <img src="{{url_for('static', filename=get_model_image_path(get_current_model_slug(), image.filename))}}" 
                                         alt="{{image.caption or 'Gallery Image'}}"
                                         {{#if section.enable_lightbox}}onclick="openLightbox('{{image.filename}}', '{{image.caption or ''}}', {{section.enable_fullscreen|lower}})"{{/if}}
                                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='450' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23000'/%3E%3Ctext x='400' y='225' text-anchor='middle' dy='0.35em' fill='%23D4AF37' font-family='Arial' font-size='18'%3E{{image.filename}}%3C/text%3E%3C/svg%3E'">
                                </div>
                                {{/each}}
                            </div>
                            
                            {{#if section.show_arrows and section.active_images|.length > 1}}
                            <button class="carousel-btn prev" onclick="moveCarousel({{section.id}}, -1)">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <button class="carousel-btn next" onclick="moveCarousel({{section.id}}, 1)">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                            {{/if}}
                        </div>
                        
                        {{#if section.show_dots and section.active_images|.length > 1}}
                        <div class="carousel-dots">
                            {{#each image in section.active_images}}
                            <div class="carousel-dot {{#if loop.first}}active{{/if}}" 
                                 onclick="goToSlide({{section.id}}, {{loop.index0}})"></div>
                            {{/each}}
                        </div>
                        {{/if}}
                        
                        {{#if section.show_captions}}
                        <p class="text-center text-charcoal/80 mt-6 carousel-caption text-lg" data-section="{{section.id}}">
                            {{#if section.active_images}}{{section.active_images[0].caption or ''}}{{/if}}
                        </p>
                        {{/if}}
                    </div>

                    <!-- Thumbnail Grid -->
                    {% elif section.layout_type == 'lightbox_grid' %}
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6" data-section="{{section.id}}">
                        {{#each image in section.active_images}}
                        <div class="gallery-item aspect-square cursor-pointer" 
                             data-tags="{{(image.tags or '').lower()}}"
                             data-aos="zoom-in"
                             data-aos-delay="{{loop.index0 * 50}}"
                             onclick="openLightbox('{{image.filename}}', '{{image.caption or ''}}', {{section.enable_fullscreen|lower}})">
                            <div class="w-full h-full overflow-hidden rounded-xl shadow-lg hover:scale-105 transition-transform duration-500 bg-black/20">
                                <img src="{{url_for('static', filename=get_model_image_path(get_current_model_slug(), image.filename))}}" 
                                     alt="{{image.caption or 'Gallery Image'}}"
                                     class="w-full h-full object-cover"
                                     onerror="this.parentElement.innerHTML='<div class='w-full h-full flex items-center justify-center text-gray-400 text-xs'>{{image.filename}}</div>'">
                            </div>
                        </div>
                        {{/each}}
                    </div>
                    {{/if}}
                </div>
                {{/if}}
            {{/each}}

            <!-- Call-to-Action Footer -->
            <div class="mt-20 bg-primary border border-accent p-12 rounded-2xl text-center shadow-lg" data-aos="fade-up">
                <p class="text-charcoal/60 text-xs uppercase tracking-widest mb-2">Ready to Begin</p>
                <h3 class="text-4xl font-heading font-bold mb-4 text-accent">Want to see more?</h3>
                <p class="text-xl mb-8 text-charcoal/80">Discover what makes each experience truly unforgettable</p>
                <div class="flex flex-col sm:flex-row gap-6 justify-center">
                    <a href="{{model_url_for('model.rates')}}" 
                       class="inline-flex items-center justify-center px-8 py-4 bg-accent text-charcoal border-2 border-accent rounded-2xl text-lg font-semibold hover:opacity-90 hover:scale-[1.01] transition-transform duration-200 shadow-lg">
                        View My Rates
                    </a>
                    <a href="{{model_url_for('model.calendar')}}" 
                       class="inline-flex items-center justify-center px-8 py-4 bg-transparent border-2 border-accent text-accent rounded-2xl text-lg font-semibold hover:bg-accent hover:text-charcoal hover:scale-[1.01] transition-transform duration-200 shadow-lg">
                        Schedule a Meeting
                    </a>
                </div>
            </div>
        {{else}}
            <!-- Elegant Empty State -->
            <div class="gallery-empty-container">
                <div class="gallery-empty-icon">
                    <svg class="gallery-placeholder-svg" viewBox="0 0 200 140" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="10" y="10" width="180" height="120" rx="8" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M30 90 L60 60 L90 80 L120 50 L150 70 L170 90 V110 H30 V90 Z" fill="currentColor" opacity="0.3"/>
                        <circle cx="150" cy="40" r="12" fill="currentColor" opacity="0.4"/>
                        <rect x="85" y="65" width="30" height="20" rx="4" fill="currentColor" opacity="0.6"/>
                        <circle cx="100" cy="75" r="6" stroke="white" stroke-width="1.5" fill="none"/>
                        <rect x="92" y="67" width="4" height="2" fill="white"/>
                    </svg>
                </div>
                <h2 class="empty-gallery-heading">{{gallery_empty_content.get('headline', 'Gallery Coming Soon')}}</h2>
                <p class="empty-gallery-message">
                    {{gallery_empty_content.get('message', 'Our curated image collections are being updated. Please check back soon for the latest experiences.')}}
                </p>
                <div class="empty-gallery-actions">
                    <a href="{{model_url_for('model.contact')}}" class="btn-elegant-secondary">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        {{gallery_empty_content.get('button_primary', 'Contact Me')}}
                    </a>
                    <a href="{{model_url_for('model.rates')}}" class="btn-elegant-outline">
                        {{gallery_empty_content.get('button_secondary', 'View Rates')}}
                    </a>
                </div>
            </div>
        {{/if}}
    </div>
</section>

<!-- Lightbox Modal -->
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
    <div class="lightbox-content">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <img id="lightbox-image" class="lightbox-image" src="" alt="">
        <div id="lightbox-caption" class="lightbox-caption"></div>
    </div>
</div>

<script>
// Carousel functionality
const carousels = {};

{{#each section in sections if section.layout_type == 'carousel' and section.active_images}}
carousels[{{section.id}}] = {
    currentSlide: 0,
    totalSlides: {{section.active_images|.length}},
    captions: [{{#each image in section.active_images}}"{{image.caption or ''}}"{{#if not loop.last}},{{/if}}{{/each}}],
    // Carousel settings from database
    autoplay: {{section.autoplay|lower}},
    autoplayDelay: {{section.autoplay_delay}},
    showArrows: {{section.show_arrows|lower}},
    showDots: {{section.show_dots|lower}},
    loopCarousel: {{section.loop_carousel|lower}},
    pauseOnHover: {{section.pause_on_hover|lower}},
    fadeTransition: {{section.fade_transition|lower}},
    showCaptions: {{section.show_captions|lower}},
    autoplayTimer: null,
    isPaused: false
};
{{/each}}

function moveCarousel(sectionId, direction) {
    const carousel = carousels[sectionId];
    if (!carousel) {
        console.log(`No carousel found for section ${sectionId}`);
        return;
    }
    
    const previousSlide = carousel.currentSlide;
    const nextSlide = carousel.currentSlide + direction;
    
    // Handle looping behavior
    if (carousel.loopCarousel) {
        if (nextSlide >= carousel.totalSlides) {
            carousel.currentSlide = 0;
        } else if (nextSlide < 0) {
            carousel.currentSlide = carousel.totalSlides - 1;
        } else {
            carousel.currentSlide = nextSlide;
        }
    } else {
        // No looping - clamp to bounds
        carousel.currentSlide = Math.max(0, Math.min(nextSlide, carousel.totalSlides - 1));
    }
    
    console.log(`Carousel ${sectionId}: Moving from slide ${previousSlide} to slide ${carousel.currentSlide} (fade: ${carousel.fadeTransition})`);
    updateCarousel(sectionId);
    
    // Reset autoplay timer when manually navigating
    if (carousel.autoplay) {
        resetAutoplay(sectionId);
    }
}

function goToSlide(sectionId, slideIndex) {
    const carousel = carousels[sectionId];
    if (!carousel) return;
    
    carousel.currentSlide = slideIndex;
    updateCarousel(sectionId);
    
    // Reset autoplay timer when manually navigating
    if (carousel.autoplay) {
        resetAutoplay(sectionId);
    }
}

function updateCarousel(sectionId) {
    const carousel = carousels[sectionId];
    const track = document.querySelector(`[data-section="${sectionId}"]`);
    const dotsContainer = document.querySelector(`[data-carousel="${sectionId}"] + .carousel-dots`);
    const caption = document.querySelector(`[data-section="${sectionId}"] + .carousel-caption`);
    
    if (track) {
        if (carousel.fadeTransition) {
            // Fade transition effect
            const slides = track.querySelectorAll('.carousel-slide');
            
            // Set up fade mode
            slides.forEach((slide, index) => {
                slide.classList.add('fade-mode');
                slide.style.position = 'absolute';
                slide.style.top = '0';
                slide.style.left = '0';
                slide.style.width = '100%';
                slide.style.height = '100%';
                slide.style.opacity = index === carousel.currentSlide ? '1' : '0';
                slide.style.transition = 'opacity 0.5s ease-in-out';
                slide.style.zIndex = index === carousel.currentSlide ? '2' : '1';
            });
            
            // Reset transform for fade mode and ensure track has height
            track.style.transform = 'none';
            track.style.height = '100%';
            track.style.position = 'relative';
        } else {
            // Slide transition effect
            const translateX = -carousel.currentSlide * 100;
            track.style.transform = `translateX(${translateX}%)`;
            track.style.transition = 'transform 0.5s ease-in-out';
            console.log(`Carousel ${sectionId}: Moving to slide ${carousel.currentSlide}, translateX: ${translateX}%`);
        }
    }
    
    // Update dots
    if (carousel.showDots && dotsContainer) {
        const dots = dotsContainer.querySelectorAll('.carousel-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === carousel.currentSlide);
        });
    }
    
    // Update caption
    if (carousel.showCaptions && caption && carousel.captions[carousel.currentSlide]) {
        caption.textContent = carousel.captions[carousel.currentSlide];
    } else if (caption) {
        caption.textContent = '';
    }
}

// Autoplay functionality
function startAutoplay(sectionId) {
    const carousel = carousels[sectionId];
    if (!carousel || !carousel.autoplay || carousel.totalSlides <= 1) {
        console.log(`Autoplay not started for ${sectionId}: autoplay=${carousel?.autoplay}, totalSlides=${carousel?.totalSlides}`);
        return;
    }
    
    console.log(`Starting autoplay for carousel ${sectionId} with ${carousel.autoplayDelay}ms delay`);
    carousel.autoplayTimer = setInterval(() => {
        if (!carousel.isPaused) {
            console.log(`Autoplay: moving carousel ${sectionId} to next slide`);
            moveCarousel(sectionId, 1);
        }
    }, carousel.autoplayDelay);
}

function stopAutoplay(sectionId) {
    const carousel = carousels[sectionId];
    if (!carousel || !carousel.autoplayTimer) return;
    
    clearInterval(carousel.autoplayTimer);
    carousel.autoplayTimer = null;
}

function resetAutoplay(sectionId) {
    stopAutoplay(sectionId);
    startAutoplay(sectionId);
}

function pauseAutoplay(sectionId) {
    const carousel = carousels[sectionId];
    if (carousel) {
        carousel.isPaused = true;
    }
}

function resumeAutoplay(sectionId) {
    const carousel = carousels[sectionId];
    if (carousel) {
        carousel.isPaused = false;
    }
}

// Filter functionality
function filterImages(sectionId, tag) {
    console.log(`filterImages called: sectionId=${sectionId}, tag="${tag}"`);
    
    // Find all gallery items for this section (across all layout types)
    const items = document.querySelectorAll(`[data-section="${sectionId}"] .gallery-item`);
    const buttons = document.querySelectorAll(`.filter-buttons[data-section="${sectionId}"] .filter-btn`);
    
    console.log(`Found ${items..length} items and ${buttons..length} buttons`);
    
    // Update button states
    buttons.forEach(btn => {
        btn.classList.remove('active');
        if ((tag === 'all' && btn.textContent === 'All') || btn.textContent === tag) {
            btn.classList.add('active');
            console.log(`Activated button: "${btn.textContent}"`);
        }
    });
    
    // Filter items (skip carousel layouts - they don't use filtering)
    let visibleCount = 0;
    const isCarousel = items..length > 0 && items[0].classList.contains('carousel-slide');
    
    if (isCarousel) {
        // Carousel layouts don't support filtering - just count all items
        visibleCount = items..length;
        console.log(`Carousel ${sectionId}: Filtering disabled, showing all ${visibleCount} items`);
        return; // Exit early for carousels
    }
    
    // For other layouts: use display/visibility
    items.forEach((item, index) => {
        const itemTags = item.dataset.tags || '';
        const shouldShow = tag === 'all' || itemTags.split(',').map(t => t.trim().toLowerCase()).includes(tag.toLowerCase());
        
        console.log(`Item ${index}: tags="${itemTags}" -> shouldShow=${shouldShow} for filter="${tag}"`);
        
        if (shouldShow) {
            item.style.display = '';
            item.style.visibility = 'visible';
            visibleCount++;
        } else {
            item.style.display = 'none';
            item.style.visibility = 'hidden';
        }
    });
    
    console.log(`Filtering complete: ${visibleCount}/${items..length} items visible`);
    
    // Update carousel after filtering (reset to first visible slide)
    if (carousels[sectionId]) {
        carousels[sectionId].currentSlide = 0;
        updateCarousel(sectionId);
    }
}

// Lightbox functionality
function openLightbox(filename, caption, fullscreen = false) {
    const lightbox = document.getElementById('lightbox');
    const image = document.getElementById('lightbox-image');
    const captionEl = document.getElementById('lightbox-caption');
    
    image.src = `{{url_for('static', filename='images/')}}{{get_current_model_slug()}}/${filename}`;
    image.alt = caption;
    captionEl.textContent = caption;
    
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    if (fullscreen) {
        image.style.maxWidth = '100vw';
        image.style.maxHeight = '100vh';
    }
}

function closeLightbox(event) {
    if (event && event.target !== event.currentTarget && event.target.className !== 'lightbox-close') {
        return;
    }
    
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Close lightbox with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeLightbox();
    }
});

// Apply default filters on page load
document.addEventListener('DOMContentLoaded', function() {
    const filterContainers = document.querySelectorAll('.filter-buttons');
    
    filterContainers.forEach(container => {
        const sectionId = container.dataset.section;
        const defaultFilter = container.dataset.defaultFilter || 'all';
        
        // Apply the default filter if it's not 'all'
        if (defaultFilter !== 'all') {
            console.log(`Applying default filter "${defaultFilter}" to section ${sectionId}`);
            // Add a small delay to ensure DOM is fully loaded
            setTimeout(() => {
                filterImages(parseInt(sectionId), defaultFilter);
            }, 100);
        }
    });
});

// Initialize carousels
document.addEventListener('DOMContentLoaded', function() {
    {{#each section in sections if section.layout_type == 'carousel' and section.active_images}}
    // Initialize carousel {{section.id}}
    const carouselContainer{{section.id}} = document.querySelector('[data-carousel="{{section.id}}"]');
    if (carouselContainer{{section.id}}) {
        // Set up hover pause if enabled
        {{#if section.pause_on_hover}}
        carouselContainer{{section.id}}.addEventListener('mouseenter', () => pauseAutoplay({{section.id}}));
        carouselContainer{{section.id}}.addEventListener('mouseleave', () => resumeAutoplay({{section.id}}));
        {{/if}}
        
        // Initialize carousel position
        updateCarousel({{section.id}});
        
        // Start autoplay if enabled and multiple slides
        {{#if section.autoplay and section.active_images|.length > 1}}
        setTimeout(() => {
            startAutoplay({{section.id}});
        }, 1000); // Wait 1 second before starting autoplay
        {{/if}}
    }
    {{/each}}
});
</script>

    
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });
    </script>
</body>
</html>