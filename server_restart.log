ğŸ” Testing database connection...
âœ… Database connected successfully
ğŸš€ MuseNest Server Started
ğŸ“ Server running on port 3000
ğŸŒ Environment: development
ğŸ”— Health check: http://localhost:3000/health

Next steps:
1. Copy .env.example to .env and configure your database
2. Run: npm run migrate (to set up database)
3. Run: npm run seed (to add sample data)
Loaded 0 active impersonation sessions
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'test-auto.jpg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753676542809-749171361.jpg',
  originalName: 'test-auto.jpg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676542821_test-auto.jpg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 892ms
ğŸ“Š Status: 200, Content-Length: 1766
ğŸ Complete response received in 892ms, size: 1766 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=87.17185258865356, pose=highly_suggestive, suggestive=0.8500000000000001
âœ… Transformation complete, final nudity score: 87.17185258865356
ğŸ­ Pose analysis: highly_suggestive (0.8500000000000001)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: {
    body_orientation: 'side_view',
    hip_bend_angle: 86.28759205998954,
    leg_spread: 0.015516996383666992,
    reasoning: [
      'bent_over_pose',
      'extreme_torso_angle',
      'side_view_bent_posture'
    ],
    torso_angle: 85.9160634581342
  },
  pose_category: 'highly_suggestive',
  pose_detected: true,
  raw_metrics: {
    body_orientation: 'side_view',
    hip_bend_angle: 86.28759205998954,
    leg_spread: 0.015516996383666992,
    shoulder_width: 0.02084273099899292,
    torso_angle: 85.9160634581342
  },
  suggestive_score: 0.8500000000000001
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 86.5202968120575,
  nudity_contribution: 87.17185258865356,
  pose_contribution: 85.00000000000001,
  reasoning: [ 'nudity_detected_87.2%', 'suggestive_pose_highly_suggestive' ],
  risk_level: 'high'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 10ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 2ms
Content flagged and added to moderation queue: 188
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 915ms
ğŸ“Š Result: success=true, status=flagged, nudity=87.17185258865356
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753676600629-717779335.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676600646_BlowJob.jpg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 2985ms
ğŸ“Š Status: 200, Content-Length: 1089
ğŸ Complete response received in 2996ms, size: 1089 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=78.75638008117676, pose=no_pose_detected, suggestive=0
âœ… Transformation complete, final nudity score: 78.75638008117676
ğŸ­ Pose analysis: no_pose_detected (0)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: { reasoning: [ 'no_pose_landmarks_found' ] },
  pose_category: 'no_pose_detected',
  pose_detected: false,
  suggestive_score: 0
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 70.88074207305908,
  nudity_contribution: 78.75638008117676,
  pose_contribution: 0,
  reasoning: [ 'content_appears_safe' ],
  risk_level: 'medium'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 3ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 189
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 3004ms
ğŸ“Š Result: success=true, status=flagged, nudity=78.75638008117676
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753676714790-236428047.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676714812_BlowJob.jpg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 1379ms
ğŸ“Š Status: 200, Content-Length: 1089
ğŸ Complete response received in 1391ms, size: 1089 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=78.75638008117676, pose=no_pose_detected, suggestive=0
âœ… Transformation complete, final nudity score: 78.75638008117676
ğŸ­ Pose analysis: no_pose_detected (0)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: { reasoning: [ 'no_pose_landmarks_found' ] },
  pose_category: 'no_pose_detected',
  pose_detected: false,
  suggestive_score: 0
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 70.88074207305908,
  nudity_contribution: 78.75638008117676,
  pose_contribution: 0,
  reasoning: [ 'content_appears_safe' ],
  risk_level: 'medium'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 4ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 2ms
Content flagged and added to moderation queue: 190
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 1402ms
ğŸ“Š Result: success=true, status=flagged, nudity=78.75638008117676
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Labia.jpg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753676729886-186015802.jpg',
  originalName: 'Labia.jpg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676729897_Labia.jpg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 1417ms
ğŸ“Š Status: 200, Content-Length: 1092
ğŸ Complete response received in 1429ms, size: 1092 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=65.223228931427, pose=no_pose_detected, suggestive=0
âœ… Transformation complete, final nudity score: 65.223228931427
ğŸ­ Pose analysis: no_pose_detected (0)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: { reasoning: [ 'no_pose_landmarks_found' ] },
  pose_category: 'no_pose_detected',
  pose_detected: false,
  suggestive_score: 0
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 45.6562602519989,
  nudity_contribution: 65.223228931427,
  pose_contribution: 0,
  reasoning: [ 'nudity_detected_65.2%' ],
  risk_level: 'low'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 3ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 191
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 1438ms
ğŸ“Š Result: success=true, status=flagged, nudity=65.223228931427
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Approve blur request for ID: 182
Request body: {
  blur_settings: {
    strength: 7,
    opacity: 0.2,
    shape: 'rounded',
    blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
    overlayPositions: { FEMALE_GENITALIA_EXPOSED: [Object] }
  },
  admin_notes: '',
  reviewed_by: 1
}
Raw request body: {
  "blur_settings": {
    "strength": 7,
    "opacity": 0.2,
    "shape": "rounded",
    "blurredParts": [
      "FEMALE_GENITALIA_EXPOSED"
    ],
    "overlayPositions": {
      "FEMALE_GENITALIA_EXPOSED": {
        "x": 880,
        "y": 940,
        "width": 1106,
        "height": 2415,
        "confidence": 45.70100009441376
      }
    }
  },
  "admin_notes": "",
  "reviewed_by": 1
}
Extracted blur_settings: {
  strength: 7,
  opacity: 0.2,
  shape: 'rounded',
  blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    FEMALE_GENITALIA_EXPOSED: {
      x: 880,
      y: 940,
      width: 1106,
      height: 2415,
      confidence: 45.70100009441376
    }
  }
}
Extracted admin_notes type and length: string 0
Extracted reviewed_by type and value: number 1
=== SHAPE DEBUG START ===
blur_settings received: {
  "strength": 7,
  "opacity": 0.2,
  "shape": "rounded",
  "blurredParts": [
    "FEMALE_GENITALIA_EXPOSED"
  ],
  "overlayPositions": {
    "FEMALE_GENITALIA_EXPOSED": {
      "x": 880,
      "y": 940,
      "width": 1106,
      "height": 2415,
      "confidence": 45.70100009441376
    }
  }
}
shape value: rounded
shape type: string
=== SHAPE DEBUG END ===
Starting blur processing...
Creating blurred version with settings: {
  strength: 7,
  opacity: 0.2,
  shape: 'rounded',
  blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    FEMALE_GENITALIA_EXPOSED: {
      x: 880,
      y: 940,
      width: 1106,
      height: 2415,
      confidence: 45.70100009441376
    }
  }
}
Original path: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676729897_Labia.jpg
Output path: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676789788_1753676729897_Labia.jpg
=== COORDINATE DEBUGGING START ===
FEMALE_GENITALIA_EXPOSED coordinates from admin interface: {
  x: 880,
  y: 940,
  width: 1106,
  height: 2415,
  confidence: 45.70100009441376
}
Raw image dimensions: 4000 x 3000 orientation: 6
Auto-rotated image dimensions: 4000 x 3000
Applying selective blur to regions: [ 'FEMALE_GENITALIA_EXPOSED' ]
Blur calibration: admin setting 7px â†’ actual 17.5px (2.5x factor)
Processing blur for FEMALE_GENITALIA_EXPOSED (received coords): {
  x: 880,
  y: 940,
  width: 1106,
  height: 2415,
  confidence: 45.70100009441376
}
Auto-rotated image dimensions: 4000x3000
EXIF 6 coordinate transformation:
  Admin coords: x=880, y=940, w=1106, h=2415
  Raw coords: x=940, y=1014, w=2415, h=1106
Final blur coordinates for processing: 940,1014 2415x1106
Composite will use admin coordinates after rotation: 880,940
DEBUG: Would extract region at 940,1014 2415x1106
Rotated extracted region 90Â° clockwise to match final image orientation
Creating blurred region with 17.5px blur...
Blur shape setting received: 'rounded' (type: string)
DEBUG: Using shape = 'rounded' (original was 'rounded')
TESTING: actualShape='rounded', blurShape='rounded'
*** ROUNDED SHAPE DETECTED - APPLYING ROUNDED RECTANGLE MASK ***
Applying rounded rectangle shape to FEMALE_GENITALIA_EXPOSED blur region
Creating rounded rectangle mask with 221.20000000000002px corners for 1106x2415 region
Applied rounded rectangle mask with 221.20000000000002px corners
Successfully applied rounded mask to FEMALE_GENITALIA_EXPOSED
DEBUG: Applied 17.5px blur to FEMALE_GENITALIA_EXPOSED region
Creating white overlay with opacity: 0.5 (50%)
Applying rounded rectangle shape to white overlay to match blur
Compositing white overlay onto blurred region...
White overlay composite completed
Extracted from RAW image at: 940,1014 2415x1106
Applied blur radius: 17.5px (7px setting)
Applied white overlay with 50% opacity (enhanced from 20%)
Preparing for composite at: 880,940
Applying 1 blur regions in single composite operation
Applying EXIF rotation to final output for proper display orientation
Attempting to save processed image to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676789788_1753676729897_Labia.jpg
SUCCESS: Blurred image saved successfully to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676789788_1753676729897_Labia.jpg
File verification - Size: 1958693 bytes
Blur processing completed, path: /uploads/escort-example/public/blurred/blurred_1753676789788_1753676729897_Labia.jpg
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676729897_Labia.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/public/1753676729897_Labia.jpg
Updating content_moderation record with ID: 191
Blur settings JSON: {"strength":7,"opacity":0.2,"shape":"rounded","blurredParts":["FEMALE_GENITALIA_EXPOSED"],"overlayPositions":{"FEMALE_GENITALIA_EXPOSED":{"x":880,"y":940,"width":1106,"height":2415,"confidence":45.70100009441376}}}
Admin notes: 
Reviewed by: 1
Starting content_moderation update process...
Content moderation ID: 191
Content moderation update successful, affected rows: undefined
Verified record after update: { moderation_status: 'approved', final_location: 'public_blurred' }
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Labia.jpg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753676869000-651180948.jpg',
  originalName: 'Labia.jpg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676869011_Labia.jpg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 6325ms
ğŸ“Š Status: 200, Content-Length: 1092
ğŸ Complete response received in 6336ms, size: 1092 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=65.223228931427, pose=no_pose_detected, suggestive=0
âœ… Transformation complete, final nudity score: 65.223228931427
ğŸ­ Pose analysis: no_pose_detected (0)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: { reasoning: [ 'no_pose_landmarks_found' ] },
  pose_category: 'no_pose_detected',
  pose_detected: false,
  suggestive_score: 0
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 45.6562602519989,
  nudity_contribution: 65.223228931427,
  pose_contribution: 0,
  reasoning: [ 'nudity_detected_65.2%' ],
  risk_level: 'low'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 5ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 192
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 6346ms
ğŸ“Š Result: success=true, status=flagged, nudity=65.223228931427
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Approve blur request for ID: 183
Request body: {
  blur_settings: {
    strength: 22,
    opacity: 0.2,
    shape: 'rounded',
    blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
    overlayPositions: { FEMALE_GENITALIA_EXPOSED: [Object] }
  },
  admin_notes: '',
  reviewed_by: 1
}
Raw request body: {
  "blur_settings": {
    "strength": 22,
    "opacity": 0.2,
    "shape": "rounded",
    "blurredParts": [
      "FEMALE_GENITALIA_EXPOSED"
    ],
    "overlayPositions": {
      "FEMALE_GENITALIA_EXPOSED": {
        "x": 887,
        "y": 940,
        "width": 1099,
        "height": 3036,
        "confidence": 45.70100009441376
      }
    }
  },
  "admin_notes": "",
  "reviewed_by": 1
}
Extracted blur_settings: {
  strength: 22,
  opacity: 0.2,
  shape: 'rounded',
  blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    FEMALE_GENITALIA_EXPOSED: {
      x: 887,
      y: 940,
      width: 1099,
      height: 3036,
      confidence: 45.70100009441376
    }
  }
}
Extracted admin_notes type and length: string 0
Extracted reviewed_by type and value: number 1
=== SHAPE DEBUG START ===
blur_settings received: {
  "strength": 22,
  "opacity": 0.2,
  "shape": "rounded",
  "blurredParts": [
    "FEMALE_GENITALIA_EXPOSED"
  ],
  "overlayPositions": {
    "FEMALE_GENITALIA_EXPOSED": {
      "x": 887,
      "y": 940,
      "width": 1099,
      "height": 3036,
      "confidence": 45.70100009441376
    }
  }
}
shape value: rounded
shape type: string
=== SHAPE DEBUG END ===
Starting blur processing...
Creating blurred version with settings: {
  strength: 22,
  opacity: 0.2,
  shape: 'rounded',
  blurredParts: [ 'FEMALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    FEMALE_GENITALIA_EXPOSED: {
      x: 887,
      y: 940,
      width: 1099,
      height: 3036,
      confidence: 45.70100009441376
    }
  }
}
Original path: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676869011_Labia.jpg
Output path: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676963983_1753676869011_Labia.jpg
=== COORDINATE DEBUGGING START ===
FEMALE_GENITALIA_EXPOSED coordinates from admin interface: {
  x: 887,
  y: 940,
  width: 1099,
  height: 3036,
  confidence: 45.70100009441376
}
Raw image dimensions: 4000 x 3000 orientation: 6
Auto-rotated image dimensions: 4000 x 3000
Applying selective blur to regions: [ 'FEMALE_GENITALIA_EXPOSED' ]
Blur calibration: admin setting 22px â†’ actual 55px (2.5x factor)
Processing blur for FEMALE_GENITALIA_EXPOSED (received coords): {
  x: 887,
  y: 940,
  width: 1099,
  height: 3036,
  confidence: 45.70100009441376
}
Auto-rotated image dimensions: 4000x3000
EXIF 6 coordinate transformation:
  Admin coords: x=887, y=940, w=1099, h=3036
  Raw coords: x=940, y=1014, w=3036, h=1099
Final blur coordinates for processing: 940,1014 3036x1099
Composite will use admin coordinates after rotation: 887,940
DEBUG: Would extract region at 940,1014 3036x1099
Rotated extracted region 90Â° clockwise to match final image orientation
Creating blurred region with 55px blur...
Blur shape setting received: 'rounded' (type: string)
DEBUG: Using shape = 'rounded' (original was 'rounded')
TESTING: actualShape='rounded', blurShape='rounded'
*** ROUNDED SHAPE DETECTED - APPLYING ROUNDED RECTANGLE MASK ***
Applying rounded rectangle shape to FEMALE_GENITALIA_EXPOSED blur region
Creating rounded rectangle mask with 219.8px corners for 1099x3036 region
Applied rounded rectangle mask with 219.8px corners
Successfully applied rounded mask to FEMALE_GENITALIA_EXPOSED
DEBUG: Applied 55px blur to FEMALE_GENITALIA_EXPOSED region
Creating white overlay with opacity: 0.5 (50%)
Applying rounded rectangle shape to white overlay to match blur
Compositing white overlay onto blurred region...
White overlay composite completed
Extracted from RAW image at: 940,1014 3036x1099
Applied blur radius: 55px (22px setting)
Applied white overlay with 50% opacity (enhanced from 20%)
Preparing for composite at: 887,940
Applying 1 blur regions in single composite operation
Applying EXIF rotation to final output for proper display orientation
Attempting to save processed image to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676963983_1753676869011_Labia.jpg
SUCCESS: Blurred image saved successfully to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753676963983_1753676869011_Labia.jpg
File verification - Size: 1815905 bytes
Blur processing completed, path: /uploads/escort-example/public/blurred/blurred_1753676963983_1753676869011_Labia.jpg
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676869011_Labia.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/public/1753676869011_Labia.jpg
Updating content_moderation record with ID: 192
Blur settings JSON: {"strength":22,"opacity":0.2,"shape":"rounded","blurredParts":["FEMALE_GENITALIA_EXPOSED"],"overlayPositions":{"FEMALE_GENITALIA_EXPOSED":{"x":887,"y":940,"width":1099,"height":3036,"confidence":45.70100009441376}}}
Admin notes: 
Reviewed by: 1
Starting content_moderation update process...
Content moderation ID: 192
Content moderation update successful, affected rows: undefined
Verified record after update: { moderation_status: 'approved', final_location: 'public_blurred' }
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676714812_BlowJob.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753676714812_BlowJob.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676600646_BlowJob.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753676600646_BlowJob.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753676542821_test-auto.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753676542821_test-auto.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753675770958_BlowJob.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753675770958_BlowJob.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753675743057_NightBreasts.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753675743057_NightBreasts.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753675723650_NightBreasts.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753675723650_NightBreasts.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753675704991_x-sex-1.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753675704991_x-sex-1.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753675192698_x-sex-1.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753675192698_x-sex-1.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Approve blur request for ID: 173
Request body: {
  blur_settings: {
    strength: 15,
    opacity: 0.8,
    shape: 'rounded',
    blurredParts: [ 'MALE_GENITALIA_EXPOSED' ],
    overlayPositions: { MALE_GENITALIA_EXPOSED: [Object] }
  },
  admin_notes: 'sdf',
  reviewed_by: 1
}
Raw request body: {
  "blur_settings": {
    "strength": 15,
    "opacity": 0.8,
    "shape": "rounded",
    "blurredParts": [
      "MALE_GENITALIA_EXPOSED"
    ],
    "overlayPositions": {
      "MALE_GENITALIA_EXPOSED": {
        "x": 41,
        "y": 18,
        "width": 100,
        "height": 100,
        "confidence": 33.018410205841064
      }
    }
  },
  "admin_notes": "sdf",
  "reviewed_by": 1
}
Extracted blur_settings: {
  strength: 15,
  opacity: 0.8,
  shape: 'rounded',
  blurredParts: [ 'MALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    MALE_GENITALIA_EXPOSED: {
      x: 41,
      y: 18,
      width: 100,
      height: 100,
      confidence: 33.018410205841064
    }
  }
}
Extracted admin_notes type and length: string 3
Extracted reviewed_by type and value: number 1
=== SHAPE DEBUG START ===
blur_settings received: {
  "strength": 15,
  "opacity": 0.8,
  "shape": "rounded",
  "blurredParts": [
    "MALE_GENITALIA_EXPOSED"
  ],
  "overlayPositions": {
    "MALE_GENITALIA_EXPOSED": {
      "x": 41,
      "y": 18,
      "width": 100,
      "height": 100,
      "confidence": 33.018410205841064
    }
  }
}
shape value: rounded
shape type: string
=== SHAPE DEBUG END ===
Starting blur processing...
Creating blurred version with settings: {
  strength: 15,
  opacity: 0.8,
  shape: 'rounded',
  blurredParts: [ 'MALE_GENITALIA_EXPOSED' ],
  overlayPositions: {
    MALE_GENITALIA_EXPOSED: {
      x: 41,
      y: 18,
      width: 100,
      height: 100,
      confidence: 33.018410205841064
    }
  }
}
Original path: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674622202_x-sex-1.jpeg
Output path: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753677187818_1753674622202_x-sex-1.jpeg
=== COORDINATE DEBUGGING START ===
MALE_GENITALIA_EXPOSED coordinates from admin interface: {
  x: 41,
  y: 18,
  width: 100,
  height: 100,
  confidence: 33.018410205841064
}
Raw image dimensions: 300 x 168 orientation: undefined
Auto-rotated image dimensions: 300 x 168
Applying selective blur to regions: [ 'MALE_GENITALIA_EXPOSED' ]
Blur calibration: admin setting 15px â†’ actual 37.5px (2.5x factor)
Processing blur for MALE_GENITALIA_EXPOSED (received coords): {
  x: 41,
  y: 18,
  width: 100,
  height: 100,
  confidence: 33.018410205841064
}
Auto-rotated image dimensions: 300x168
No coordinate transformation needed:
  Direct coords: x=41, y=18, w=100, h=100
Final blur coordinates for processing: 41,18 100x100
DEBUG: Would extract region at 41,18 100x100
Creating blurred region with 37.5px blur...
Blur shape setting received: 'rounded' (type: string)
DEBUG: Using shape = 'rounded' (original was 'rounded')
TESTING: actualShape='rounded', blurShape='rounded'
*** ROUNDED SHAPE DETECTED - APPLYING ROUNDED RECTANGLE MASK ***
Applying rounded rectangle shape to MALE_GENITALIA_EXPOSED blur region
Creating rounded rectangle mask with 20px corners for 100x100 region
Applied rounded rectangle mask with 20px corners
Successfully applied rounded mask to MALE_GENITALIA_EXPOSED
DEBUG: Applied 37.5px blur to MALE_GENITALIA_EXPOSED region
Creating white overlay with opacity: 1 (100%)
Applying rounded rectangle shape to white overlay to match blur
Compositing white overlay onto blurred region...
White overlay composite completed
Extracted from RAW image at: 41,18 100x100
Applied blur radius: 37.5px (15px setting)
Applied white overlay with 100% opacity (enhanced from 80%)
Preparing for composite at: 41,18
Applying 1 blur regions in single composite operation
No EXIF orientation found, keeping RAW image as-is
Attempting to save processed image to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753677187818_1753674622202_x-sex-1.jpeg
SUCCESS: Blurred image saved successfully to: /Users/programmer/Projects/musenest/public/uploads/escort-example/public/blurred/blurred_1753677187818_1753674622202_x-sex-1.jpeg
File verification - Size: 5405 bytes
Blur processing completed, path: /uploads/escort-example/public/blurred/blurred_1753677187818_1753674622202_x-sex-1.jpeg
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674622202_x-sex-1.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/public/1753674622202_x-sex-1.jpeg
Updating content_moderation record with ID: 182
Blur settings JSON: {"strength":15,"opacity":0.8,"shape":"rounded","blurredParts":["MALE_GENITALIA_EXPOSED"],"overlayPositions":{"MALE_GENITALIA_EXPOSED":{"x":41,"y":18,"width":100,"height":100,"confidence":33.018410205841064}}}
Admin notes: sdf
Reviewed by: 1
Starting content_moderation update process...
Content moderation ID: 182
Content moderation update successful, affected rows: undefined
Verified record after update: { moderation_status: 'approved', final_location: 'public_blurred' }
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674610290_x-penetration.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753674610290_x-penetration.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674557524_NightBreasts.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753674557524_NightBreasts.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674536246_BendoverAss.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753674536246_BendoverAss.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753674457972_BacksideClean.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753674457972_BacksideClean.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753673380203_BacksideClean.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753673380203_BacksideClean.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671970787_BacksideClean.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671970787_BacksideClean.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671925814_x-penetration.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671925814_x-penetration.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671884984_PullingNipples.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671884984_PullingNipples.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671627176_X-sec.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671627176_X-sec.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671588896_HoldingTits.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671588896_HoldingTits.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671549064_HoldingTits.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671549064_HoldingTits.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671475031_BacksideClean.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671475031_BacksideClean.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671442046_BlowJob.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671442046_BlowJob.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671429962_Labia.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671429962_Labia.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671402725_r-sex.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671402725_r-sex.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671165105_r-sex.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671165105_r-sex.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671039782_Labia.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671039782_Labia.jpg
Query test with limit/offset interpolation
Query executed successfully, got 20 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753671009095_x-penetration.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753671009095_x-penetration.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 19 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670958001_x-penetration.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670958001_x-penetration.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 18 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670926062_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670926062_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 17 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670904044_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670904044_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 16 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670878823_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670878823_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 15 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670818299_x-penetration.jpeg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670818299_x-penetration.jpeg
Query test with limit/offset interpolation
Query executed successfully, got 14 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670795294_BendoverAss.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670795294_BendoverAss.jpg
Query test with limit/offset interpolation
Query executed successfully, got 13 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753670741793_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753670741793_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 12 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669936195_BendoverAss.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669936195_BendoverAss.jpg
Query test with limit/offset interpolation
Query executed successfully, got 11 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669887447_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669887447_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 10 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669835769_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669835769_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 9 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669633737_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669633737_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 8 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669574988_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669574988_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 7 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669463492_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669463492_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 6 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669335682_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669335682_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 5 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669275695_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669275695_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 4 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669231002_test_small.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669231002_test_small.jpg
Query test with limit/offset interpolation
Query executed successfully, got 3 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669183711_1753575572332_20250622_003419.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669183711_1753575572332_20250622_003419.jpg
Query test with limit/offset interpolation
Query executed successfully, got 2 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669139048_1753575572332_20250622_003419.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669139048_1753575572332_20250622_003419.jpg
Query test with limit/offset interpolation
Query executed successfully, got 1 items
Media file moved: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753669028742_1753575572332_20250622_003419.jpg â†’ /Users/programmer/Projects/musenest/public/uploads/escort-example/rejected/1753669028742_1753575572332_20250622_003419.jpg
Query test with limit/offset interpolation
Query executed successfully, got 0 items
Received upload request: {
  model_id: '1',
  model_slug: 'escort-example',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'X-sec.jpeg'
}
ğŸš€ Processing upload for model escort-example with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753677311953-112435291.jpeg',
  originalName: 'X-sec.jpeg',
  modelId: 1,
  modelSlug: 'escort-example',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escort-example
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escort-example/originals/1753677311955_X-sec.jpeg
ğŸ“¡ Target: 52.15.235.216:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
âœ… Enhanced API response received in 215ms
ğŸ“Š Status: 200, Content-Length: 1872
ğŸ Complete response received in 222ms, size: 1872 bytes
âœ… JSON parsed successfully, success: true
ğŸ¯ Transforming enhanced API response...
ğŸ“Š Raw API results: nudity=77.13833451271057, pose=highly_suggestive, suggestive=0.8500000000000001
âœ… Transformation complete, final nudity score: 71.16628289222717
ğŸ­ Pose analysis: highly_suggestive (0.8500000000000001)
ğŸ” Debug - Full transformed result keys: [
  'detected_parts',
  'part_locations',
  'nudity_score',
  'has_nudity',
  'pose_analysis',
  'combined_assessment',
  'moderation_decision',
  'explicit_pose_score',
  'final_risk_score',
  'risk_level',
  'pose_category',
  'success',
  'analysis_version'
]
ğŸ” Debug - Pose analysis data: {
  details: {
    body_orientation: 'side_view',
    hip_bend_angle: 85.68247873626919,
    leg_spread: 0.10303080081939697,
    reasoning: [
      'bent_over_pose',
      'extreme_torso_angle',
      'side_view_bent_posture'
    ],
    torso_angle: 50.3754481212632
  },
  pose_category: 'highly_suggestive',
  pose_detected: true,
  raw_metrics: {
    body_orientation: 'side_view',
    hip_bend_angle: 85.68247873626919,
    leg_spread: 0.10303080081939697,
    shoulder_width: 0.08878228068351746,
    torso_angle: 50.3754481212632
  },
  suggestive_score: 0.8500000000000001
}
ğŸ” Debug - Combined assessment: {
  final_risk_score: 79.4968341588974,
  nudity_contribution: 77.13833451271057,
  pose_contribution: 85.00000000000001,
  reasoning: [ 'nudity_detected_77.1%', 'suggestive_pose_highly_suggestive' ],
  risk_level: 'medium'
}
Error loading moderation rules: SyntaxError: "[object Object]" is not valid JSON
    at JSON.parse (<anonymous>)
    at /Users/programmer/Projects/musenest/src/services/ContentModerationService.js:31:33
    at Array.forEach (<anonymous>)
    at ContentModerationService.loadModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:28:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async ContentModerationService.applyModerationRules (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:432:54)
    at async ContentModerationService.processUploadedImage (/Users/programmer/Projects/musenest/src/services/ContentModerationService.js:140:38)
    at async /Users/programmer/Projects/musenest/routes/api/enhanced-content-moderation.js:89:24
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 3ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 193
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 229ms
ğŸ“Š Result: success=true, status=flagged, nudity=71.16628289222717
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
Query test with limit/offset interpolation
Query executed successfully, got 1 items
Impersonation middleware called for: /api/auth/me
Query test with limit/offset interpolation
Query executed successfully, got 1 items
