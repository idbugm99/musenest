
> musenest@1.0.0 start
> node server.js

🔍 Testing database connection...
✅ Database connected successfully
🚀 MuseNest Server Started
📍 Server running on port 3000
🌍 Environment: development
🔗 Health check: http://localhost:3000/health

Next steps:
1. Copy .env.example to .env and configure your database
2. Run: npm run migrate (to set up database)
3. Run: npm run seed (to add sample data)
Loaded 0 active impersonation sessions
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Requesting BLIP analysis for batch: batch_1754585977_b8328be6
🌍 Target URL: http://18.221.22.72:5000/retrieve-blip
📤 Request payload: {
  batch_id: 'batch_1754585977_b8328be6',
  request_timestamp: '2025-08-07T17:12:41.129Z',
  source: 'musenest_test_interface'
}
📥 BLIP server response: { detail: 'Batch ID not found or expired' }
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1754587320213-653714767.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1754587320239_BlowJob.jpg
📡 Target: 18.221.22.72:5000/analyze
✅ Loaded analysis configuration for public_site (global)
📋 Using analysis configuration: {"blip_components":{"age_estimation":true,"image_description":true,"child_content_detection":true},"nudenet_components":{"anus_detection":true,"face_detection":true,"breast_detection":true,"buttocks_detection":true,"genitalia_detection":true}}
🔧 DEBUG: Sending fields - model_slug="escortexample", usage_intent="public_site", model_id="1"
📊 Analysis components enabled:
  NudeNet: breast=true, genitalia=true, face=true
  BLIP: age=true, child=true, desc=true
🚨 DEV MODE: Using ngrok URL for webhooks: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
📡 Webhook URL provided: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
📝 Form data prepared: context_type=public_gallery, model_id=1, model_slug=escortexample, usage_intent=public_site
📡 Webhook URL: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
🚀 Sending request to EC2 server...
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 2617ms
📊 Status: 200, Content-Length: 1063
🏁 Complete response received in 2618ms, size: 1063 bytes
📄 Raw response preview: {"success":true,"message":"Image flagged for human review due to detected content","data":{"batch_id":"batch_1754587321_4961a7d1","model_id":1,"content_moderation_id":1,"moderation_status":"flagged","usage_intent":"public_gallery","nudity_score":78.8359522819519,"flagged":true,"human_review_required":true,"final_location":"flagged","detected_parts":{"FACE_FEMALE":78.8359522819519,"MALE_GENITALIA_EXPOSED":25.873291492462158},"part_locations":{"FACE_FEMALE":{"x":1661,"y":1562,"width":-603,"height"...
✅ JSON parsed successfully, success: true
🔍 Response validation: isValid=true, hasBatchId=false, hasDetectedParts=false
🎯 Transforming enhanced API response...
🔍 DEBUG - Complete API response structure:
{
  "success": true,
  "message": "Image flagged for human review due to detected content",
  "data": {
    "batch_id": "batch_1754587321_4961a7d1",
    "model_id": 1,
    "content_moderation_id": 1,
    "moderation_status": "flagged",
    "usage_intent": "public_gallery",
    "nudity_score": 78.8359522819519,
    "flagged": true,
    "human_review_required": true,
    "final_location": "flagged",
    "detected_parts": {
      "FACE_FEMALE": 78.8359522819519,
      "MALE_GENITALIA_EXPOSED": 25.873291492462158
    },
    "part_locations": {
      "FACE_FEMALE": {
        "x": 1661,
        "y": 1562,
        "width": -603,
        "height": -558,
        "confidence": 78.8359522819519
      },
      "MALE_GENITALIA_EXPOSED": {
        "x": 2069,
        "y": 2343,
        "width": -1533,
        "height": -1703,
        "confidence": 25.873291492462158
      }
    },
    "pose_analysis": {
      "pose_detected": false,
      "pose_category": "direct_nudenet_mode",
      "suggestive_score": 0,
      "details": {
        "reasoning": [
          "direct_nudenet_analysis_only"
        ]
      }
    },
    "pose_classification": "unknown",
    "explicit_pose_score": 0,
    "final_risk_score": 78.8359522819519,
    "risk_level": "high",
    "combined_assessment": {
      "final_risk_score": 78.8359522819519,
      "risk_level": "high",
      "reasoning": [
        "direct_nudenet_only",
        "no_face_or_description_analysis"
      ]
    }
  }
}
📊 Raw API results: nudity=undefined, faces=undefined, minAge=undefined, risk=undefined
📝 Image description found: undefined
🔄 Detected webhook-style response - transforming to v3 structure
🔍 DEBUG: Input nudity_score = 78.8359522819519
🔍 DEBUG: Input detected_parts = [ 'FACE_FEMALE', 'MALE_GENITALIA_EXPOSED' ]
🔍 DEBUG: Output nudity_score = 78.8359522819519
📋 Batch ID received: batch_1754587321_4961a7d1
✅ Transformation complete, final nudity score: 78.8359522819519
🎭 Pose analysis: undefined (undefined)
🔍 Debug - Full transformed result keys: [
  'detected_parts',        'part_locations',
  'nudity_score',          'has_nudity',
  'face_analysis',         'face_count',
  'min_detected_age',      'max_detected_age',
  'underage_detected',     'age_risk_multiplier',
  'image_description',     'description_text',
  'description_tags',      'contains_children',
  'description_risk',      'final_risk_score',
  'risk_level',            'risk_reasoning',
  'combined_assessment',   'pose_analysis',
  'moderation_decision',   'moderation_status',
  'human_review_required', 'flagged',
  'auto_rejected',         'rejection_reason',
  'batch_id',              'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  pose_detected: false,
  pose_category: 'webhook_analysis_pending',
  suggestive_score: 0,
  details: {
    reasoning: [ 'webhook_nudity_complete', 'blip_pending' ],
    batch_id: 'batch_1754587321_4961a7d1'
  }
}
🔍 Debug - Combined assessment: {
  final_risk_score: 78.8359522819519,
  risk_level: 'high',
  reasoning: [ 'webhook_response', 'blip_analysis_pending' ],
  batch_id: 'batch_1754587321_4961a7d1'
}
🔍 DEBUG aiAnalysis keys: [
  'detected_parts',        'part_locations',
  'nudity_score',          'has_nudity',
  'face_analysis',         'face_count',
  'min_detected_age',      'max_detected_age',
  'underage_detected',     'age_risk_multiplier',
  'image_description',     'description_text',
  'description_tags',      'contains_children',
  'description_risk',      'final_risk_score',
  'risk_level',            'risk_reasoning',
  'combined_assessment',   'pose_analysis',
  'moderation_decision',   'moderation_status',
  'human_review_required', 'flagged',
  'auto_rejected',         'rejection_reason',
  'batch_id',              'success',
  'analysis_version'
]
🔍 DEBUG aiAnalysis.batch_id: batch_1754587321_4961a7d1
🔍 DEBUG aiAnalysis.moderation_status: flagged
✅ EC2 returned complete response with batch_id: batch_1754587321_4961a7d1
📋 Saving EC2 response directly to database without modification
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 5ms
🔌 Database connection released
✅ Upload processing completed in 2632ms
📊 Result: success=true, status=flagged, nudity=78.8359522819519
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 180 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.final_risk_score, cm.risk_level,
                cm.face_analysis, cm.face_count, cm.min_detected_age, cm.max_detected_age,
                cm.underage_detected, cm.image_description, cm.description_text,
                cm.moderation_status, cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 180 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, 
                final_risk_score, risk_level,
                review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 180 ]
Database query error: Error: Unknown column 'created_at' in 'field list'
    at PromisePool.query (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:36:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:167:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                id, content_moderation_id, model_id, model_name, image_path,\n' +
    '                nudity_score, detected_parts, part_locations, \n' +
    '                final_risk_score, risk_level,\n' +
    '                review_status, priority, queue_type, flagged_at, created_at\n' +
    '            FROM media_review_queue \n' +
    '            WHERE content_moderation_id = 180\n' +
    '            ORDER BY created_at DESC\n' +
    '            LIMIT 1\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'created_at' in 'field list'"
}
❌ Queue check error: Error: Unknown column 'created_at' in 'field list'
    at PromisePool.query (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:36:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:167:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                id, content_moderation_id, model_id, model_name, image_path,\n' +
    '                nudity_score, detected_parts, part_locations, \n' +
    '                final_risk_score, risk_level,\n' +
    '                review_status, priority, queue_type, flagged_at, created_at\n' +
    '            FROM media_review_queue \n' +
    '            WHERE content_moderation_id = 180\n' +
    '            ORDER BY created_at DESC\n' +
    '            LIMIT 1\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'created_at' in 'field list'"
}
Queue item loaded: {
  id: 180,
  model_id: 1,
  model_name: 'Escort Example',
  model_slug: 'escortexample',
  image_path: '/uploads/escortexample/originals/1754587320239_BlowJob.jpg',
  original_path: '/uploads/escortexample/originals/1754587320239_BlowJob.jpg',
  usage_intent: 'public_site',
  nudity_score: 78.84,
  detected_parts: {
    FACE_FEMALE: 78.8359522819519,
    MALE_GENITALIA_EXPOSED: 25.87329149246216
  },
  part_locations: {
    FACE_FEMALE: {
      x: 1661,
      y: 1562,
      width: -603,
      height: -558,
      confidence: 78.8359522819519
    },
    MALE_GENITALIA_EXPOSED: {
      x: 2069,
      y: 2343,
      width: -1533,
      height: -1703,
      confidence: 25.87329149246216
    }
  },
  moderation_status: 'flagged',
  flagged: 1,
  appeal_requested: 0,
  created_at: 2025-08-07T17:22:02.000Z,
  image_description: {},
  description_text: '',
  description_tags: [],
  description_risk: '0.00',
  child_detected: 0,
  priority: 'high',
  queue_type: 'manual_review'
}
🔍 Checking health of all AI servers...
✅ BLIP webhook processed: batch_id=batch_1754587321_4961a7d1, child_detected=false, content_id=180
Creating blurred version with settings: {
  strength: 19,
  shape: 'square',
  blurredParts: [ 'FACE_FEMALE' ],
  overlayPositions: { FACE_FEMALE: { x: 2090, y: 2260, width: 603, height: 558 } }
}
Original path: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1754587320239_BlowJob.jpg
Output path: /Users/programmer/Projects/musenest/public/uploads/escortexample/public/blurred/blurred_1754587351443_1754587320239_BlowJob.jpg
Raw image dimensions: 4000 x 3000 orientation: 1
🔄 Processing blur in EXIF-stripped coordinate system (matching NudeNet)
🔄 Working with raw image: 4000x3000, orientation: 1
✅ Using EXIF-stripped coordinate system (matching NudeNet detection)
Working with corrected dimensions: 4000 x 3000
Original raw dimensions: 4000 x 3000 orientation: 1
Applying selective blur to regions: [ 'FACE_FEMALE' ]
Blur setting: 19px backend → 11.4px Sharp.js sigma
Processing blur for FACE_FEMALE: { x: 2090, y: 2260, width: 603, height: 558 }
Received manual blur box: x=2090, y=2260, w=603, h=558
Working image dimensions: 4000x3000
Coordinate validation: right=2693/4000, bottom=2818/3000
Using coordinates directly (normalized system): 2090,2260 603x558
🔍 About to extract region: left=2090, top=2260, width=603, height=558
🔍 Extract bounds check: right=2693/4000, bottom=2818/3000
🔍 ACTUAL working image dimensions just before extract: 4000x3000
🔄 Creating fresh Sharp instance for FACE_FEMALE in raw EXIF-stripped space
🔄 Using autoRotate: false to match NudeNet coordinate space
🔄 Raw metadata (EXIF-stripped): 4000x3000, orientation: 1
🔍 FINAL BOUNDS CHECK: extract(2090, 2260, 603, 558) from 4000x3000
🔍 Right edge: 2693 <= 4000? true
🔍 Bottom edge: 2818 <= 3000? true
🔄 Attempting extract for FACE_FEMALE...
✅ Fresh extract successful for FACE_FEMALE
✅ Successfully extracted FACE_FEMALE region
DEBUG: About to apply 11.4px blur to FACE_FEMALE region
DEBUG: ==========================================
DEBUG: Processing FACE_FEMALE with shape: "square"
DEBUG: Shape comparison: shape === 'oval' is false
DEBUG: Shape comparison: shape === 'rounded' is false
DEBUG: Shape comparison: shape === 'square' is true
DEBUG: Full blur settings: {
  "strength": 19,
  "shape": "square",
  "blurredParts": [
    "FACE_FEMALE"
  ],
  "overlayPositions": {
    "FACE_FEMALE": {
      "x": 2090,
      "y": 2260,
      "width": 603,
      "height": 558
    }
  }
}
DEBUG: ==========================================
DEBUG: Using square/rectangle shape for FACE_FEMALE
Applying 1 blur regions to landscape image
✅ Keeping EXIF-stripped result - admin interface now uses same coordinate space
Saving processed image to: /Users/programmer/Projects/musenest/public/uploads/escortexample/public/blurred/blurred_1754587351443_1754587320239_BlowJob.jpg
Setting EXIF orientation metadata to: 1
Blurred file created successfully - Size: 4246357 bytes
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
🚀 Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1754587747368-935116132.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
🚀 Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1754587747384_BlowJob.jpg
📡 Target: 18.221.22.72:5000/analyze
📋 Using analysis configuration: {"blip_components":{"age_estimation":true,"image_description":true,"child_content_detection":true},"nudenet_components":{"anus_detection":true,"face_detection":true,"breast_detection":true,"buttocks_detection":true,"genitalia_detection":true}}
🔧 DEBUG: Sending fields - model_slug="escortexample", usage_intent="public_site", model_id="1"
📊 Analysis components enabled:
  NudeNet: breast=true, genitalia=true, face=true
  BLIP: age=true, child=true, desc=true
🚨 DEV MODE: Using ngrok URL for webhooks: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
📡 Webhook URL provided: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
📝 Form data prepared: context_type=public_gallery, model_id=1, model_slug=escortexample, usage_intent=public_site
📡 Webhook URL: https://01d06ab9a35f.ngrok-free.app/api/blip/webhook
🚀 Sending request to EC2 server...
📤 Sending form data to enhanced API...
🔌 Socket assigned for enhanced API request
🌐 Socket connected to EC2
✅ Enhanced API response received in 1696ms
📊 Status: 200, Content-Length: 927
🏁 Complete response received in 1697ms, size: 927 bytes
📄 Raw response preview: {"success":true,"message":"Image flagged for human review due to detected content","data":{"batch_id":"batch_1754587748_6de35dff","model_id":1,"content_moderation_id":1,"moderation_status":"flagged","usage_intent":"public_gallery","nudity_score":31.599503755569458,"flagged":true,"human_review_required":true,"final_location":"flagged","detected_parts":{"FACE_FEMALE":31.599503755569458},"part_locations":{"FACE_FEMALE":{"x":1724,"y":1635,"width":-714,"height":-924,"confidence":31.599503755569458}},...
✅ JSON parsed successfully, success: true
🔍 Response validation: isValid=true, hasBatchId=false, hasDetectedParts=false
🎯 Transforming enhanced API response...
🔍 DEBUG - Complete API response structure:
{
  "success": true,
  "message": "Image flagged for human review due to detected content",
  "data": {
    "batch_id": "batch_1754587748_6de35dff",
    "model_id": 1,
    "content_moderation_id": 1,
    "moderation_status": "flagged",
    "usage_intent": "public_gallery",
    "nudity_score": 31.599503755569458,
    "flagged": true,
    "human_review_required": true,
    "final_location": "flagged",
    "detected_parts": {
      "FACE_FEMALE": 31.599503755569458
    },
    "part_locations": {
      "FACE_FEMALE": {
        "x": 1724,
        "y": 1635,
        "width": -714,
        "height": -924,
        "confidence": 31.599503755569458
      }
    },
    "pose_analysis": {
      "pose_detected": false,
      "pose_category": "direct_nudenet_mode",
      "suggestive_score": 0,
      "details": {
        "reasoning": [
          "direct_nudenet_analysis_only"
        ]
      }
    },
    "pose_classification": "unknown",
    "explicit_pose_score": 0,
    "final_risk_score": 31.599503755569458,
    "risk_level": "medium",
    "combined_assessment": {
      "final_risk_score": 31.599503755569458,
      "risk_level": "medium",
      "reasoning": [
        "direct_nudenet_only",
        "no_face_or_description_analysis"
      ]
    }
  }
}
📊 Raw API results: nudity=undefined, faces=undefined, minAge=undefined, risk=undefined
📝 Image description found: undefined
🔄 Detected webhook-style response - transforming to v3 structure
🔍 DEBUG: Input nudity_score = 31.599503755569458
🔍 DEBUG: Input detected_parts = [ 'FACE_FEMALE' ]
🔍 DEBUG: Output nudity_score = 31.599503755569458
📋 Batch ID received: batch_1754587748_6de35dff
✅ Transformation complete, final nudity score: 31.599503755569458
🎭 Pose analysis: undefined (undefined)
🔍 Debug - Full transformed result keys: [
  'detected_parts',        'part_locations',
  'nudity_score',          'has_nudity',
  'face_analysis',         'face_count',
  'min_detected_age',      'max_detected_age',
  'underage_detected',     'age_risk_multiplier',
  'image_description',     'description_text',
  'description_tags',      'contains_children',
  'description_risk',      'final_risk_score',
  'risk_level',            'risk_reasoning',
  'combined_assessment',   'pose_analysis',
  'moderation_decision',   'moderation_status',
  'human_review_required', 'flagged',
  'auto_rejected',         'rejection_reason',
  'batch_id',              'success',
  'analysis_version'
]
🔍 Debug - Pose analysis data: {
  pose_detected: false,
  pose_category: 'webhook_analysis_pending',
  suggestive_score: 0,
  details: {
    reasoning: [ 'webhook_nudity_complete', 'blip_pending' ],
    batch_id: 'batch_1754587748_6de35dff'
  }
}
🔍 Debug - Combined assessment: {
  final_risk_score: 31.599503755569458,
  risk_level: 'medium',
  reasoning: [ 'webhook_response', 'blip_analysis_pending' ],
  batch_id: 'batch_1754587748_6de35dff'
}
🔍 DEBUG aiAnalysis keys: [
  'detected_parts',        'part_locations',
  'nudity_score',          'has_nudity',
  'face_analysis',         'face_count',
  'min_detected_age',      'max_detected_age',
  'underage_detected',     'age_risk_multiplier',
  'image_description',     'description_text',
  'description_tags',      'contains_children',
  'description_risk',      'final_risk_score',
  'risk_level',            'risk_reasoning',
  'combined_assessment',   'pose_analysis',
  'moderation_decision',   'moderation_status',
  'human_review_required', 'flagged',
  'auto_rejected',         'rejection_reason',
  'batch_id',              'success',
  'analysis_version'
]
🔍 DEBUG aiAnalysis.batch_id: batch_1754587748_6de35dff
🔍 DEBUG aiAnalysis.moderation_status: flagged
✅ EC2 returned complete response with batch_id: batch_1754587748_6de35dff
📋 Saving EC2 response directly to database without modification
💾 Storing moderation result in database...
🔌 Got dedicated database connection
✅ Database insert completed in 5ms
🔌 Database connection released
✅ Upload processing completed in 1707ms
📊 Result: success=true, status=flagged, nudity=31.599503755569458
📤 Sending successful response to client...
✅ Response sent successfully
🔍 Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
🔍 Parameters: [ 181 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.final_risk_score, cm.risk_level,
                cm.face_analysis, cm.face_count, cm.min_detected_age, cm.max_detected_age,
                cm.underage_detected, cm.image_description, cm.description_text,
                cm.moderation_status, cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
🔍 Parameters: [ 181 ]
⚠️ JSON parsing warning: "[object Object]" is not valid JSON
🔍 Queue check SQL: SELECT 
                id, content_moderation_id, model_id, model_name, image_path,
                nudity_score, detected_parts, part_locations, 
                final_risk_score, risk_level,
                review_status, priority, queue_type, flagged_at, created_at
            FROM media_review_queue 
            WHERE content_moderation_id = ?
            ORDER BY created_at DESC
            LIMIT 1
🔍 Parameters: [ 181 ]
Database query error: Error: Unknown column 'created_at' in 'field list'
    at PromisePool.query (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:36:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:167:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                id, content_moderation_id, model_id, model_name, image_path,\n' +
    '                nudity_score, detected_parts, part_locations, \n' +
    '                final_risk_score, risk_level,\n' +
    '                review_status, priority, queue_type, flagged_at, created_at\n' +
    '            FROM media_review_queue \n' +
    '            WHERE content_moderation_id = 181\n' +
    '            ORDER BY created_at DESC\n' +
    '            LIMIT 1\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'created_at' in 'field list'"
}
❌ Queue check error: Error: Unknown column 'created_at' in 'field list'
    at PromisePool.query (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:36:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:167:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                id, content_moderation_id, model_id, model_name, image_path,\n' +
    '                nudity_score, detected_parts, part_locations, \n' +
    '                final_risk_score, risk_level,\n' +
    '                review_status, priority, queue_type, flagged_at, created_at\n' +
    '            FROM media_review_queue \n' +
    '            WHERE content_moderation_id = 181\n' +
    '            ORDER BY created_at DESC\n' +
    '            LIMIT 1\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'created_at' in 'field list'"
}
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
✅ BLIP webhook processed: batch_id=batch_1754587748_6de35dff, child_detected=false, content_id=181
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Accessing model site: escortmodel/rates
❌ Model not found: escortmodel
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Accessing model site: favicon.ico/home
❌ Model not found: favicon.ico
🔍 Checking health of all AI servers...
📊 SysAdmin Dashboard stats: {
  totalClients: 4,
  activeClients: '2',
  assignedThemes: 3,
  contentPages: 11
}
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
🔍 Checking health of all AI servers...
