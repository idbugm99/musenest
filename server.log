ğŸ” Testing database connection...
âœ… Database connected successfully
ğŸš€ MuseNest Server Started
ğŸ“ Server running on port 3000
ğŸŒ Environment: development
ğŸ”— Health check: http://localhost:3000/health

Next steps:
1. Copy .env.example to .env and configure your database
2. Run: npm run migrate (to set up database)
3. Run: npm run seed (to add sample data)
Loaded 0 active impersonation sessions
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753837555241-932617044.webp',
  originalName: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753837555246_love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10064ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
âŒ Enhanced API request error after 10066ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âœ… Database insert completed in 9ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 2ms
Content flagged and added to moderation queue: 17
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10086ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 17 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 17 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753837879277-279860842.webp',
  originalName: 'love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753837879280_love-family-people-concept-happy-mother-child-daughter-hugging-home-116698410.webp
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10046ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10049ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 12ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 2ms
Content flagged and added to moderation queue: 18
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10064ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 18 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 18 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Mother_Dauther.jpg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753838020142-226468631.jpg',
  originalName: 'Mother_Dauther.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753838020145_Mother_Dauther.jpg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10053ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10055ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 5ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 3ms
Content flagged and added to moderation queue: 19
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10065ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 19 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 19 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'little-girl-playing-sand-beach-building-towers-32333821.webp'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753838516318-594872105.webp',
  originalName: 'little-girl-playing-sand-beach-building-towers-32333821.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753838516323_little-girl-playing-sand-beach-building-towers-32333821.webp
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10050ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10051ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 5ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 2ms
Content flagged and added to moderation queue: 20
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10062ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 20 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 20 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'park.jpg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753838889864-720888746.jpg',
  originalName: 'park.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753838889867_park.jpg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10055ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10057ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 5ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 21
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10064ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 21 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 21 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'little-girl-playing-sand-beach-building-towers-32333821.webp'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753839204715-122961670.webp',
  originalName: 'little-girl-playing-sand-beach-building-towers-32333821.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753839204718_little-girl-playing-sand-beach-building-towers-32333821.webp
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10064ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10066ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 6ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 22
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10074ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 22 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 22 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'TestPhotoTC.webp'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753839415438-81359947.webp',
  originalName: 'TestPhotoTC.webp',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753839415442_TestPhotoTC.webp
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10059ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10061ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 4ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 23
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10068ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 23 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 23 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'Labia.jpg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753839589998-571423960.jpg',
  originalName: 'Labia.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753839590013_Labia.jpg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10920ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10922ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 4ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 24
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10934ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 24 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 24 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'r-sex-2.jpeg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753839803781-91906257.jpeg',
  originalName: 'r-sex-2.jpeg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753839803784_r-sex-2.jpeg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10058ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10060ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 4ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 25
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10066ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 25 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 25 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753839943622-766847641.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753839943641_BlowJob.jpg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10785ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10786ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 4ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 26
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10798ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 26 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 26 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
Error ending impersonation: Error: Impersonation session not found
    at ImpersonationManager.endImpersonation (/Users/programmer/Projects/musenest/middleware/impersonation.js:143:23)
    at ImpersonationManager.cleanupExpiredSessions (/Users/programmer/Projects/musenest/middleware/impersonation.js:308:28)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Error cleaning up expired sessions: Error: Impersonation session not found
    at ImpersonationManager.endImpersonation (/Users/programmer/Projects/musenest/middleware/impersonation.js:143:23)
    at ImpersonationManager.cleanupExpiredSessions (/Users/programmer/Projects/musenest/middleware/impersonation.js:308:28)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Received upload request: {
  model_id: '1',
  model_slug: 'escortexample',
  usage_intent: 'public_site',
  context_type: 'public_gallery',
  file: 'BlowJob.jpg'
}
ğŸš€ Processing upload for model escortexample with intent: public_site
ContentModerationService processing: {
  filePath: '/Users/programmer/Projects/musenest/temp_uploads/temp-1753842981798-645783956.jpg',
  originalName: 'BlowJob.jpg',
  modelId: 1,
  modelSlug: 'escortexample',
  usageIntent: 'public_site',
  contextType: 'public_gallery'
}
Folder structure created for model: escortexample
ğŸš€ Starting enhanced analysis for image: /Users/programmer/Projects/musenest/public/uploads/escortexample/originals/1753842981813_BlowJob.jpg
ğŸ“¡ Target: 18.221.22.72:5000/analyze
ğŸ“ Form data prepared: context_type=public_gallery, model_id=1
ğŸ“¤ Sending form data to enhanced API...
ğŸ”Œ Socket assigned for enhanced API request
ğŸŒ Socket connected to EC2
â° Enhanced API timeout after 10583ms
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
â° Socket timeout occurred
âœ… Fallback analysis completed after timeout
ğŸ’¾ Storing moderation result in database...
ğŸ”Œ Got dedicated database connection
âŒ Enhanced API request error after 10584ms: socket hang up
Error details: code=ECONNRESET, syscall=undefined
ğŸš¨ FALLING BACK TO CONSERVATIVE ANALYSIS
ğŸš¨ Using HARDCODED conservative fallback - NO ACTUAL IMAGE ANALYSIS
âœ… Fallback analysis completed
âœ… Database insert completed in 5ms
ğŸ”Œ Database connection released
ğŸ“‹ Adding flagged content to moderation queue...
ğŸ”Œ Got dedicated database connection for queue
âœ… Queue insert completed in 1ms
Content flagged and added to moderation queue: 27
ğŸ”Œ Queue database connection released
âœ… Upload processing completed in 10601ms
ğŸ“Š Result: success=true, status=flagged, nudity=95
ğŸ“¤ Sending successful response to client...
âœ… Response sent successfully
ğŸ” Database check SQL: SELECT 
                id, image_path, original_path, model_id, context_type, usage_intent,
                nudity_score, detected_parts, part_locations, has_nudity,
                face_analysis, face_count, min_detected_age, max_detected_age, 
                underage_detected, age_risk_multiplier,
                image_description, description_text, description_tags, 
                contains_children, description_risk,
                final_risk_score, risk_level, risk_reasoning,
                moderation_status, human_review_required, flagged, 
                auto_rejected, rejection_reason, final_location, created_at
            FROM content_moderation 
            WHERE id = ?
ğŸ” Parameters: [ 27 ]
âš ï¸ JSON parsing warning: "[object Object]" is not valid JSON
ğŸ” Database retrieve SQL: SELECT 
                cm.id, cm.image_path, cm.original_path, cm.nudity_score,
                cm.detected_parts, cm.part_locations, cm.pose_classification,
                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,
                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,
                cm.human_review_required, cm.flagged, cm.final_location,
                cm.created_at, m.name as model_name
            FROM content_moderation cm
            LEFT JOIN models m ON cm.model_id = m.id
            WHERE cm.id = ?
ğŸ” Parameters: [ 27 ]
Database query error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
âŒ Database retrieve error: Error: Unknown column 'cm.pose_classification' in 'field list'
    at PromisePool.execute (/Users/programmer/Projects/musenest/node_modules/mysql2/lib/promise/pool.js:54:22)
    at Object.query (/Users/programmer/Projects/musenest/config/database.js:35:35)
    at /Users/programmer/Projects/musenest/routes/api/test.js:102:33
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/programmer/Projects/musenest/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/programmer/Projects/musenest/node_modules/express/lib/router/layer.js:95:5)
    at /Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/programmer/Projects/musenest/node_modules/express/lib/router/index.js:280:10) {
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sql: '\n' +
    '            SELECT \n' +
    '                cm.id, cm.image_path, cm.original_path, cm.nudity_score,\n' +
    '                cm.detected_parts, cm.part_locations, cm.pose_classification,\n' +
    '                cm.explicit_pose_score, cm.final_risk_score, cm.risk_level,\n' +
    '                cm.combined_assessment, cm.pose_category, cm.pose_analysis, cm.moderation_status,\n' +
    '                cm.human_review_required, cm.flagged, cm.final_location,\n' +
    '                cm.created_at, m.name as model_name\n' +
    '            FROM content_moderation cm\n' +
    '            LEFT JOIN models m ON cm.model_id = m.id\n' +
    '            WHERE cm.id = ?\n' +
    '        ',
  sqlState: '42S22',
  sqlMessage: "Unknown column 'cm.pose_classification' in 'field list'"
}
